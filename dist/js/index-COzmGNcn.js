import{p as e,q as t,x as n,af as o,t as i,a1 as r,r as s,n as a,I as l,ct as c,cu as d,b4 as u,v as h,w as f,cv as p,bi as g,bj as m,b1 as y,cb as x,bQ as v,j as b,S as w,c as S,ad as C,R as N,cw as k,cd as E,b2 as M,cc as _,A as j,bg as P,cx as I,cy as A,cz as D,f as z,cA as R,cB as O,m as B,cC as L,cD as T,bl as $}from"./index-BB8uQJur.js";import{I as V,P as H}from"./imageSwiper-Dy6XpVln.js";import{T as F}from"./text_p-Bj2ORef_.js";import{c as X,T as Y,s as Z}from"./createLucideIcon-B6Xw5J45.js";import{s as K,c as W,a as calculateStatus,S as q}from"./index-Ca1FkZjl.js";import{q as G,u as U,a as Q,b as J,c as ee}from"./index-BqbOAVfK.js";import{b as te,c as ne,d as oe,M as ie,e as re,a as se}from"./hooks-96EgTEj0.js";import{C as ae}from"./index-BDmDzsEX.js";import{R as le,D as ce,T as de,A as ue}from"./index-D4ELpttd.js";import{S as he,u as fe}from"./useReadAllowance-DPJwjrG5.js";import{p as pe,t as ge}from"./time-9moo8M1B.js";import{S as me}from"./index-DkBaQqw6.js";import"./index-B4Yf1T-J.js";const ye=e=>{const{componentCls:t}=e;return{[t]:{"&-horizontal":{[`&${t}`]:{"&-sm":{marginBlock:e.marginXS},"&-md":{marginBlock:e.margin}}}}}},xe=e=>{const{componentCls:t,sizePaddingEdgeHorizontal:i,colorSplit:r,lineWidth:s,textPaddingInline:a,orientationMargin:l,verticalMarginInline:c}=e;return{[t]:Object.assign(Object.assign({},n(e)),{borderBlockStart:`${o(s)} solid ${r}`,"&-vertical":{position:"relative",top:"-0.06em",display:"inline-block",height:"0.9em",marginInline:c,marginBlock:0,verticalAlign:"middle",borderTop:0,borderInlineStart:`${o(s)} solid ${r}`},"&-horizontal":{display:"flex",clear:"both",width:"100%",minWidth:"100%",margin:`${o(e.marginLG)} 0`},[`&-horizontal${t}-with-text`]:{display:"flex",alignItems:"center",margin:`${o(e.dividerHorizontalWithTextGutterMargin)} 0`,color:e.colorTextHeading,fontWeight:500,fontSize:e.fontSizeLG,whiteSpace:"nowrap",textAlign:"center",borderBlockStart:`0 ${r}`,"&::before, &::after":{position:"relative",width:"50%",borderBlockStart:`${o(s)} solid transparent`,borderBlockStartColor:"inherit",borderBlockEnd:0,transform:"translateY(50%)",content:"''"}},[`&-horizontal${t}-with-text-start`]:{"&::before":{width:`calc(${l} * 100%)`},"&::after":{width:`calc(100% - ${l} * 100%)`}},[`&-horizontal${t}-with-text-end`]:{"&::before":{width:`calc(100% - ${l} * 100%)`},"&::after":{width:`calc(${l} * 100%)`}},[`${t}-inner-text`]:{display:"inline-block",paddingBlock:0,paddingInline:a},"&-dashed":{background:"none",borderColor:r,borderStyle:"dashed",borderWidth:`${o(s)} 0 0`},[`&-horizontal${t}-with-text${t}-dashed`]:{"&::before, &::after":{borderStyle:"dashed none none"}},[`&-vertical${t}-dashed`]:{borderInlineStartWidth:s,borderInlineEnd:0,borderBlockStart:0,borderBlockEnd:0},"&-dotted":{background:"none",borderColor:r,borderStyle:"dotted",borderWidth:`${o(s)} 0 0`},[`&-horizontal${t}-with-text${t}-dotted`]:{"&::before, &::after":{borderStyle:"dotted none none"}},[`&-vertical${t}-dotted`]:{borderInlineStartWidth:s,borderInlineEnd:0,borderBlockStart:0,borderBlockEnd:0},[`&-plain${t}-with-text`]:{color:e.colorText,fontWeight:"normal",fontSize:e.fontSize},[`&-horizontal${t}-with-text-start${t}-no-default-orientation-margin-start`]:{"&::before":{width:0},"&::after":{width:"100%"},[`${t}-inner-text`]:{paddingInlineStart:i}},[`&-horizontal${t}-with-text-end${t}-no-default-orientation-margin-end`]:{"&::before":{width:"100%"},"&::after":{width:0},[`${t}-inner-text`]:{paddingInlineEnd:i}}})}},ve=e("Divider",e=>{const n=t(e,{dividerHorizontalWithTextGutterMargin:e.margin,sizePaddingEdgeHorizontal:0});return[xe(n),ye(n)]},e=>({textPaddingInline:"1em",orientationMargin:.05,verticalMarginInline:e.marginXS}),{unitless:{orientationMargin:!0}});const be={small:"sm",middle:"md"},we=e=>{const{getPrefixCls:t,direction:n,className:o,style:l}=i("divider"),{prefixCls:c,type:d="horizontal",orientation:u="center",orientationMargin:h,className:f,rootClassName:p,children:g,dashed:m,variant:y="solid",plain:x,style:v,size:b}=e,w=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(n[o[i]]=e[o[i]])}return n}(e,["prefixCls","type","orientation","orientationMargin","className","rootClassName","children","dashed","variant","plain","style","size"]),S=t("divider",c),[C,N,k]=ve(S),E=r(b),M=be[E],_=!!g,j=s.useMemo(()=>"left"===u?"rtl"===n?"end":"start":"right"===u?"rtl"===n?"start":"end":u,[n,u]),P="start"===j&&null!=h,I="end"===j&&null!=h,A=a(S,o,N,k,`${S}-${d}`,{[`${S}-with-text`]:_,[`${S}-with-text-${j}`]:_,[`${S}-dashed`]:!!m,[`${S}-${y}`]:"solid"!==y,[`${S}-plain`]:!!x,[`${S}-rtl`]:"rtl"===n,[`${S}-no-default-orientation-margin-start`]:P,[`${S}-no-default-orientation-margin-end`]:I,[`${S}-${M}`]:!!M},f,p),D=s.useMemo(()=>"number"==typeof h?h:/^\d+$/.test(h)?Number(h):h,[h]),z={marginInlineStart:P?D:void 0,marginInlineEnd:I?D:void 0};return C(/* @__PURE__ */s.createElement("div",Object.assign({className:A,style:Object.assign(Object.assign({},l),v)},w,{role:"separator"}),g&&"vertical"!==d&&/* @__PURE__ */s.createElement("span",{className:`${S}-inner-text`,style:z},g)))};function Se(){return Se=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},Se.apply(this,arguments)}const Ce=(e,t)=>/* @__PURE__ */s.createElement(l,Se({},e,{ref:t,icon:c})),Ne=/* @__PURE__ */s.forwardRef(Ce),ke=X("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),Ee=X("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);async function Me(e){try{const{network:t,layer:n}=h,{data:o,error:i}=await K.from("boxes").select("*").eq("network",t).eq("layer",n).eq("id",e).single();if(i)return{box:null,metadataBox:null,error:i};if(!o)return{box:null,metadataBox:null,error:null};const{data:r,error:s}=await K.from("metadata_boxes").select("*").eq("network",t).eq("layer",n).eq("id",e).maybeSingle(),a=r||null,l=function(e){const t=W(e,{deep:!0});return{...t,status:calculateStatus(t.status,t.deadline,t.buyerId||t.buyer_id),biddersIds:t.biddersIds||[],acceptedToken:t.acceptedToken??void 0,listedMode:t.listedMode??void 0}}(o),c=a?function(e){var t,n;const o=e.encryption_slices_metadata_cid||{},i=e.encryption_passwords||{},r=Array.isArray(e.encryption_file_cid)?e.encryption_file_cid:[],s={slicesMetadataCID_encryption:o.slicesMetadataCID_encryption??o.slicesMetadataCidEncryption??o.slices_metadata_cid_encryption??"",slicesMetadataCID_iv:o.slicesMetadataCID_iv??o.slicesMetadataCidIv??o.slices_metadata_cid_iv??""},a={password_encryption:i.password_encryption??i.passwordEncryption??i.password_encryption??"",password_iv:i.password_iv??i.passwordIv??i.password_iv??""},l=r.map(e=>({fileCID_encryption:e.fileCID_encryption??e.fileCidEncryption??e.file_cid_encryption??"",fileCID_iv:e.fileCID_iv??e.fileCidIv??e.file_cid_iv??""}));return{project:e.project,website:e.website,name:e.name,tokenId:(null==(n=null==(t=e.id)?void 0:t.toString)?void 0:n.call(t))??"",typeOfCrime:e.type_of_crime??"",label:e.label??[],title:e.title??"",nftImage:e.nft_image??"",boxImage:e.box_image??"",country:e.country??"",state:e.state??"",description:e.description??"",eventDate:e.event_date??"",createDate:e.create_date??"",timestamp:Number(e.timestamp??0),mintMethod:e.mint_method,fileList:e.file_list??[],encryptionSlicesMetadataCID:s,encryptionFileCID:l,encryptionPasswords:a,publicKey:e.public_key??""}}(a):null;return{box:l,metadataBox:c,error:null}}catch(t){return{box:null,metadataBox:null,error:_e(t)}}}function _e(e){return e?"object"==typeof e&&"message"in e?e:new Error("Unknown Supabase error"):null}const je=(e,t)=>{const{network:n,layer:o}=h,i=!!e&&!!t&&"Storing"!==t.listedMode&&"Selling"!==t.listedMode&&""!==t.buyerId,r=t.listedMode||"",{data:a,isLoading:l,error:c,isFetching:d}=f({queryKey:["box-bidders",n,o,e,r],queryFn:async()=>{const t=await async function(e,t){const{network:n,layer:o}=h;try{let i=null;if("Auctioning"===t){const{data:t,error:r}=await K.from("box_bidders").select("bidder_id").eq("network",n).eq("layer",o).eq("id",e);if(r)return{biddersIds:null,error:r};t&&Array.isArray(t)&&(i=t.map(e=>{const t=e.bidder_id;return"string"==typeof t?t:"bigint"==typeof t?t.toString():(null==t?void 0:t.toString())||""}).filter(e=>""!==e))}return{biddersIds:i&&i.length>0?i:null,error:null}}catch(c){return{biddersIds:null,error:_e(c)}}}(e,r);if(t.error)throw t.error;return t},staleTime:3e5,enabled:i});return{biddersIds:s.useMemo(()=>{if(null==a?void 0:a.biddersIds)return a.biddersIds},[null==a?void 0:a.biddersIds]),isLoading:l||d,error:c||null}},Pe={userState:{roles:[]},modalStatus:{SellAuction:"close",ExtendDeadline:"close",ViewFile:"close",BuyBidPay:"close"}},Ie=g()(m(e=>({...Pe,updateUserState:t=>e(e=>({userState:{...e.userState,...t}}),!1,"updateUserState"),updateModalStatus:(t,n)=>e(e=>({modalStatus:{...e.modalStatus,[t]:n}}),!1,"updateModalStatus")}))),Ae=s.createContext(void 0),De=({boxId:e,children:t})=>{const{box:n,metadataBox:o,isLoading:i}=(e=>{const{network:t,layer:n}=h,{data:o,isLoading:i,error:r,isFetching:a}=f({queryKey:["box-detail",t,n,e],queryFn:async()=>{const t=await Me(e);if(t.error)throw t.error;return t},staleTime:3e5,enabled:!!e});return{box:s.useMemo(()=>{if(null==o?void 0:o.box)return o.box},[null==o?void 0:o.box]),metadataBox:s.useMemo(()=>{if(null==o?void 0:o.metadataBox)return o.metadataBox},[null==o?void 0:o.metadataBox]),boxId:e,isLoading:i||a,error:r||null}})(e),r=(e=>{if(!e)return;const{deadline:t,requestRefundDeadline:n,reviewDeadline:o}=e;let i=!1,r=!0,s=!0;const a=Math.floor(Date.now()/1e3);return t&&(i=Number(t)>a),n&&(r=Number(n)>a),o&&(s=Number(o)>a),{isInRequestRefundDeadline:r,isInReviewRefundDeadline:s,isInDeadline:i,isInExtendDeadlineTimeWindow:a>Number(t)-p.deadlineExtensionWindow}})(n||{}),{address:a}=y()||{},l=x(e=>{var t,n;if(!a||!v)return null;const o=e.accounts[v];if(!o)return null;const i=(null==(t=o[a])?void 0:t.userId)??(null==(n=o[a.toLowerCase()])?void 0:n.userId)??null;return i&&""!==i.trim()?i:null}),{boxRewardsData:c,isLoading:d}=((e,t)=>{const{network:n,layer:o}=h,i=!(!e||!t||""===t.listedMode||"InSecrecy"!==t.status&&"Published"!==t.status),{data:r,isLoading:a,error:l,isFetching:c}=f({queryKey:["box-rewards",n,o,e],queryFn:async()=>{const t=await G(e);if(t.error)throw t.error;return t},staleTime:3e5,enabled:i});return{boxRewardsData:s.useMemo(()=>{if(null==r?void 0:r.boxRewardsData)return r.boxRewardsData},[null==r?void 0:r.boxRewardsData]),isLoading:a||c,error:l||null}})(e,n||{}),{biddersIds:u,isLoading:g}=je(e,n||{}),m=Ie(e=>e.userState.roles),{orderAmountsData:w,isLoading:S}=U(e,l||"",m),C=s.useMemo(()=>({box:n,boxId:e,metadataBox:o,isLoading:i||!n,deadlineCheckState:r,boxRewardsData:c,isLoadingRewards:d,biddersIds:u,isLoadingBidders:g,orderAmountsData:w,isLoadingOrderAmounts:S}),[n,e,o,i,r,c,d,u,g,w,S]);/* @__PURE__ */
return b.jsx(Ae.Provider,{value:C,children:t})},ze=()=>{const e=s.useContext(Ae);if(!e)throw new Error("useBoxContext must be used within BoxProvider");return e},Re=({tokenId:e})=>{const{box:t,metadataBox:n}=ze();return t?/* @__PURE__ */b.jsxs("div",{className:"w-full space-y-6 md:space-y-8",children:[
/* @__PURE__ */b.jsxs(w,{direction:"vertical",size:"middle",children:[
/* @__PURE__ */b.jsxs(w,{direction:"horizontal",size:"middle",children:[
/* @__PURE__ */b.jsx(F,{children:"Truth Box Id:"}),
/* @__PURE__ */b.jsx(F,{children:e})]}),
/* @__PURE__ */b.jsxs(w,{direction:"horizontal",size:"middle",children:[
/* @__PURE__ */b.jsx(F,{children:"Minter:"})," ",
/* @__PURE__ */b.jsx(F,{children:t.minterId})]}),
/* @__PURE__ */b.jsxs(w,{direction:"horizontal",size:"middle",children:[
/* @__PURE__ */b.jsx(F,{children:"Owner:"})," ",
/* @__PURE__ */b.jsx(F,{children:t.ownerAddress})]}),
/* @__PURE__ */b.jsxs(w,{direction:"horizontal",size:"middle",children:[
/* @__PURE__ */b.jsx(F,{children:"Create date:"})," ",
/* @__PURE__ */b.jsx(F,{children:(null==n?void 0:n.createDate)?new Date(null==n?void 0:n.createDate).toLocaleString():""})]})]}),
/* @__PURE__ */b.jsx("div",{className:"w-full bg-black rounded-xl md:rounded-2xl overflow-hidden",children:/* @__PURE__ */b.jsx("div",{className:"aspect-video md:aspect-[4/3] lg:aspect-video",children:/* @__PURE__ */b.jsx(V,{images:[(null==n?void 0:n.boxImage)||"",(null==n?void 0:n.nftImage)||""],className:"w-full"})})}),
/* @__PURE__ */b.jsx("div",{className:"space-y-4",children:/* @__PURE__ */b.jsx(Y,{children:null==n?void 0:n.title})}),
/* @__PURE__ */b.jsxs("div",{className:"flex flex-col gap-2",children:[
/* @__PURE__ */b.jsx(F,{children:null==n?void 0:n.country}),
/* @__PURE__ */b.jsx(F,{children:null==n?void 0:n.state}),
/* @__PURE__ */b.jsx(F,{children:null==n?void 0:n.eventDate})]}),
/* @__PURE__ */b.jsx("hr",{className:"border-border/50"}),
/* @__PURE__ */b.jsx("div",{className:"space-y-3",children:/* @__PURE__ */b.jsx(F,{children:null==n?void 0:n.description})})]}):/* @__PURE__ */b.jsx("div",{className:"w-full flex items-center justify-center py-12",children:/* @__PURE__ */b.jsx("div",{className:"text-muted-foreground text-lg font-mono",children:"Loading..."})})},Oe=({children:e,className:t})=>/* @__PURE__ */b.jsx("div",{className:S("flex flex-col md:flex-row w-full ","p-2 items-center gap-2 ","bg-background rounded-md md:rounded-xl",t),children:e}),Be=({controller:e,className:t,onClick:n,children:o})=>{var i;/* @__PURE__ */
return b.jsxs(Oe,{className:t,children:[
/* @__PURE__ */b.jsx(C,{onClick:()=>e.execute({onClick:n}),loading:e.isLoading,disabled:e.isDisabled,children:e.label}),
/* @__PURE__ */b.jsxs("div",{className:"flex flex-col items-start",children:[(null==(i=e.error)?void 0:i.message)&&/* @__PURE__ */b.jsx(F,{type:"error",children:e.error.message}),e.description&&/* @__PURE__ */b.jsx("div",{className:"flex flex-col items-start",children:/* @__PURE__ */b.jsx(F,{size:"sm",children:e.description})}),o]})]})},Le=g((e,t)=>({functionWriting:null,setFunctionWriting:t=>e({functionWriting:t}),reset:()=>e({functionWriting:null})})),Te=e=>{const{writeContractAsync:t,data:n,error:o,isPending:i,isError:r,isSuccess:a,status:l,reset:c}=te(),{isSuccess:d}=ne({hash:n}),{address:u}=y(),[h,f]=s.useState(null),{setFunctionWriting:p}=Le(),g=x(e=>e.addBoxInteraction);return s.useEffect(()=>{d&&h&&u&&e?Array.isArray(e)?e.forEach(e=>{g(e,h,n)}):g(e,h,n):r&&(c(),p(null))},[d,h,u,e,n,g,r,c]),{writeCustormV2:async e=>{const n=e.functionName;f(n),p(n);try{return await t({address:e.contract.address,abi:e.contract.abi,functionName:e.functionName,args:e.args})}catch(o){throw o}finally{p(null)}},hash:n,error:o,isPending:i,isLoading:"idle"!==l&&"error"!==l&&!d,isSuccess:a,status:l,isError:r,reset:c,isSuccessed:d}},$e=["sell","auction","publishByMinter"],Ve=["sell","auction","publishByMinter"],He=["sell","auction","publishByMinter"],Fe=["buy","bid","publishByMinter"],Xe=["buy","bid","publishByMinter"],Ye=["requestRefund","completeOrder"],Ze=["cancelRefund","agreeRefund","refuseRefund"],Ke=["agreeRefund","cancelRefund","refuseRefund"],We=["agreeRefund","cancelRefund","refuseRefund"],qe=["completeOrder","requestRefund","agreeRefund","refuseRefund"],Ge=["payConfiFee","publishByBuyer"],Ue=["publishByMinter","publishByBuyer","sell","auction"],Qe=e=>{const{boxId:t,box:n,deadlineCheckState:o}=ze(),{userState:i,modalStatus:r}=Ie(e=>e),{address:a}=y()||{},l=null==a?void 0:a.toLowerCase(),c=[],d=s.useMemo(()=>l&&v?e=>{var n,o;return(null==(o=null==(n=e.accounts[v])?void 0:n[l])?void 0:o.boxInteractions[t])??c}:()=>c,[l,t]),u=x(d);return s.useMemo(()=>{if(!n)return!1;const t=u.map(e=>e.functionWrote)||[],s=i.roles,{isInDeadline:a,isInRequestRefundDeadline:l,isInReviewRefundDeadline:c}=o||{},d=n.isInBlacklist||!1,h=n.status||"Storing",f=Number(n.purchaseTimestamp)||0,p=Number(n.reviewDeadline)||0,g=n.refundPermit||!1,m=!n.buyerId||""===n.buyerId,y=s.includes("Minter"),x=s.includes("Admin"),v=s.includes("Buyer"),b=s.includes("Bidder"),w=s.includes("Other"),S=0===s.length,C=()=>a?y:!S,N=e=>e.every(e=>!t.includes(e));switch(e){case"extendActive":return!d&&y&&a&&(null==o?void 0:o.isInExtendDeadlineTimeWindow)&&N($e)&&"close"===r.ExtendDeadline;case"sellActive":return!d&&"Storing"===h&&C()&&N(Ve)&&"close"===r.SellAuction;case"auctionActive":return!d&&"Storing"===h&&C()&&N(He)&&"close"===r.SellAuction;case"buyActive":return!d&&0===f&&m&&"Selling"===h&&w&&N(Fe);case"bidActive":return!d&&"Auctioning"===h&&(w||b)&&a&&N(Xe);case"requestRefundActive":return!d&&!g&&l&&0===p&&"Paid"===h&&v&&N(Ye);case"cancelRefundActive":return!d&&!g&&"Refunding"===h&&v&&N(Ze);case"agreeRefundActive":return!d&&!g&&"Refunding"===h&&(c?x||y:!S)&&N(Ke);case"refuseRefundActive":return!d&&!g&&"Refunding"===h&&x&&N(We);case"completeActive":return!d&&0===p&&!g&&"Paid"===h&&(l?v:!S)&&N(qe);case"payConfiFeeActive":return!d&&"InSecrecy"===h&&(null==o?void 0:o.isInExtendDeadlineTimeWindow)&&!S&&N(Ge);case"publishActive":return!d&&("Storing"===h?y:"InSecrecy"===h&&v)&&N(Ue);case"viewFileActive":return!d&&("Storing"===h||"Selling"===h||"Auctioning"===h?y:"InSecrecy"===h||"Paid"===h?v:("Refunding"===h||"Published"===h)&&!S);default:return!0}},[e,n,l,i.roles,u,r,t])},Je=e=>{const t=oe(),{box:n,boxId:o}=ze(),i=Ie(e=>e.userState.roles),{functionWriting:r}=Le(),{writeCustormV2:a,error:l,isLoading:c,isSuccessed:d}=Te(o),u=!e.activeKey||Qe(e.activeKey),h=s.useMemo(()=>({box:n,boxId:o,roles:i}),[n,o,i]),f=s.useMemo(()=>o=>e.buildWrite?e.buildWrite(h,t,o):e.contract&&e.functionName&&e.getArgs&&n?{contract:e.contract(t),functionName:e.functionName,args:e.getArgs(h,t)}:null,[e,h,t,n]),p=s.useMemo(()=>f(void 0),[f]),g=e.pendingFunctions??(e.functionName?[e.functionName]:[]),m=g.length>0&&g.includes(r??""),y=null!==r&&!g.includes(r??""),x=!!e.allowedRoles&&!e.allowedRoles.some(e=>i.includes(e)),v=!!e.isDisabled&&e.isDisabled(h),b=!p&&!e.requiresCustomArgs,w=y||m||x||v||!u||b,S=s.useRef(null);s.useEffect(()=>{S.current=r},[r]);return{label:e.label,description:e.description,isLoading:m||c,isDisabled:w,isSuccessed:d,showApprove:!1,error:l,execute:async t=>{var n,o;const i=f(null==t?void 0:t.customArgs);i||!e.requiresCustomArgs?i&&(null==(o=null==t?void 0:t.onClick)||o.call(t),await a({contract:i.contract,functionName:i.functionName,args:i.args})):null==(n=null==t?void 0:t.onClick)||n.call(t)}}},et=e=>e.Exchange,tt={buy:{id:"buy",label:"Buy",description:"Buy this box.",activeKey:"buyActive",requiresCustomArgs:!0},bid:{id:"bid",label:"Bid",description:"Bid for this box.",activeKey:"bidActive",requiresCustomArgs:!0},payConfiFee:{id:"payConfiFee",label:"PayConfiFee",activeKey:"payConfiFeeActive",requiresCustomArgs:!0},requestRefund:{id:"requestRefund",label:"Refund",description:"Request refund before the deadline.",contract:et,functionName:"requestRefund",getArgs:({boxId:e})=>[e],activeKey:"requestRefundActive"},cancelRefund:{id:"cancelRefund",label:"Cancel",description:"Cancel refund, the transaction will be completed.",contract:et,functionName:"cancelRefund",getArgs:({boxId:e})=>[e],activeKey:"cancelRefundActive"},agreeRefund:{id:"agreeRefund",label:"Agree",description:"Agree refund, funds will be returned to the buyer.",contract:et,functionName:"agreeRefund",getArgs:({boxId:e})=>[e],activeKey:"agreeRefundActive"},refuseRefund:{id:"refuseRefund",label:"Refuse",description:"Refuse refund, the transaction will be completed.",contract:et,functionName:"refuseRefund",getArgs:({boxId:e})=>[e],activeKey:"refuseRefundActive"},completeOrder:{id:"completeOrder",label:"Complete",description:"Complete the order: Paid → InSecrecy.",contract:et,functionName:"completeOrder",getArgs:({boxId:e})=>[e],activeKey:"completeActive"},publish:{id:"publish",label:"Publish",description:"Publish the box.",contract:e=>e.TruthBox,functionName:"publishByMinter",getArgs:({boxId:e})=>[e],activeKey:"publishActive",buildWrite:(e,t)=>{const{box:n,boxId:o,roles:i}=e;return n?"Storing"===n.status&&i.includes("Minter")?{contract:t.TruthBox,functionName:"publishByMinter",args:[o]}:"InSecrecy"===n.status&&i.includes("Buyer")?{contract:t.TruthBox,functionName:"publishByBuyer",args:[o]}:null:null}},sell:{id:"sell",label:"Sell",activeKey:"sellActive",requiresCustomArgs:!0,pendingFunctions:["sell"],buildWrite:(e,t,n)=>{if(!n)return null;const{acceptedToken:o,price:i}=n;return{contract:t.Exchange,functionName:"sell",args:[e.boxId,o,i]}}},auction:{id:"auction",label:"Auction",activeKey:"auctionActive",requiresCustomArgs:!0,pendingFunctions:["auction"],buildWrite:(e,t,n)=>{if(!n)return null;const{acceptedToken:o,price:i}=n;return{contract:t.Exchange,functionName:"auction",args:[e.boxId,o,i]}}},extendDeadline:{id:"extendDeadline",label:"Extend Deadline",description:"Extend the deadline of the box.",activeKey:"extendActive",requiresCustomArgs:!0},viewFile:{id:"viewFile",label:"View File",description:"View the confidential file.",activeKey:"viewFileActive",requiresCustomArgs:!0}},nt=N.memo(({onClick:e,className:t})=>{const n=Je(tt.completeOrder),{roles:o}=Ie(e=>e.userState),{helperRewardRate:i}=k();/* @__PURE__ */
return b.jsx(Be,{controller:n,className:t,onClick:e,children:!o.includes("Buyer")&&/* @__PURE__ */b.jsxs(F,{children:["You will get a ",i,"% reward for completing the transaction."]})})}),ot=N.memo(({onClick:e,className:t})=>{const n=Je(tt.agreeRefund);/* @__PURE__ */
return b.jsx(Be,{controller:n,className:t,onClick:e})}),it=N.memo(({onClick:e,className:t})=>{const n=Je(tt.refuseRefund);/* @__PURE__ */
return b.jsx(Be,{controller:n,className:t,onClick:e})}),rt=N.memo(({onClick:e,className:t})=>{const n=Je(tt.cancelRefund);/* @__PURE__ */
return b.jsx(Be,{controller:n,className:t,onClick:e})}),{Text:st,Paragraph:at}=E,lt=({label:e,type:t,cidList:n=[],className:o})=>0===n.length?null:/* @__PURE__ */b.jsx("div",{className:o,children:/* @__PURE__ */b.jsx(ae,{children:/* @__PURE__ */b.jsxs(w,{direction:"vertical",size:"small",style:{width:"100%"},children:[
/* @__PURE__ */b.jsxs(st,{strong:!0,style:{fontFamily:"monospace",fontSize:13},children:[e,":"]}),n.map((e,n)=>{/* @__PURE__ */return b.jsx("div",{style:{display:"flex",alignItems:"center",gap:8,width:"100%"},children:/* @__PURE__ */b.jsx(at,{copyable:{text:e,icon:[/* @__PURE__ */b.jsx(le,{},"copy"),/* @__PURE__ */b.jsx(Ne,{},"check")],tooltips:["Copy","Copied!"]},ellipsis:{tooltip:e},style:{flex:1,fontFamily:"cid"===t||"password"===t?"monospace":void 0,fontSize:13},children:(o=e,"password"===t&&o?"•".repeat(Math.min(o.length,12)):o)})},n);var o})]})})}),ct=()=>{const{chainId:e,address:t}=y(),{getPrivateKey_TruthBox:n,setPrivateKey_TruthBox:o}=M(),{session:i,isValidateSession:r,login:s}=_(),{getPrivateData:a}=function(){const{readContract:e}=d();return{getBasicData:async t=>{try{const n=await e({contractName:u.TRUTH_BOX,functionName:"getBasicData",args:[t]});return n&&Array.isArray(n)&&n.length>=3?[Number(n[0]),Number(n[1]),Number(n[2])]:[0,0,0]}catch(n){return[0,0,0]}},getStatus:async(t,n=!1)=>{try{const o=await e({contractName:u.TRUTH_BOX,functionName:"getStatus",args:[t],force:n});return o?Number(o):0}catch(o){return 0}},getDeadline:async(t,n=!1)=>{try{const o=await e({contractName:u.TRUTH_BOX,functionName:"getDeadline",args:[t],force:n});return o?Number(o):0}catch(o){return 0}},getPrice:async(t,n=!1)=>{try{const o=await e({contractName:u.TRUTH_BOX,functionName:"getPrice",args:[t],force:n});return o?Number(o):0}catch(o){return 0}},getPrivateData:async(t,n)=>{try{const o=await e({contractName:u.TRUTH_BOX,functionName:"getPrivateData",args:[t,n]});return o?String(o):""}catch(o){return""}},blacklistSupply:async(t=!1)=>{try{const n=await e({contractName:u.TRUTH_BOX,functionName:"blacklistSupply",args:[],force:t});return n?Number(n):0}catch(n){return 0}},completeCounts:async(t=!1)=>{try{const n=await e({contractName:u.TRUTH_BOX,functionName:"completeCounts",args:[],force:t});return n?Number(n):0}catch(n){return 0}},isInBlacklist:async(t,n=!1)=>{try{const o=await e({contractName:u.TRUTH_BOX,functionName:"isInBlacklist",args:[t],force:n});return!!o&&Boolean(o)}catch(o){return!1}}}}();return{checkPrivateKeyExist:o=>!!n(o,e,t),getPrivateKey:async l=>{const c=n(l,e,t);if(c)return c;let d=null;if(r)d=i.token;else{const e=await s({statement:"I want to view the private data of the box",resources:[l]});e&&(d=e.token)}if(d){const n=await a(l,d);if(n)return o(l,n,e,t),n}return null}}},dt=()=>{const[e,t]=s.useState(null),{decryptList:n,decrypt:o}=(()=>{const[e,t]=s.useState(null),[n,o]=s.useState(null),[i,r]=s.useState(null),[a,l]=s.useState(!1);return{decrypt:async(e,n,o,i)=>{l(!0),r(null);try{const s=await ce.decrypt(e,n,o,i);if(s.success&&s.data)return t(s.data),s.data;{const e=s.error||"Decryption failed";return r(e),null}}catch(s){const e=s instanceof Error?s.message:"Unknown decryption error";return r(e),null}finally{l(!1)}},decryptList:async(e,t,n)=>{l(!0),r(null);try{const i=await ce.decryptList(e,t,n);if(i.success&&i.data)return o(i.data),i.data;{const e=i.error||"Decryption failed";return r(e),null}}catch(i){const e=i instanceof Error?i.message:"Unknown decryption error";return r(e),null}finally{l(!1)}},data:e,dataList:n,error:i,isLoading:a}})();return{decryptionViewFile:async(e,i)=>{try{if(!(i.publicKey&&i.encryptionFileCID&&i.encryptionPasswords&&i.encryptionSlicesMetadataCID))throw new Error("Metadata box is required!");const r=i.encryptionFileCID.map(e=>({iv_bytes:e.fileCID_iv,encrypted_bytes:e.fileCID_encryption})),s=await n(i.publicKey,e,r),a=await o(i.publicKey,e,i.encryptionSlicesMetadataCID.slicesMetadataCID_iv,i.encryptionSlicesMetadataCID.slicesMetadataCID_encryption),l={fileCIDList:s||[],password:await o(i.publicKey,e,i.encryptionPasswords.password_iv,i.encryptionPasswords.password_encryption)||"",slicesMetadataCID:a||""};return t(l),l}catch(r){throw r}},data:e}},ut={key:"privateKey",title:"Reading private key"},ht={key:"decrypt",title:"Decrypting file information"},ft={key:"done",title:"Done"},pt=({onClose:e})=>{var t;const{box:n,metadataBox:o}=ze();if(!n||!o)return null;const{steps:i,isProcessing:r,errorMsg:a,result:l,attemptCount:c,maxRetry:d,start:u,retry:h}=(()=>{const{getPrivateKey:e}=ct(),{decryptionViewFile:t}=dt(),[n,o]=s.useState([{...ut,status:"wait",description:"Reading private key"},{...ht,status:"wait",description:"Decrypting file information"},{...ft,status:"wait",description:"Done"}]),[i,r]=s.useState(!1),[a,l]=s.useState(null),[c,d]=s.useState(null),u=s.useRef(0),h=s.useCallback(()=>{o([{...ut,status:"wait",description:"Reading private key"},{...ht,status:"wait",description:"Decrypting file information"},{...ft,status:"wait",description:"Done"}]),d(null),l(null)},[]),f=s.useCallback((e,t,n)=>{o(o=>o.map(o=>o.key===e?{...o,status:t,description:n??o.description}:o))},[]),p=s.useCallback(async(o,i)=>{var s;if(!o||!i)return d("Box or metadata not found, cannot decrypt."),void f("privateKey","error","Missing necessary data");if(u.current>=5)d("Maximum attempts reached (5 times), please try again later.");else{u.current+=1,r(!0),d(null),f("privateKey","process","Reading private key…");try{const n=o.privateKey?o.privateKey:await e(o.id);if(!n)throw new Error("Cannot read private key, please confirm that the signature authorization has been completed.");f("privateKey","finish","Private key read completed"),f("decrypt","process","Decrypting file information…");const r=await t(n,i);l(r),f("decrypt","finish","Decryption successful"),f("done","finish","Done")}catch(a){const e=(null==a?void 0:a.message)||"Unknown error, please try again later.";d(e),"finish"!==(null==(s=n.find(e=>"privateKey"===e.key))?void 0:s.status)?f("privateKey","error",e):f("decrypt","error",e)}finally{r(!1)}}},[t,e,f,n]),g=s.useCallback((e,t)=>{u.current<5&&p(e,t)},[p]);return{steps:n,isProcessing:i,errorMsg:c,result:a,attemptCount:u.current,maxRetry:5,start:p,retry:g,reset:h}})(),f="create"===(null==o?void 0:o.mintMethod),p=s.useRef(!1);s.useEffect(()=>{p.current||n&&o&&(p.current=!0,u(n,o))},[n,o,u]);const g="finish"===(null==(t=i.find(e=>"decrypt"===e.key))?void 0:t.status),m=Math.max(0,d-c);/* @__PURE__ */
return b.jsxs(ie,{title:"View File",centered:!0,open:!0,closable:!1,maskClosable:!1,onOk:()=>{},onCancel:()=>{e()},okButtonProps:{disabled:!0},cancelButtonProps:{disabled:!1},okText:"Download (Soon)",cancelText:"Close",width:520,children:[!f&&/* @__PURE__ */b.jsx(j,{type:"warning",showIcon:!0,message:"This Box is in createAndPublish mode, you can view the file directly in the Published area.",className:"mb-4"}),
/* @__PURE__ */b.jsx(he,{direction:"vertical",items:i.map(e=>({title:e.title,status:e.status,description:e.description})),className:"mb-4"}),a&&/* @__PURE__ */b.jsx(j,{type:"error",showIcon:!0,message:"Operation failed",description:a,className:"mb-3"}),
/* @__PURE__ */b.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[
/* @__PURE__ */b.jsxs(F,{children:["Attempts: ",c,"/",d,"（Remaining ",m," times）"]}),
/* @__PURE__ */b.jsx(C,{type:"link",size:"small",onClick:()=>h(n,o),disabled:r||0===m,className:"px-0",children:"Continue request"})]}),r&&/* @__PURE__ */b.jsx(F,{children:"Processing, please wait patiently…"}),g&&/* @__PURE__ */b.jsxs("div",{className:"flex flex-col gap-2",children:[
/* @__PURE__ */b.jsx(lt,{label:"File CID",type:"cid",cidList:(null==l?void 0:l.fileCIDList)||[]}),
/* @__PURE__ */b.jsx(lt,{label:"Password",type:"password",cidList:[(null==l?void 0:l.password)||""]}),
/* @__PURE__ */b.jsx(lt,{label:"Slices Metadata CID",type:"cid",cidList:[(null==l?void 0:l.slicesMetadataCID)||""]})]})]})},gt=N.memo(({onClick:e,className:t})=>{const[n,o]=s.useState(!1),i=Je(tt.viewFile);/* @__PURE__ */
return b.jsxs(Be,{controller:i,className:t,onClick:()=>{null==e||e(),o(!0)},children:[
/* @__PURE__ */b.jsx(F,{children:"You can view the confidential file here."}),n&&/* @__PURE__ */b.jsx(pt,{onClose:()=>o(!1)})]})}),mt=N.memo(({onClick:e,className:t})=>{const n=Je(tt.publish);/* @__PURE__ */
return b.jsx(Be,{controller:n,className:t,onClick:e})}),yt=()=>{const{box:e,orderAmountsData:t}=ze(),{address:n}=y();if(!e||!n)/* @__PURE__ */
return b.jsx("div",{children:"loading..."});const o=null==t?void 0:t.find(t=>t.token===e.acceptedToken),i=s.useMemo(()=>o?Number(o.amount):0,[o]),r=s.useMemo(()=>e.price?Math.max(0,Number(e.price)-i):0,[e.price,i]),a=P(e.acceptedToken);/* @__PURE__ */
return b.jsxs(b.Fragment,{children:[i>0&&/* @__PURE__ */b.jsxs("div",{style:{marginBottom:"5px"},children:[
/* @__PURE__ */b.jsx(F,{children:"In the Auction, you paid:"}),
/* @__PURE__ */b.jsx(H,{price:i,symbol:null==a?void 0:a.symbol,decimals:null==a?void 0:a.decimals})]}),r>0&&/* @__PURE__ */b.jsxs("div",{children:[
/* @__PURE__ */b.jsx(F,{children:"You need to pay:"}),
/* @__PURE__ */b.jsx(H,{price:r,symbol:null==a?void 0:a.symbol,decimals:null==a?void 0:a.decimals})]})]})},xt={allowance:{title:"Checking allowance...",descriptions:{idle:"Checking allowance...",pending:"Checking allowance...",success:"Allowance is enough",error:"Checking allowance failed"}},approve:{title:"Approve",descriptions:{idle:"Need to approve",pending:"Approving...",success:"Approve success",error:"Approve failed"}},buy:{title:"Buy",descriptions:{idle:"Ready to buy",pending:"Executing buy operation...",success:"Buy operation success",error:"Buy operation failed"}},bid:{title:"Bid",descriptions:{idle:"Ready to bid",pending:"Executing bid operation...",success:"Bid operation success",error:"Bid operation failed"}},payConfiFee:{title:"PayConfiFee",descriptions:{idle:"Ready to pay confidentiality fee",pending:"Executing pay confidentiality fee operation...",success:"Pay confidentiality fee operation success",error:"Pay confidentiality fee operation failed"}}},vt=(e,t)=>{const n=[{stepKey:"allowance",title:xt.allowance.title,description:xt.allowance.descriptions.success,status:"wait"}];return t||n.push({stepKey:"approve",title:xt.approve.title,description:xt.approve.descriptions.idle,status:"wait"}),"buy"===e?n.push({stepKey:"buy",title:xt.buy.title,description:xt.buy.descriptions.idle,status:"wait"}):"bid"===e?n.push({stepKey:"bid",title:xt.bid.title,description:xt.bid.descriptions.idle,status:"wait"}):"payConfiFee"===e&&n.push({stepKey:"payConfiFee",title:xt.payConfiFee.title,description:xt.payConfiFee.descriptions.idle,status:"wait"}),n};const bt=({open:e,onClose:t,boxId:n,tokenAddress:o,amount:i,functionName:r})=>{const a=re(o),{steps:l,checkAllowance:c,handleApproveClick:d,handleBuyBidClick:u,isLoading:h,isSuccessed:f,status:p,currentStepItem:g,formattedAllowanceAmount:m}=((e,t,n,o)=>{const i=oe(),{address:r}=I(),{readAllowance:a,allowanceAmount:l,isEnough:c}=fe(),{writeCustormV2:d,status:u,isLoading:h,isSuccessed:f}=Te(e),[p,g]=s.useState({steps:vt(o,!1),currentIndex:0}),m=s.useCallback(e=>{const t=vt(o,e),n=t.length>1?1:0;g({steps:t,currentIndex:n})},[o]),y=s.useCallback((e,t)=>{g(n=>{const o=n.steps.findIndex(t=>t.stepKey===e);if(-1===o)return n;const i=(e=>{switch(e){case"pending":return"process";case"success":return"finish";case"error":return"error";default:return"wait"}})(t),r=xt[e].descriptions[t],s=n.steps.map((e,t)=>t===o?{...e,status:i,description:r}:e);let a=n.currentIndex;const l=o===n.currentIndex,c=o<s.length-1;return"finish"===i&&l&&c&&(a=o+1),{steps:s,currentIndex:a}})},[]),{steps:x,currentIndex:v}=p,b=x[v]??x[x.length-1],w=s.useCallback(async e=>{if(!(r&&t&&n&&i.FundManager.address))return;const o=pe(n,t.decimals);try{const n=await a(t.address,r,i.FundManager.address,o);"init"!==e&&"approve"!==e||m(n.isEnough),y("allowance","success")}catch(s){y("allowance","error")}},[t,n,a,r,m,y]),S=s.useCallback(async(e=!1)=>{if(!t||!n||!i.FundManager.address)return;const o=e?A:pe(n,t.decimals);try{y("approve","pending");const e=D(t.address);await d({contract:e,functionName:"approve",args:[i.FundManager.address,o]}),y("approve","success")}catch(r){y("approve","error")}},[t,n,d,w,y]),C=s.useCallback(async()=>{if(!t||!n||!i)return;let r=i.Exchange;"payConfiFee"===o&&(r=i.TruthBox);try{y(o,"pending"),await d({contract:r,functionName:o,args:[e]}),y(o,"success")}catch(s){y(o,"error")}},[t,n,d,o,e,y]);return{steps:x,currentIndex:v,currentStepItem:b,initializeSteps:m,updateStepStatus:y,checkAllowance:w,handleApproveClick:S,handleBuyBidClick:C,isLoading:h,isEnough:c,isSuccessed:f,status:u,allowanceAmount:l,formattedAllowanceAmount:z(l,(null==t?void 0:t.decimals)??18)}})(n,a,i,r);if(!a||!i)return null;const y=function(e){if(/[eE]/.test(e)){const[t,n]=e.split(/[eE]/),o=parseInt(n,10),[i,r=""]=t.split("."),s=r.length;if(i.length,o>0){const e=i+r,t=o-s;if(t>0)return BigInt(e+"0".repeat(t));if(t<0){const n=e.slice(0,e.length+t);return BigInt(n||"0")}return BigInt(e)}return BigInt(i)}const t=e.split(".")[0];return BigInt(t)}(i),x=z(y,a.decimals),v="approve"===g.stepKey&&"finish"!==g.status,S="buy"===g.stepKey||"bid"===g.stepKey||"payConfiFee"===g.stepKey,N=s.useMemo(()=>l.map(({stepKey:e,...t})=>({key:e,...t})),[l]);s.useEffect(()=>{e&&c("init")},[e,o]);const k=()=>{t()};/* @__PURE__ */
return b.jsx(ie,{title:"Wrap operation process",open:e,onCancel:k,closable:"pending"!==p,maskClosable:"pending"!==p,footer:[
/* @__PURE__ */b.jsx(C,{onClick:k,disabled:"pending"===p,children:f?"Complete":"Cancel"},"close")],width:450,centered:!0,children:/* @__PURE__ */b.jsxs(w,{direction:"vertical",size:"large",style:{width:"100%"},children:[
/* @__PURE__ */b.jsx(j,{type:"info",message:/* @__PURE__ */b.jsxs(w,{direction:"vertical",size:"small",children:[
/* @__PURE__ */b.jsxs(F,{type:"info",children:["You are about to ",r," this box."]}),
/* @__PURE__ */b.jsxs(F,{children:["Price: ",x," ",null==a?void 0:a.symbol]})]}),showIcon:!0}),
/* @__PURE__ */b.jsx(he,{direction:"vertical",items:N,size:"small"}),v&&/* @__PURE__ */b.jsxs(w,{direction:"vertical",size:"middle",style:{width:"100%"},children:[
/* @__PURE__ */b.jsx(j,{type:"warning",message:/* @__PURE__ */b.jsx(w,{direction:"vertical",size:"small",children:/* @__PURE__ */b.jsxs(F,{children:["Allowance is not enough. Current: ",m,", Required: ",i]})}),showIcon:!0}),
/* @__PURE__ */b.jsxs(C,{type:"primary",onClick:()=>d(!1),loading:h,disabled:!v,block:!0,children:["Approve ",x," ",null==a?void 0:a.symbol]}),
/* @__PURE__ */b.jsx(C,{type:"primary",onClick:()=>d(!0),loading:h,disabled:!v,block:!0,children:"Approve Max(uint256)"})]}),"approve"===g.stepKey&&"process"===g.status&&/* @__PURE__ */b.jsx(j,{type:"info",message:"Approving token...",showIcon:!0}),S&&/* @__PURE__ */b.jsx(C,{type:"primary",onClick:u,loading:h,disabled:!S,block:!0,children:r}),l.some(e=>"error"===e.status)&&/* @__PURE__ */b.jsx(j,{type:"error",message:"Operation failed",description:"Please check network connection and wallet status, then try again.",showIcon:!0}),f&&/* @__PURE__ */b.jsx(j,{type:"success",message:"Wrap operation completed successfully",showIcon:!0})]})})},wt=N.memo(({onClick:e,className:t})=>{var n;const o=Je(tt.bid),{box:i}=ze(),[r,a]=s.useState(!1),l=null==i?void 0:i.acceptedToken,c=s.useMemo(()=>{const e=null==i?void 0:i.price;return e?e.toString():"0"},[null==i?void 0:i.price]);/* @__PURE__ */
return b.jsxs(Be,{controller:o,className:t,onClick:()=>{null==e||e(),a(!0)},children:[
/* @__PURE__ */b.jsx("div",{className:"w-full mt-2 flex-col",children:/* @__PURE__ */b.jsx(yt,{})}),l&&/* @__PURE__ */b.jsx(bt,{open:r,onClose:()=>a(!1),boxId:(null==(n=null==i?void 0:i.id)?void 0:n.toString())||"",tokenAddress:l,amount:c,functionName:"bid"})]})}),St=N.memo(({onClick:e,className:t})=>{var n;const o=Je(tt.buy),{box:i}=ze(),[r,a]=s.useState(!1),l=null==i?void 0:i.acceptedToken,c=s.useMemo(()=>{const e=null==i?void 0:i.price;return e?e.toString():"0"},[null==i?void 0:i.price]);/* @__PURE__ */
return b.jsx(Be,{controller:o,className:t,onClick:()=>{null==e||e(),a(!0)},children:l&&/* @__PURE__ */b.jsx(bt,{open:r,onClose:()=>a(!1),boxId:(null==(n=null==i?void 0:i.id)?void 0:n.toString())||"",tokenAddress:l,amount:c,functionName:"buy"})})}),Ct=({options:e,value:t,defaultValue:n,onChange:o,placeholder:i="Please select",className:r,disabled:a=!1,searchable:l=!0,searchPlaceholder:c="Search...",filterFunction:d,onSearch:u,noResultsText:h="No matching results",allowClear:f=!0,maxDisplayOptions:p=10})=>{const[g,m]=s.useState(""),[y,x]=s.useState(""),v=void 0!==t;v||e.find(e=>String(e.value)===y),s.useEffect(()=>{n&&!v&&x(String(n.value))},[n,v]),s.useEffect(()=>{v&&t?x(String(t.value)):v&&!t&&x("")},[t,v]);const w=(e,t)=>{const n=t.toLowerCase().trim();return!n||(e.name.toLowerCase().includes(n)||e.symbol&&e.symbol.toLowerCase().includes(n)||String(e.value).toLowerCase().includes(n))},C=N.useMemo(()=>{if(!l||!g)return e.slice(0,p);const t=d||w;return e.filter(e=>t(e,g)).slice(0,p)},[e,g,l,d,p]),k=e=>/* @__PURE__ */b.jsxs("div",{className:"flex items-center gap-3 w-full",children:[e.icon&&/* @__PURE__ */b.jsx("img",{src:e.icon,alt:"icon",className:"w-5 h-5 rounded-full flex-shrink-0 object-cover"}),
/* @__PURE__ */b.jsx("span",{className:"truncate font-mono flex-1",children:e.name}),e.symbol&&/* @__PURE__ */b.jsx("span",{className:"text-muted-foreground font-mono text-sm flex-shrink-0",children:e.symbol})]}),E=C.map(e=>({label:k(e),value:String(e.value)}));/* @__PURE__ */
return b.jsx("div",{className:S("w-full",r),children:/* @__PURE__ */b.jsx(me,{value:y||void 0,onChange:t=>(t=>{const n=e.find(e=>String(e.value)===t);v||x(t),null==o||o(n||null)})(t||""),disabled:a||0===E.length,placeholder:i,allowClear:f,onClear:()=>{v||x(""),null==o||o(null),m("")},showSearch:l,onSearch:e=>{m(e),u&&u(e)},filterOption:!1,options:E,notFoundContent:g?h:"No options",className:"w-full",optionLabelProp:"label"})})},Nt=({onChange:e})=>{const t=se(),[n,o]=s.useState(null),i=t.filter(e=>e.canAcceptToken).map(e=>({index:e.index,name:e.name,symbol:e.symbol,value:e.address,decimals:e.decimals}));return s.useEffect(()=>{o(i[0])},[]),/* @__PURE__ */b.jsx(Ct,{options:i,value:n,onChange:t=>{e(t),o(t)},placeholder:"Please select a token"})},kt=({onClose:e,listedMode:t,controller:n})=>{const o=Ie(e=>e.updateModalStatus),{roles:i}=Ie(e=>e.userState),{boxId:r,box:a}=ze(),l=R[0].address,c=R[0].decimals,[d,u]=s.useState(""),[h,f]=s.useState(l),[p,g]=s.useState(c);s.useEffect(()=>{o("SellAuction","open")},[]);const m=()=>{o("SellAuction","close"),e()};if(!a)/* @__PURE__ */
return b.jsx("div",{children:"loading..."});const y=i.includes("Minter");/* @__PURE__ */
return b.jsx(ie,{title:"Sell"===t?"Sell Truth Box":"Auction Truth Box",centered:!0,open:!0,closable:!1,maskClosable:!1,onOk:async()=>{if(n.isSuccessed)return void m();if(!a)return;let e=h,t=BigInt(0);if(i.includes("Minter")){if(!h)return void Z.error("Token is required");t=d&&Number(d)>0?pe(String(d),p):BigInt(0)}await n.execute({customArgs:{acceptedToken:e,price:t}})},onCancel:m,okButtonProps:{disabled:n.isLoading},cancelButtonProps:{disabled:n.isLoading},okText:n.isLoading?"Processing...":n.isSuccessed?"Success":"Submit",cancelText:"Close",width:450,children:/* @__PURE__ */b.jsxs("div",{className:"flex flex-col gap-2",children:[
/* @__PURE__ */b.jsxs("div",{className:"flex flex-col gap-2 text-foreground",children:[
/* @__PURE__ */b.jsxs(F,{children:["boxId:",r]}),
/* @__PURE__ */b.jsxs("div",{className:"flex flex-row gap-2 items-baseline",children:[
/* @__PURE__ */b.jsx(F,{children:"Current Price:"}),
/* @__PURE__ */b.jsx(H,{price:a.price,symbol:R[0].symbol,decimals:R[0].decimals})]}),
/* @__PURE__ */b.jsx("hr",{className:"my-2"}),y?/* @__PURE__ */b.jsxs("div",{className:"flex flex-col gap-2",children:[
/* @__PURE__ */b.jsxs("div",{className:"flex flex-col gap-2 items-start",children:[
/* @__PURE__ */b.jsx(F,{children:"Accpet Token:"}),
/* @__PURE__ */b.jsx(Nt,{onChange:e=>{f(null==e?void 0:e.value),g(null==e?void 0:e.decimals)}})]}),
/* @__PURE__ */b.jsxs("div",{className:"flex flex-col gap-2 items-baseline",children:[
/* @__PURE__ */b.jsx(F,{children:"Price:"}),
/* @__PURE__ */b.jsx(de,{onChange:e=>(e=>{u(null==e?"":String(e))})(e),value:d?Number(d):void 0,placeholder:"Enter price"})]}),
/* @__PURE__ */b.jsx(F,{children:"If you don't enter the price, the default price will be used."})]}):/* @__PURE__ */b.jsx(F,{children:"Only Minter can set price!"})]}),
/* @__PURE__ */b.jsx("hr",{className:"my-2"})]})})},Et=N.memo(({onClick:e,className:t})=>{const[n,o]=s.useState(!1),i=Je(tt.sell),{roles:r}=Ie(e=>e.userState),{helperRewardRate:a}=k();/* @__PURE__ */
return b.jsxs(Be,{controller:i,className:t,onClick:()=>{null==e||e(),i.isDisabled||o(!0)},children:[
/* @__PURE__ */b.jsx("div",{className:"flex flex-col items-start",children:r.includes("Minter")?/* @__PURE__ */b.jsx(F,{children:"You can sell or auction the Box at any time."}):/* @__PURE__ */b.jsxs(F,{children:["Sell or auction the Box, you can get the Rewards, the Rewards is ",a,"% of the Box price."]})}),n&&/* @__PURE__ */b.jsx(kt,{onClose:()=>{o(!1)},listedMode:"Sell",controller:i})]})}),Mt=N.memo(({onClick:e,className:t})=>{const[n,o]=s.useState(!1),i=Je(tt.auction),{initialAuctionPeriod:r}=k();/* @__PURE__ */
return b.jsxs(Be,{controller:i,className:t,onClick:()=>{null==e||e(),o(!0)},children:[
/* @__PURE__ */b.jsxs(F,{children:["Start the auction, the initial auction period is ",r/24/3600," days."]}),n&&/* @__PURE__ */b.jsx(kt,{onClose:()=>{o(!1)},listedMode:"Auction",controller:i})]})}),_t=N.memo(({onClick:e,className:t})=>{const n=Je(tt.requestRefund),{box:o}=ze();/* @__PURE__ */
return b.jsx(Be,{controller:n,className:t,onClick:e,children:/* @__PURE__ */b.jsx("div",{className:S("flex flex-col items-start"),children:/* @__PURE__ */b.jsxs(F,{type:"info",children:["Request Refund Deadline: ",ge(Number(null==o?void 0:o.requestRefundDeadline))]})})})}),jt=N.memo(({onClick:e,className:t})=>{var n;const o=Je(tt.payConfiFee),{box:i}=ze(),{confidentialityFeeExtensionPeriod:r,incrementRate:a}=k(),[l,c]=s.useState(!1),d=null==i?void 0:i.acceptedToken,u=s.useMemo(()=>{const e=null==i?void 0:i.price;return e?e.toString():"0"},[null==i?void 0:i.price]);/* @__PURE__ */
return b.jsxs(Be,{controller:o,className:t,onClick:()=>{null==e||e(),c(!0)},children:[
/* @__PURE__ */b.jsxs("div",{className:S("flex flex-col items-start"),children:[
/* @__PURE__ */b.jsxs(F,{children:["Pay the confidentiality fee to extend the confidentiality period: ",r/24/3600," days"]}),
/* @__PURE__ */b.jsxs(F,{children:["The increment rate: ",a,"%"]})]}),d&&/* @__PURE__ */b.jsx(bt,{open:l,onClose:()=>c(!1),boxId:(null==(n=null==i?void 0:i.id)?void 0:n.toString())||"",tokenAddress:d,amount:u,functionName:"payConfiFee"})]})}),Pt=({onClose:e})=>{const{boxId:t,box:n}=ze(),o=Ie(e=>e.updateModalStatus),{writeCustormV2:i,error:r,isLoading:a,isSuccessed:l}=Te(t),c=oe(),[d,u]=s.useState(!1),[h,f]=s.useState("Submit"),[p,g]=s.useState("");if(!n)/* @__PURE__ */
return b.jsx("div",{children:"loading..."});s.useEffect(()=>{o("ExtendDeadline","open")},[]),s.useEffect(()=>{l?(u(!1),f("Success")):a?(u(!0),f("wait...")):r&&(u(!1),f("Submit"))},[r,a,l]);/* @__PURE__ */
return b.jsxs(ie,{title:"Extend Deadline",centered:!0,open:!0,closable:!1,maskClosable:!1,onOk:async()=>{if(p&&Number(p)>0){const e=24*Number(p)*60*60;await i({contract:c.TruthBox,functionName:"extendDeadline",args:[t,e]})}else alert("Empty data!")},onCancel:()=>{o("ExtendDeadline","close"),e()},okButtonProps:{disabled:d},cancelButtonProps:{disabled:d},okText:h,cancelText:"Close",width:450,children:[
/* @__PURE__ */b.jsxs("div",{className:"flex flex-col gap-2",children:[
/* @__PURE__ */b.jsxs("div",{className:"flex flex-row gap-2 items-baseline",children:[
/* @__PURE__ */b.jsx(F,{children:"Current boxId:"}),
/* @__PURE__ */b.jsx(F,{children:t})]}),
/* @__PURE__ */b.jsx("div",{className:"flex flex-col gap-2",children:/* @__PURE__ */b.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[
/* @__PURE__ */b.jsx(F,{children:"Days:"}),
/* @__PURE__ */b.jsx("div",{className:"flex flex-row w-full",children:/* @__PURE__ */b.jsx(de,{value:p,suffix:"days",precision:0,min:"1",step:10,placeholder:"Input timestamp",onChange:e=>(e=>{g(e)})(e||"")})})]})})]}),
/* @__PURE__ */b.jsx("hr",{className:"my-2"})]})},It=N.memo(({onClick:e,className:t})=>{const[n,o]=s.useState(!1),i=Je(tt.extendDeadline);/* @__PURE__ */
return b.jsx(Be,{controller:i,className:t,onClick:()=>{null==e||e(),i.isDisabled||o(!0)},children:n&&/* @__PURE__ */b.jsx(Pt,{onClose:()=>{o(!1)}})})}),At=({})=>{const{box:e}=ze();return e?/* @__PURE__ */b.jsxs("div",{className:"flex flex-col items-start justify-center gap-4",children:[
/* @__PURE__ */b.jsx(Et,{}),
/* @__PURE__ */b.jsx(Mt,{}),
/* @__PURE__ */b.jsx(It,{}),
/* @__PURE__ */b.jsx(mt,{}),
/* @__PURE__ */b.jsx(gt,{})]}):/* @__PURE__ */b.jsx("div",{children:"loading..."})},Dt=({})=>{Ie(e=>e);const{box:e}=ze();return e?/* @__PURE__ */b.jsxs("div",{className:"flex flex-col items-start justify-center gap-4",children:[!e.buyerId&&Number(e.deadline)<Math.floor(Date.now()/1e3)&&/* @__PURE__ */b.jsx("div",{className:"mb-4",children:/* @__PURE__ */b.jsx(j,{type:"warning",message:"Warning",description:"No one bought, the transaction is over, please public this Truth Box"})}),
/* @__PURE__ */b.jsx(St,{}),
/* @__PURE__ */b.jsx(mt,{}),
/* @__PURE__ */b.jsx(gt,{})]}):/* @__PURE__ */b.jsx("div",{children:"loading..."})},zt=({})=>{const e=Ie(e=>e),{roles:t}=e.userState,{box:n,biddersIds:o}=ze();return n?/* @__PURE__ */b.jsxs("div",{className:"flex flex-col items-start justify-center gap-4",children:[t.includes("Minter")||t.includes("Admin")||t.includes("Seller")||t.includes("Buyer")?/* @__PURE__ */b.jsx(j,{type:"warning",message:"Warning",description:"You are not authorized to participate in the bidding."}):/* @__PURE__ */b.jsx(b.Fragment,{}),0===(null==o?void 0:o.length)&&Number(n.deadline)<Math.floor(Date.now()/1e3)&&/* @__PURE__ */b.jsx("div",{className:"mb-4",children:/* @__PURE__ */b.jsx(j,{type:"warning",message:"Warning",description:"No one participated in the auction, the auction is over, please public this Truth Box"})}),
/* @__PURE__ */b.jsx(wt,{}),
/* @__PURE__ */b.jsx(mt,{}),
/* @__PURE__ */b.jsx(gt,{})]}):/* @__PURE__ */b.jsx("div",{children:"loading..."})},Rt=({})=>{const{box:e}=ze();return e?/* @__PURE__ */b.jsxs("div",{className:"flex flex-col items-start justify-center gap-4",children:[
/* @__PURE__ */b.jsx(we,{}),
/* @__PURE__ */b.jsx(_t,{}),
/* @__PURE__ */b.jsx(nt,{}),
/* @__PURE__ */b.jsx(gt,{})]}):/* @__PURE__ */b.jsx("div",{children:"loading..."})},Ot=({})=>{const{box:e}=ze();return e?/* @__PURE__ */b.jsxs("div",{className:"flex flex-col items-start justify-center gap-4",children:[
/* @__PURE__ */b.jsx(ot,{}),
/* @__PURE__ */b.jsx(it,{}),
/* @__PURE__ */b.jsx(rt,{}),
/* @__PURE__ */b.jsx(gt,{})]}):/* @__PURE__ */b.jsx("div",{children:"loading..."})},Bt=({})=>{const e=Ie(e=>e),{roles:t}=e.userState,{box:n}=ze();return n?/* @__PURE__ */b.jsxs("div",{className:"flex flex-col items-start justify-center gap-4",children:[t.includes("Buyer")&&/* @__PURE__ */b.jsx("div",{className:"mb-4",children:/* @__PURE__ */b.jsx(j,{type:"info",message:"Info",description:"Each time the confidentiality period is extended, an additional confidentiality fee must be paid."})}),
/* @__PURE__ */b.jsx(jt,{}),
/* @__PURE__ */b.jsx(mt,{}),
/* @__PURE__ */b.jsx(gt,{})]}):/* @__PURE__ */b.jsx("div",{children:"loading..."})},Lt=({})=>{const{box:e,metadataBox:t}=ze(),{decryptionViewFile:n}=dt();s.useRef(n).current=n;const[o,i]=s.useState([]),[r,a]=s.useState(null),l=(null==t?void 0:t.mintMethod)||"create",c="create"===l;if(s.useEffect(()=>t?"createAndPublish"===t.mintMethod?(i(t.fileList||[]),void a(null)):void 0:(i([]),void a("Metadata not found, cannot show download information.")),[t]),!e)/* @__PURE__ */
return b.jsx("div",{children:"loading..."});const d=o.length>0;/* @__PURE__ */
return b.jsxs("div",{className:"flex w-full flex-col items-start justify-center gap-4",children:[
/* @__PURE__ */b.jsxs(F,{children:["You can use the link to download the file. If the password is empty,",
/* @__PURE__ */b.jsx("br",{}),"it means that a password is not required."]}),t&&/* @__PURE__ */b.jsxs(F,{children:["The current Box uses the ",
/* @__PURE__ */b.jsx("strong",{className:"text-primary",children:l})," mode to publish,",c?" need to decrypt to get file CID / password.":" metadata directly contains file CID."]}),r&&/* @__PURE__ */b.jsx(j,{type:"error",showIcon:!0,message:"Cannot show file information",description:r}),o.length>0?/* @__PURE__ */b.jsx(lt,{label:"File CID",type:"cid",cidList:o}):/* @__PURE__ */b.jsx(gt,{}),!r&&t&&!d&&/* @__PURE__ */b.jsx(F,{children:"Metadata does not contain files to display."})]})};function Tt(e){if("string"==typeof e||"number"==typeof e)return""+e;let t="";if(Array.isArray(e))for(let n,o=0;o<e.length;o++)""!==(n=Tt(e[o]))&&(t+=(t&&" ")+n);else for(let n in e)e[n]&&(t+=(t&&" ")+n);return t}var $t={value:()=>{}};function Vt(){for(var e,t=0,n=arguments.length,o={};t<n;++t){if(!(e=arguments[t]+"")||e in o||/[\s.]/.test(e))throw new Error("illegal type: "+e);o[e]=[]}return new Ht(o)}function Ht(e){this._=e}function Ft(e,t){for(var n,o=0,i=e.length;o<i;++o)if((n=e[o]).name===t)return n.value}function Xt(e,t,n){for(var o=0,i=e.length;o<i;++o)if(e[o].name===t){e[o]=$t,e=e.slice(0,o).concat(e.slice(o+1));break}return null!=n&&e.push({name:t,value:n}),e}Ht.prototype=Vt.prototype={constructor:Ht,on:function(e,t){var n,o,i=this._,r=(o=i,(e+"").trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");if(n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),e&&!o.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:t}})),s=-1,a=r.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++s<a;)if(n=(e=r[s]).type)i[n]=Xt(i[n],e.name,t);else if(null==t)for(n in i)i[n]=Xt(i[n],e.name,null);return this}for(;++s<a;)if((n=(e=r[s]).type)&&(n=Ft(i[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new Ht(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,o,i=new Array(n),r=0;r<n;++r)i[r]=arguments[r+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(r=0,n=(o=this._[e]).length;r<n;++r)o[r].value.apply(t,i)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var o=this._[e],i=0,r=o.length;i<r;++i)o[i].value.apply(t,n)}};var Yt="http://www.w3.org/1999/xhtml";const Zt={svg:"http://www.w3.org/2000/svg",xhtml:Yt,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Kt(e){var t=e+="",n=t.indexOf(":");return n>=0&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),Zt.hasOwnProperty(t)?{space:Zt[t],local:e}:e}function Wt(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===Yt&&t.documentElement.namespaceURI===Yt?t.createElement(e):t.createElementNS(n,e)}}function qt(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function Gt(e){var t=Kt(e);return(t.local?qt:Wt)(t)}function Ut(){}function Qt(e){return null==e?Ut:function(){return this.querySelector(e)}}function Jt(){return[]}function en(e){return null==e?Jt:function(){return this.querySelectorAll(e)}}function tn(e){return function(){return null==(t=e.apply(this,arguments))?[]:Array.isArray(t)?t:Array.from(t);var t}}function nn(e){return function(){return this.matches(e)}}function on(e){return function(t){return t.matches(e)}}var rn=Array.prototype.find;function sn(){return this.firstElementChild}var an=Array.prototype.filter;function ln(){return Array.from(this.children)}function cn(e){return new Array(e.length)}function dn(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function un(e,t,n,o,i,r){for(var s,a=0,l=t.length,c=r.length;a<c;++a)(s=t[a])?(s.__data__=r[a],o[a]=s):n[a]=new dn(e,r[a]);for(;a<l;++a)(s=t[a])&&(i[a]=s)}function hn(e,t,n,o,i,r,s){var a,l,c,d=/* @__PURE__ */new Map,u=t.length,h=r.length,f=new Array(u);for(a=0;a<u;++a)(l=t[a])&&(f[a]=c=s.call(l,l.__data__,a,t)+"",d.has(c)?i[a]=l:d.set(c,l));for(a=0;a<h;++a)c=s.call(e,r[a],a,r)+"",(l=d.get(c))?(o[a]=l,l.__data__=r[a],d.delete(c)):n[a]=new dn(e,r[a]);for(a=0;a<u;++a)(l=t[a])&&d.get(f[a])===l&&(i[a]=l)}function fn(e){return e.__data__}function pn(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}function gn(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function mn(e){return function(){this.removeAttribute(e)}}function yn(e){return function(){this.removeAttributeNS(e.space,e.local)}}function xn(e,t){return function(){this.setAttribute(e,t)}}function vn(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function bn(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}function wn(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function Sn(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Cn(e){return function(){this.style.removeProperty(e)}}function Nn(e,t,n){return function(){this.style.setProperty(e,t,n)}}function kn(e,t,n){return function(){var o=t.apply(this,arguments);null==o?this.style.removeProperty(e):this.style.setProperty(e,o,n)}}function En(e,t){return e.style.getPropertyValue(t)||Sn(e).getComputedStyle(e,null).getPropertyValue(t)}function Mn(e){return function(){delete this[e]}}function _n(e,t){return function(){this[e]=t}}function jn(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}function Pn(e){return e.trim().split(/^|\s+/)}function In(e){return e.classList||new An(e)}function An(e){this._node=e,this._names=Pn(e.getAttribute("class")||"")}function Dn(e,t){for(var n=In(e),o=-1,i=t.length;++o<i;)n.add(t[o])}function zn(e,t){for(var n=In(e),o=-1,i=t.length;++o<i;)n.remove(t[o])}function Rn(e){return function(){Dn(this,e)}}function On(e){return function(){zn(this,e)}}function Bn(e,t){return function(){(t.apply(this,arguments)?Dn:zn)(this,e)}}function Ln(){this.textContent=""}function Tn(e){return function(){this.textContent=e}}function $n(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}function Vn(){this.innerHTML=""}function Hn(e){return function(){this.innerHTML=e}}function Fn(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}function Xn(){this.nextSibling&&this.parentNode.appendChild(this)}function Yn(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Zn(){return null}function Kn(){var e=this.parentNode;e&&e.removeChild(this)}function Wn(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function qn(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Gn(e){return function(){var t=this.__on;if(t){for(var n,o=0,i=-1,r=t.length;o<r;++o)n=t[o],e.type&&n.type!==e.type||n.name!==e.name?t[++i]=n:this.removeEventListener(n.type,n.listener,n.options);++i?t.length=i:delete this.__on}}}function Un(e,t,n){return function(){var o,i=this.__on,r=function(e){return function(t){e.call(this,t,this.__data__)}}(t);if(i)for(var s=0,a=i.length;s<a;++s)if((o=i[s]).type===e.type&&o.name===e.name)return this.removeEventListener(o.type,o.listener,o.options),this.addEventListener(o.type,o.listener=r,o.options=n),void(o.value=t);this.addEventListener(e.type,r,n),o={type:e.type,name:e.name,value:t,listener:r,options:n},i?i.push(o):this.__on=[o]}}function Qn(e,t,n){var o=Sn(e),i=o.CustomEvent;"function"==typeof i?i=new i(t,n):(i=o.document.createEvent("Event"),n?(i.initEvent(t,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function Jn(e,t){return function(){return Qn(this,e,t)}}function eo(e,t){return function(){return Qn(this,e,t.apply(this,arguments))}}dn.prototype={constructor:dn,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}},An.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var to=[null];function no(e,t){this._groups=e,this._parents=t}function oo(){return new no([[document.documentElement]],to)}function io(e){return"string"==typeof e?new no([[document.querySelector(e)]],[document.documentElement]):new no([[e]],to)}function ro(e,t){if(e=function(e){let t;for(;t=e.sourceEvent;)e=t;return e}(e),void 0===t&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var o=n.createSVGPoint();return o.x=e.clientX,o.y=e.clientY,[(o=o.matrixTransform(t.getScreenCTM().inverse())).x,o.y]}if(t.getBoundingClientRect){var i=t.getBoundingClientRect();return[e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop]}}return[e.pageX,e.pageY]}no.prototype=oo.prototype={constructor:no,select:function(e){"function"!=typeof e&&(e=Qt(e));for(var t=this._groups,n=t.length,o=new Array(n),i=0;i<n;++i)for(var r,s,a=t[i],l=a.length,c=o[i]=new Array(l),d=0;d<l;++d)(r=a[d])&&(s=e.call(r,r.__data__,d,a))&&("__data__"in r&&(s.__data__=r.__data__),c[d]=s);return new no(o,this._parents)},selectAll:function(e){e="function"==typeof e?tn(e):en(e);for(var t=this._groups,n=t.length,o=[],i=[],r=0;r<n;++r)for(var s,a=t[r],l=a.length,c=0;c<l;++c)(s=a[c])&&(o.push(e.call(s,s.__data__,c,a)),i.push(s));return new no(o,i)},selectChild:function(e){return this.select(null==e?sn:function(e){return function(){return rn.call(this.children,e)}}("function"==typeof e?e:on(e)))},selectChildren:function(e){return this.selectAll(null==e?ln:function(e){return function(){return an.call(this.children,e)}}("function"==typeof e?e:on(e)))},filter:function(e){"function"!=typeof e&&(e=nn(e));for(var t=this._groups,n=t.length,o=new Array(n),i=0;i<n;++i)for(var r,s=t[i],a=s.length,l=o[i]=[],c=0;c<a;++c)(r=s[c])&&e.call(r,r.__data__,c,s)&&l.push(r);return new no(o,this._parents)},data:function(e,t){if(!arguments.length)return Array.from(this,fn);var n,o=t?hn:un,i=this._parents,r=this._groups;"function"!=typeof e&&(n=e,e=function(){return n});for(var s=r.length,a=new Array(s),l=new Array(s),c=new Array(s),d=0;d<s;++d){var u=i[d],h=r[d],f=h.length,p=pn(e.call(u,u&&u.__data__,d,i)),g=p.length,m=l[d]=new Array(g),y=a[d]=new Array(g);o(u,h,m,y,c[d]=new Array(f),p,t);for(var x,v,b=0,w=0;b<g;++b)if(x=m[b]){for(b>=w&&(w=b+1);!(v=y[w])&&++w<g;);x._next=v||null}}return(a=new no(a,i))._enter=l,a._exit=c,a},enter:function(){return new no(this._enter||this._groups.map(cn),this._parents)},exit:function(){return new no(this._exit||this._groups.map(cn),this._parents)},join:function(e,t,n){var o=this.enter(),i=this,r=this.exit();return"function"==typeof e?(o=e(o))&&(o=o.selection()):o=o.append(e+""),null!=t&&(i=t(i))&&(i=i.selection()),null==n?r.remove():n(r),o&&i?o.merge(i).order():i},merge:function(e){for(var t=e.selection?e.selection():e,n=this._groups,o=t._groups,i=n.length,r=o.length,s=Math.min(i,r),a=new Array(i),l=0;l<s;++l)for(var c,d=n[l],u=o[l],h=d.length,f=a[l]=new Array(h),p=0;p<h;++p)(c=d[p]||u[p])&&(f[p]=c);for(;l<i;++l)a[l]=n[l];return new no(a,this._parents)},selection:function(){return this},order:function(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var o,i=e[t],r=i.length-1,s=i[r];--r>=0;)(o=i[r])&&(s&&4^o.compareDocumentPosition(s)&&s.parentNode.insertBefore(o,s),s=o);return this},sort:function(e){function t(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}e||(e=gn);for(var n=this._groups,o=n.length,i=new Array(o),r=0;r<o;++r){for(var s,a=n[r],l=a.length,c=i[r]=new Array(l),d=0;d<l;++d)(s=a[d])&&(c[d]=s);c.sort(t)}return new no(i,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var o=e[t],i=0,r=o.length;i<r;++i){var s=o[i];if(s)return s}return null},size:function(){let e=0;for(const t of this)++e;return e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,n=0,o=t.length;n<o;++n)for(var i,r=t[n],s=0,a=r.length;s<a;++s)(i=r[s])&&e.call(i,i.__data__,s,r);return this},attr:function(e,t){var n=Kt(e);if(arguments.length<2){var o=this.node();return n.local?o.getAttributeNS(n.space,n.local):o.getAttribute(n)}return this.each((null==t?n.local?yn:mn:"function"==typeof t?n.local?wn:bn:n.local?vn:xn)(n,t))},style:function(e,t,n){return arguments.length>1?this.each((null==t?Cn:"function"==typeof t?kn:Nn)(e,t,null==n?"":n)):En(this.node(),e)},property:function(e,t){return arguments.length>1?this.each((null==t?Mn:"function"==typeof t?jn:_n)(e,t)):this.node()[e]},classed:function(e,t){var n=Pn(e+"");if(arguments.length<2){for(var o=In(this.node()),i=-1,r=n.length;++i<r;)if(!o.contains(n[i]))return!1;return!0}return this.each(("function"==typeof t?Bn:t?Rn:On)(n,t))},text:function(e){return arguments.length?this.each(null==e?Ln:("function"==typeof e?$n:Tn)(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?Vn:("function"==typeof e?Fn:Hn)(e)):this.node().innerHTML},raise:function(){return this.each(Xn)},lower:function(){return this.each(Yn)},append:function(e){var t="function"==typeof e?e:Gt(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})},insert:function(e,t){var n="function"==typeof e?e:Gt(e),o=null==t?Zn:"function"==typeof t?t:Qt(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),o.apply(this,arguments)||null)})},remove:function(){return this.each(Kn)},clone:function(e){return this.select(e?qn:Wn)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,t,n){var o,i,r=function(e){return e.trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}})}(e+""),s=r.length;if(!(arguments.length<2)){for(a=t?Un:Gn,o=0;o<s;++o)this.each(a(r[o],t,n));return this}var a=this.node().__on;if(a)for(var l,c=0,d=a.length;c<d;++c)for(o=0,l=a[c];o<s;++o)if((i=r[o]).type===l.type&&i.name===l.name)return l.value},dispatch:function(e,t){return this.each(("function"==typeof t?eo:Jn)(e,t))},[Symbol.iterator]:function*(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var o,i=e[t],r=0,s=i.length;r<s;++r)(o=i[r])&&(yield o)}};const so={passive:!1},ao={capture:!0,passive:!1};function lo(e){e.stopImmediatePropagation()}function co(e){e.preventDefault(),e.stopImmediatePropagation()}function uo(e){var t=e.document.documentElement,n=io(e).on("dragstart.drag",co,ao);"onselectstart"in t?n.on("selectstart.drag",co,ao):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function ho(e,t){var n=e.document.documentElement,o=io(e).on("dragstart.drag",null);t&&(o.on("click.drag",co,ao),setTimeout(function(){o.on("click.drag",null)},0)),"onselectstart"in n?o.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const fo=e=>()=>e;function po(e,{sourceEvent:t,subject:n,target:o,identifier:i,active:r,x:s,y:a,dx:l,dy:c,dispatch:d}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:o,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:r,enumerable:!0,configurable:!0},x:{value:s,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:c,enumerable:!0,configurable:!0},_:{value:d}})}function go(e){return!e.ctrlKey&&!e.button}function mo(){return this.parentNode}function yo(e,t){return null==t?{x:e.x,y:e.y}:t}function xo(){return navigator.maxTouchPoints||"ontouchstart"in this}function vo(){var e,t,n,o,i=go,r=mo,s=yo,a=xo,l={},c=Vt("start","drag","end"),d=0,u=0;function h(e){e.on("mousedown.drag",f).filter(a).on("touchstart.drag",m).on("touchmove.drag",y,so).on("touchend.drag touchcancel.drag",x).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function f(s,a){if(!o&&i.call(this,s,a)){var l=v(this,r.call(this,s,a),s,a,"mouse");l&&(io(s.view).on("mousemove.drag",p,ao).on("mouseup.drag",g,ao),uo(s.view),lo(s),n=!1,e=s.clientX,t=s.clientY,l("start",s))}}function p(o){if(co(o),!n){var i=o.clientX-e,r=o.clientY-t;n=i*i+r*r>u}l.mouse("drag",o)}function g(e){io(e.view).on("mousemove.drag mouseup.drag",null),ho(e.view,n),co(e),l.mouse("end",e)}function m(e,t){if(i.call(this,e,t)){var n,o,s=e.changedTouches,a=r.call(this,e,t),l=s.length;for(n=0;n<l;++n)(o=v(this,a,e,t,s[n].identifier,s[n]))&&(lo(e),o("start",e,s[n]))}}function y(e){var t,n,o=e.changedTouches,i=o.length;for(t=0;t<i;++t)(n=l[o[t].identifier])&&(co(e),n("drag",e,o[t]))}function x(e){var t,n,i=e.changedTouches,r=i.length;for(o&&clearTimeout(o),o=setTimeout(function(){o=null},500),t=0;t<r;++t)(n=l[i[t].identifier])&&(lo(e),n("end",e,i[t]))}function v(e,t,n,o,i,r){var a,u,f,p=c.copy(),g=ro(r||n,t);if(null!=(f=s.call(e,new po("beforestart",{sourceEvent:n,target:h,identifier:i,active:d,x:g[0],y:g[1],dx:0,dy:0,dispatch:p}),o)))return a=f.x-g[0]||0,u=f.y-g[1]||0,function n(r,s,c){var m,y=g;switch(r){case"start":l[i]=n,m=d++;break;case"end":delete l[i],--d;case"drag":g=ro(c||s,t),m=d}p.call(r,e,new po(r,{sourceEvent:s,subject:f,target:h,identifier:i,active:m,x:g[0]+a,y:g[1]+u,dx:g[0]-y[0],dy:g[1]-y[1],dispatch:p}),o)}}return h.filter=function(e){return arguments.length?(i="function"==typeof e?e:fo(!!e),h):i},h.container=function(e){return arguments.length?(r="function"==typeof e?e:fo(e),h):r},h.subject=function(e){return arguments.length?(s="function"==typeof e?e:fo(e),h):s},h.touchable=function(e){return arguments.length?(a="function"==typeof e?e:fo(!!e),h):a},h.on=function(){var e=c.on.apply(c,arguments);return e===c?h:e},h.clickDistance=function(e){return arguments.length?(u=(e=+e)*e,h):Math.sqrt(u)},h}function bo(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function wo(e,t){var n=Object.create(e.prototype);for(var o in t)n[o]=t[o];return n}function So(){}po.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};var Co=.7,No=1/Co,ko="\\s*([+-]?\\d+)\\s*",Eo="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Mo="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",_o=/^#([0-9a-f]{3,8})$/,jo=new RegExp(`^rgb\\(${ko},${ko},${ko}\\)$`),Po=new RegExp(`^rgb\\(${Mo},${Mo},${Mo}\\)$`),Io=new RegExp(`^rgba\\(${ko},${ko},${ko},${Eo}\\)$`),Ao=new RegExp(`^rgba\\(${Mo},${Mo},${Mo},${Eo}\\)$`),Do=new RegExp(`^hsl\\(${Eo},${Mo},${Mo}\\)$`),zo=new RegExp(`^hsla\\(${Eo},${Mo},${Mo},${Eo}\\)$`),Ro={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Oo(){return this.rgb().formatHex()}function Bo(){return this.rgb().formatRgb()}function Lo(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=_o.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?To(t):3===n?new Ho(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?$o(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?$o(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=jo.exec(e))?new Ho(t[1],t[2],t[3],1):(t=Po.exec(e))?new Ho(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Io.exec(e))?$o(t[1],t[2],t[3],t[4]):(t=Ao.exec(e))?$o(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=Do.exec(e))?Wo(t[1],t[2]/100,t[3]/100,1):(t=zo.exec(e))?Wo(t[1],t[2]/100,t[3]/100,t[4]):Ro.hasOwnProperty(e)?To(Ro[e]):"transparent"===e?new Ho(NaN,NaN,NaN,0):null}function To(e){return new Ho(e>>16&255,e>>8&255,255&e,1)}function $o(e,t,n,o){return o<=0&&(e=t=n=NaN),new Ho(e,t,n,o)}function Vo(e,t,n,o){return 1===arguments.length?((i=e)instanceof So||(i=Lo(i)),i?new Ho((i=i.rgb()).r,i.g,i.b,i.opacity):new Ho):new Ho(e,t,n,null==o?1:o);var i}function Ho(e,t,n,o){this.r=+e,this.g=+t,this.b=+n,this.opacity=+o}function Fo(){return`#${Ko(this.r)}${Ko(this.g)}${Ko(this.b)}`}function Xo(){const e=Yo(this.opacity);return`${1===e?"rgb(":"rgba("}${Zo(this.r)}, ${Zo(this.g)}, ${Zo(this.b)}${1===e?")":`, ${e})`}`}function Yo(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Zo(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Ko(e){return((e=Zo(e))<16?"0":"")+e.toString(16)}function Wo(e,t,n,o){return o<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Go(e,t,n,o)}function qo(e){if(e instanceof Go)return new Go(e.h,e.s,e.l,e.opacity);if(e instanceof So||(e=Lo(e)),!e)return new Go;if(e instanceof Go)return e;var t=(e=e.rgb()).r/255,n=e.g/255,o=e.b/255,i=Math.min(t,n,o),r=Math.max(t,n,o),s=NaN,a=r-i,l=(r+i)/2;return a?(s=t===r?(n-o)/a+6*(n<o):n===r?(o-t)/a+2:(t-n)/a+4,a/=l<.5?r+i:2-r-i,s*=60):a=l>0&&l<1?0:s,new Go(s,a,l,e.opacity)}function Go(e,t,n,o){this.h=+e,this.s=+t,this.l=+n,this.opacity=+o}function Uo(e){return(e=(e||0)%360)<0?e+360:e}function Qo(e){return Math.max(0,Math.min(1,e||0))}function Jo(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}bo(So,Lo,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:Oo,formatHex:Oo,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return qo(this).formatHsl()},formatRgb:Bo,toString:Bo}),bo(Ho,Vo,wo(So,{brighter(e){return e=null==e?No:Math.pow(No,e),new Ho(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?Co:Math.pow(Co,e),new Ho(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Ho(Zo(this.r),Zo(this.g),Zo(this.b),Yo(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Fo,formatHex:Fo,formatHex8:function(){return`#${Ko(this.r)}${Ko(this.g)}${Ko(this.b)}${Ko(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:Xo,toString:Xo})),bo(Go,function(e,t,n,o){return 1===arguments.length?qo(e):new Go(e,t,n,null==o?1:o)},wo(So,{brighter(e){return e=null==e?No:Math.pow(No,e),new Go(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?Co:Math.pow(Co,e),new Go(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,o=n+(n<.5?n:1-n)*t,i=2*n-o;return new Ho(Jo(e>=240?e-240:e+120,i,o),Jo(e,i,o),Jo(e<120?e+240:e-120,i,o),this.opacity)},clamp(){return new Go(Uo(this.h),Qo(this.s),Qo(this.l),Yo(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=Yo(this.opacity);return`${1===e?"hsl(":"hsla("}${Uo(this.h)}, ${100*Qo(this.s)}%, ${100*Qo(this.l)}%${1===e?")":`, ${e})`}`}}));const ei=e=>()=>e;function ti(e){return 1===(e=+e)?ni:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(o){return Math.pow(e+o*t,n)}}(t,n,e):ei(isNaN(t)?n:t)}}function ni(e,t){var n=t-e;return n?function(e,t){return function(n){return e+n*t}}(e,n):ei(isNaN(e)?t:e)}const oi=function e(t){var n=ti(t);function o(e,t){var o=n((e=Vo(e)).r,(t=Vo(t)).r),i=n(e.g,t.g),r=n(e.b,t.b),s=ni(e.opacity,t.opacity);return function(t){return e.r=o(t),e.g=i(t),e.b=r(t),e.opacity=s(t),e+""}}return o.gamma=e,o}(1);function ii(e,t){t||(t=[]);var n,o=e?Math.min(t.length,e.length):0,i=t.slice();return function(r){for(n=0;n<o;++n)i[n]=e[n]*(1-r)+t[n]*r;return i}}function ri(e,t){var n,o=t?t.length:0,i=e?Math.min(o,e.length):0,r=new Array(i),s=new Array(o);for(n=0;n<i;++n)r[n]=hi(e[n],t[n]);for(;n<o;++n)s[n]=t[n];return function(e){for(n=0;n<i;++n)s[n]=r[n](e);return s}}function si(e,t){var n=/* @__PURE__ */new Date;return e=+e,t=+t,function(o){return n.setTime(e*(1-o)+t*o),n}}function ai(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function li(e,t){var n,o={},i={};for(n in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)n in e?o[n]=hi(e[n],t[n]):i[n]=t[n];return function(e){for(n in o)i[n]=o[n](e);return i}}var ci=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,di=new RegExp(ci.source,"g");function ui(e,t){var n,o,i,r=ci.lastIndex=di.lastIndex=0,s=-1,a=[],l=[];for(e+="",t+="";(n=ci.exec(e))&&(o=di.exec(t));)(i=o.index)>r&&(i=t.slice(r,i),a[s]?a[s]+=i:a[++s]=i),(n=n[0])===(o=o[0])?a[s]?a[s]+=o:a[++s]=o:(a[++s]=null,l.push({i:s,x:ai(n,o)})),r=di.lastIndex;return r<t.length&&(i=t.slice(r),a[s]?a[s]+=i:a[++s]=i),a.length<2?l[0]?function(e){return function(t){return e(t)+""}}(l[0].x):function(e){return function(){return e}}(t):(t=l.length,function(e){for(var n,o=0;o<t;++o)a[(n=l[o]).i]=n.x(e);return a.join("")})}function hi(e,t){var n,o,i=typeof t;return null==t||"boolean"===i?ei(t):("number"===i?ai:"string"===i?(n=Lo(t))?(t=n,oi):ui:t instanceof Lo?oi:t instanceof Date?si:(o=t,!ArrayBuffer.isView(o)||o instanceof DataView?Array.isArray(t)?ri:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?li:ai:ii))(e,t)}var fi,pi=180/Math.PI,gi={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function mi(e,t,n,o,i,r){var s,a,l;return(s=Math.sqrt(e*e+t*t))&&(e/=s,t/=s),(l=e*n+t*o)&&(n-=e*l,o-=t*l),(a=Math.sqrt(n*n+o*o))&&(n/=a,o/=a,l/=a),e*o<t*n&&(e=-e,t=-t,l=-l,s=-s),{translateX:i,translateY:r,rotate:Math.atan2(t,e)*pi,skewX:Math.atan(l)*pi,scaleX:s,scaleY:a}}function yi(e,t,n,o){function i(e){return e.length?e.pop()+" ":""}return function(r,s){var a=[],l=[];return r=e(r),s=e(s),function(e,o,i,r,s,a){if(e!==i||o!==r){var l=s.push("translate(",null,t,null,n);a.push({i:l-4,x:ai(e,i)},{i:l-2,x:ai(o,r)})}else(i||r)&&s.push("translate("+i+t+r+n)}(r.translateX,r.translateY,s.translateX,s.translateY,a,l),function(e,t,n,r){e!==t?(e-t>180?t+=360:t-e>180&&(e+=360),r.push({i:n.push(i(n)+"rotate(",null,o)-2,x:ai(e,t)})):t&&n.push(i(n)+"rotate("+t+o)}(r.rotate,s.rotate,a,l),function(e,t,n,r){e!==t?r.push({i:n.push(i(n)+"skewX(",null,o)-2,x:ai(e,t)}):t&&n.push(i(n)+"skewX("+t+o)}(r.skewX,s.skewX,a,l),function(e,t,n,o,r,s){if(e!==n||t!==o){var a=r.push(i(r)+"scale(",null,",",null,")");s.push({i:a-4,x:ai(e,n)},{i:a-2,x:ai(t,o)})}else 1===n&&1===o||r.push(i(r)+"scale("+n+","+o+")")}(r.scaleX,r.scaleY,s.scaleX,s.scaleY,a,l),r=s=null,function(e){for(var t,n=-1,o=l.length;++n<o;)a[(t=l[n]).i]=t.x(e);return a.join("")}}}var xi=yi(function(e){const t=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?gi:mi(t.a,t.b,t.c,t.d,t.e,t.f)},"px, ","px)","deg)"),vi=yi(function(e){return null==e?gi:(fi||(fi=document.createElementNS("http://www.w3.org/2000/svg","g")),fi.setAttribute("transform",e),(e=fi.transform.baseVal.consolidate())?mi((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):gi)},", ",")",")");function bi(e){return((e=Math.exp(e))+1/e)/2}const wi=function e(t,n,o){function i(e,i){var r,s,a=e[0],l=e[1],c=e[2],d=i[0],u=i[1],h=i[2],f=d-a,p=u-l,g=f*f+p*p;if(g<1e-12)s=Math.log(h/c)/t,r=function(e){return[a+e*f,l+e*p,c*Math.exp(t*e*s)]};else{var m=Math.sqrt(g),y=(h*h-c*c+o*g)/(2*c*n*m),x=(h*h-c*c-o*g)/(2*h*n*m),v=Math.log(Math.sqrt(y*y+1)-y),b=Math.log(Math.sqrt(x*x+1)-x);s=(b-v)/t,r=function(e){var o,i=e*s,r=bi(v),d=c/(n*m)*(r*(o=t*i+v,((o=Math.exp(2*o))-1)/(o+1))-function(e){return((e=Math.exp(e))-1/e)/2}(v));return[a+d*f,l+d*p,c*r/bi(t*i+v)]}}return r.duration=1e3*s*t/Math.SQRT2,r}return i.rho=function(t){var n=Math.max(.001,+t),o=n*n;return e(n,o,o*o)},i}(Math.SQRT2,2,4);var Si,Ci,Ni=0,ki=0,Ei=0,Mi=0,_i=0,ji=0,Pi="object"==typeof performance&&performance.now?performance:Date,Ii="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Ai(){return _i||(Ii(Di),_i=Pi.now()+ji)}function Di(){_i=0}function zi(){this._call=this._time=this._next=null}function Ri(e,t,n){var o=new zi;return o.restart(e,t,n),o}function Oi(){_i=(Mi=Pi.now())+ji,Ni=ki=0;try{!function(){Ai(),++Ni;for(var e,t=Si;t;)(e=_i-t._time)>=0&&t._call.call(void 0,e),t=t._next;--Ni}()}finally{Ni=0,function(){var e,t,n=Si,o=1/0;for(;n;)n._call?(o>n._time&&(o=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:Si=t);Ci=e,Li(o)}(),_i=0}}function Bi(){var e=Pi.now(),t=e-Mi;t>1e3&&(ji-=t,Mi=e)}function Li(e){Ni||(ki&&(ki=clearTimeout(ki)),e-_i>24?(e<1/0&&(ki=setTimeout(Oi,e-Pi.now()-ji)),Ei&&(Ei=clearInterval(Ei))):(Ei||(Mi=Pi.now(),Ei=setInterval(Bi,1e3)),Ni=1,Ii(Oi)))}function Ti(e,t,n){var o=new zi;return t=null==t?0:+t,o.restart(n=>{o.stop(),e(n+t)},t,n),o}zi.prototype=Ri.prototype={constructor:zi,restart:function(e,t,n){if("function"!=typeof e)throw new TypeError("callback is not a function");n=(null==n?Ai():+n)+(null==t?0:+t),this._next||Ci===this||(Ci?Ci._next=this:Si=this,Ci=this),this._call=e,this._time=n,Li()},stop:function(){this._call&&(this._call=null,this._time=1/0,Li())}};var $i=Vt("start","end","cancel","interrupt"),Vi=[];function Hi(e,t,n,o,i,r){var s=e.__transition;if(s){if(n in s)return}else e.__transition={};!function(e,t,n){var o,i=e.__transition;function r(e){n.state=1,n.timer.restart(s,n.delay,n.time),n.delay<=e&&s(e-n.delay)}function s(r){var c,d,u,h;if(1!==n.state)return l();for(c in i)if((h=i[c]).name===n.name){if(3===h.state)return Ti(s);4===h.state?(h.state=6,h.timer.stop(),h.on.call("interrupt",e,e.__data__,h.index,h.group),delete i[c]):+c<t&&(h.state=6,h.timer.stop(),h.on.call("cancel",e,e.__data__,h.index,h.group),delete i[c])}if(Ti(function(){3===n.state&&(n.state=4,n.timer.restart(a,n.delay,n.time),a(r))}),n.state=2,n.on.call("start",e,e.__data__,n.index,n.group),2===n.state){for(n.state=3,o=new Array(u=n.tween.length),c=0,d=-1;c<u;++c)(h=n.tween[c].value.call(e,e.__data__,n.index,n.group))&&(o[++d]=h);o.length=d+1}}function a(t){for(var i=t<n.duration?n.ease.call(null,t/n.duration):(n.timer.restart(l),n.state=5,1),r=-1,s=o.length;++r<s;)o[r].call(e,i);5===n.state&&(n.on.call("end",e,e.__data__,n.index,n.group),l())}function l(){for(var o in n.state=6,n.timer.stop(),delete i[t],i)return;delete e.__transition}i[t]=n,n.timer=Ri(r,0,n.time)}(e,n,{name:t,index:o,group:i,on:$i,tween:Vi,time:r.time,delay:r.delay,duration:r.duration,ease:r.ease,timer:null,state:0})}function Fi(e,t){var n=Yi(e,t);if(n.state>0)throw new Error("too late; already scheduled");return n}function Xi(e,t){var n=Yi(e,t);if(n.state>3)throw new Error("too late; already running");return n}function Yi(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function Zi(e,t){var n,o,i,r=e.__transition,s=!0;if(r){for(i in t=null==t?null:t+"",r)(n=r[i]).name===t?(o=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(o?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete r[i]):s=!1;s&&delete e.__transition}}function Ki(e,t){var n,o;return function(){var i=Xi(this,e),r=i.tween;if(r!==n)for(var s=0,a=(o=n=r).length;s<a;++s)if(o[s].name===t){(o=o.slice()).splice(s,1);break}i.tween=o}}function Wi(e,t,n){var o,i;if("function"!=typeof n)throw new Error;return function(){var r=Xi(this,e),s=r.tween;if(s!==o){i=(o=s).slice();for(var a={name:t,value:n},l=0,c=i.length;l<c;++l)if(i[l].name===t){i[l]=a;break}l===c&&i.push(a)}r.tween=i}}function qi(e,t,n){var o=e._id;return e.each(function(){var e=Xi(this,o);(e.value||(e.value={}))[t]=n.apply(this,arguments)}),function(e){return Yi(e,o).value[t]}}function Gi(e,t){var n;return("number"==typeof t?ai:t instanceof Lo?oi:(n=Lo(t))?(t=n,oi):ui)(e,t)}function Ui(e){return function(){this.removeAttribute(e)}}function Qi(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Ji(e,t,n){var o,i,r=n+"";return function(){var s=this.getAttribute(e);return s===r?null:s===o?i:i=t(o=s,n)}}function er(e,t,n){var o,i,r=n+"";return function(){var s=this.getAttributeNS(e.space,e.local);return s===r?null:s===o?i:i=t(o=s,n)}}function tr(e,t,n){var o,i,r;return function(){var s,a,l=n(this);if(null!=l)return(s=this.getAttribute(e))===(a=l+"")?null:s===o&&a===i?r:(i=a,r=t(o=s,l));this.removeAttribute(e)}}function nr(e,t,n){var o,i,r;return function(){var s,a,l=n(this);if(null!=l)return(s=this.getAttributeNS(e.space,e.local))===(a=l+"")?null:s===o&&a===i?r:(i=a,r=t(o=s,l));this.removeAttributeNS(e.space,e.local)}}function or(e,t){var n,o;function i(){var i=t.apply(this,arguments);return i!==o&&(n=(o=i)&&function(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}(e,i)),n}return i._value=t,i}function ir(e,t){var n,o;function i(){var i=t.apply(this,arguments);return i!==o&&(n=(o=i)&&function(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}(e,i)),n}return i._value=t,i}function rr(e,t){return function(){Fi(this,e).delay=+t.apply(this,arguments)}}function sr(e,t){return t=+t,function(){Fi(this,e).delay=t}}function ar(e,t){return function(){Xi(this,e).duration=+t.apply(this,arguments)}}function lr(e,t){return t=+t,function(){Xi(this,e).duration=t}}var cr=oo.prototype.constructor;function dr(e){return function(){this.style.removeProperty(e)}}var ur=0;function hr(e,t,n,o){this._groups=e,this._parents=t,this._name=n,this._id=o}function fr(){return++ur}var pr=oo.prototype;hr.prototype={constructor:hr,select:function(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=Qt(e));for(var o=this._groups,i=o.length,r=new Array(i),s=0;s<i;++s)for(var a,l,c=o[s],d=c.length,u=r[s]=new Array(d),h=0;h<d;++h)(a=c[h])&&(l=e.call(a,a.__data__,h,c))&&("__data__"in a&&(l.__data__=a.__data__),u[h]=l,Hi(u[h],t,n,h,u,Yi(a,n)));return new hr(r,this._parents,t,n)},selectAll:function(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=en(e));for(var o=this._groups,i=o.length,r=[],s=[],a=0;a<i;++a)for(var l,c=o[a],d=c.length,u=0;u<d;++u)if(l=c[u]){for(var h,f=e.call(l,l.__data__,u,c),p=Yi(l,n),g=0,m=f.length;g<m;++g)(h=f[g])&&Hi(h,t,n,g,f,p);r.push(f),s.push(l)}return new hr(r,s,t,n)},selectChild:pr.selectChild,selectChildren:pr.selectChildren,filter:function(e){"function"!=typeof e&&(e=nn(e));for(var t=this._groups,n=t.length,o=new Array(n),i=0;i<n;++i)for(var r,s=t[i],a=s.length,l=o[i]=[],c=0;c<a;++c)(r=s[c])&&e.call(r,r.__data__,c,s)&&l.push(r);return new hr(o,this._parents,this._name,this._id)},merge:function(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,o=t.length,i=n.length,r=Math.min(o,i),s=new Array(o),a=0;a<r;++a)for(var l,c=t[a],d=n[a],u=c.length,h=s[a]=new Array(u),f=0;f<u;++f)(l=c[f]||d[f])&&(h[f]=l);for(;a<o;++a)s[a]=t[a];return new hr(s,this._parents,this._name,this._id)},selection:function(){return new cr(this._groups,this._parents)},transition:function(){for(var e=this._name,t=this._id,n=fr(),o=this._groups,i=o.length,r=0;r<i;++r)for(var s,a=o[r],l=a.length,c=0;c<l;++c)if(s=a[c]){var d=Yi(s,t);Hi(s,e,n,c,a,{time:d.time+d.delay+d.duration,delay:0,duration:d.duration,ease:d.ease})}return new hr(o,this._parents,e,n)},call:pr.call,nodes:pr.nodes,node:pr.node,size:pr.size,empty:pr.empty,each:pr.each,on:function(e,t){var n=this._id;return arguments.length<2?Yi(this.node(),n).on.on(e):this.each(function(e,t,n){var o,i,r=function(e){return(e+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||"start"===e})}(t)?Fi:Xi;return function(){var s=r(this,e),a=s.on;a!==o&&(i=(o=a).copy()).on(t,n),s.on=i}}(n,e,t))},attr:function(e,t){var n=Kt(e),o="transform"===n?vi:Gi;return this.attrTween(e,"function"==typeof t?(n.local?nr:tr)(n,o,qi(this,"attr."+e,t)):null==t?(n.local?Qi:Ui)(n):(n.local?er:Ji)(n,o,t))},attrTween:function(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==t)return this.tween(n,null);if("function"!=typeof t)throw new Error;var o=Kt(e);return this.tween(n,(o.local?or:ir)(o,t))},style:function(e,t,n){var o="transform"==(e+="")?xi:Gi;return null==t?this.styleTween(e,function(e,t){var n,o,i;return function(){var r=En(this,e),s=(this.style.removeProperty(e),En(this,e));return r===s?null:r===n&&s===o?i:i=t(n=r,o=s)}}(e,o)).on("end.style."+e,dr(e)):"function"==typeof t?this.styleTween(e,function(e,t,n){var o,i,r;return function(){var s=En(this,e),a=n(this),l=a+"";return null==a&&(this.style.removeProperty(e),l=a=En(this,e)),s===l?null:s===o&&l===i?r:(i=l,r=t(o=s,a))}}(e,o,qi(this,"style."+e,t))).each(function(e,t){var n,o,i,r,s="style."+t,a="end."+s;return function(){var l=Xi(this,e),c=l.on,d=null==l.value[s]?r||(r=dr(t)):void 0;c===n&&i===d||(o=(n=c).copy()).on(a,i=d),l.on=o}}(this._id,e)):this.styleTween(e,function(e,t,n){var o,i,r=n+"";return function(){var s=En(this,e);return s===r?null:s===o?i:i=t(o=s,n)}}(e,o,t),n).on("end.style."+e,null)},styleTween:function(e,t,n){var o="style."+(e+="");if(arguments.length<2)return(o=this.tween(o))&&o._value;if(null==t)return this.tween(o,null);if("function"!=typeof t)throw new Error;return this.tween(o,function(e,t,n){var o,i;function r(){var r=t.apply(this,arguments);return r!==i&&(o=(i=r)&&function(e,t,n){return function(o){this.style.setProperty(e,t.call(this,o),n)}}(e,r,n)),o}return r._value=t,r}(e,t,null==n?"":n))},text:function(e){return this.tween("text","function"==typeof e?function(e){return function(){var t=e(this);this.textContent=null==t?"":t}}(qi(this,"text",e)):function(e){return function(){this.textContent=e}}(null==e?"":e+""))},textTween:function(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(null==e)return this.tween(t,null);if("function"!=typeof e)throw new Error;return this.tween(t,function(e){var t,n;function o(){var o=e.apply(this,arguments);return o!==n&&(t=(n=o)&&function(e){return function(t){this.textContent=e.call(this,t)}}(o)),t}return o._value=e,o}(e))},remove:function(){return this.on("end.remove",(e=this._id,function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}));var e},tween:function(e,t){var n=this._id;if(e+="",arguments.length<2){for(var o,i=Yi(this.node(),n).tween,r=0,s=i.length;r<s;++r)if((o=i[r]).name===e)return o.value;return null}return this.each((null==t?Ki:Wi)(n,e,t))},delay:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?rr:sr)(t,e)):Yi(this.node(),t).delay},duration:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?ar:lr)(t,e)):Yi(this.node(),t).duration},ease:function(e){var t=this._id;return arguments.length?this.each(function(e,t){if("function"!=typeof t)throw new Error;return function(){Xi(this,e).ease=t}}(t,e)):Yi(this.node(),t).ease},easeVarying:function(e){if("function"!=typeof e)throw new Error;return this.each(function(e,t){return function(){var n=t.apply(this,arguments);if("function"!=typeof n)throw new Error;Xi(this,e).ease=n}}(this._id,e))},end:function(){var e,t,n=this,o=n._id,i=n.size();return new Promise(function(r,s){var a={value:s},l={value:function(){0===--i&&r()}};n.each(function(){var n=Xi(this,o),i=n.on;i!==e&&((t=(e=i).copy())._.cancel.push(a),t._.interrupt.push(a),t._.end.push(l)),n.on=t}),0===i&&r()})},[Symbol.iterator]:pr[Symbol.iterator]};var gr={time:null,delay:0,duration:250,ease:function(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}};function mr(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}oo.prototype.interrupt=function(e){return this.each(function(){Zi(this,e)})},oo.prototype.transition=function(e){var t,n;e instanceof hr?(t=e._id,e=e._name):(t=fr(),(n=gr).time=Ai(),e=null==e?null:e+"");for(var o=this._groups,i=o.length,r=0;r<i;++r)for(var s,a=o[r],l=a.length,c=0;c<l;++c)(s=a[c])&&Hi(s,e,t,c,a,n||mr(s,t));return new hr(o,this._parents,e,t)};const yr=e=>()=>e;function xr(e,{sourceEvent:t,target:n,transform:o,dispatch:i}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:o,enumerable:!0,configurable:!0},_:{value:i}})}function vr(e,t,n){this.k=e,this.x=t,this.y=n}vr.prototype={constructor:vr,scale:function(e){return 1===e?this:new vr(this.k*e,this.x,this.y)},translate:function(e,t){return 0===e&0===t?this:new vr(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var br=new vr(1,0,0);function wr(e){for(;!e.__zoom;)if(!(e=e.parentNode))return br;return e.__zoom}function Sr(e){e.stopImmediatePropagation()}function Cr(e){e.preventDefault(),e.stopImmediatePropagation()}function Nr(e){return!(e.ctrlKey&&"wheel"!==e.type||e.button)}function kr(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e).hasAttribute("viewBox")?[[(e=e.viewBox.baseVal).x,e.y],[e.x+e.width,e.y+e.height]]:[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]:[[0,0],[e.clientWidth,e.clientHeight]]}function Er(){return this.__zoom||br}function Mr(e){return-e.deltaY*(1===e.deltaMode?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function _r(){return navigator.maxTouchPoints||"ontouchstart"in this}function jr(e,t,n){var o=e.invertX(t[0][0])-n[0][0],i=e.invertX(t[1][0])-n[1][0],r=e.invertY(t[0][1])-n[0][1],s=e.invertY(t[1][1])-n[1][1];return e.translate(i>o?(o+i)/2:Math.min(0,o)||Math.max(0,i),s>r?(r+s)/2:Math.min(0,r)||Math.max(0,s))}function Pr(){var e,t,n,o=Nr,i=kr,r=jr,s=Mr,a=_r,l=[0,1/0],c=[[-1/0,-1/0],[1/0,1/0]],d=250,u=wi,h=Vt("start","zoom","end"),f=0,p=10;function g(e){e.property("__zoom",Er).on("wheel.zoom",S,{passive:!1}).on("mousedown.zoom",C).on("dblclick.zoom",N).filter(a).on("touchstart.zoom",k).on("touchmove.zoom",E).on("touchend.zoom touchcancel.zoom",M).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function m(e,t){return(t=Math.max(l[0],Math.min(l[1],t)))===e.k?e:new vr(t,e.x,e.y)}function y(e,t,n){var o=t[0]-n[0]*e.k,i=t[1]-n[1]*e.k;return o===e.x&&i===e.y?e:new vr(e.k,o,i)}function x(e){return[(+e[0][0]+ +e[1][0])/2,(+e[0][1]+ +e[1][1])/2]}function v(e,t,n,o){e.on("start.zoom",function(){b(this,arguments).event(o).start()}).on("interrupt.zoom end.zoom",function(){b(this,arguments).event(o).end()}).tween("zoom",function(){var e=this,r=arguments,s=b(e,r).event(o),a=i.apply(e,r),l=null==n?x(a):"function"==typeof n?n.apply(e,r):n,c=Math.max(a[1][0]-a[0][0],a[1][1]-a[0][1]),d=e.__zoom,h="function"==typeof t?t.apply(e,r):t,f=u(d.invert(l).concat(c/d.k),h.invert(l).concat(c/h.k));return function(e){if(1===e)e=h;else{var t=f(e),n=c/t[2];e=new vr(n,l[0]-t[0]*n,l[1]-t[1]*n)}s.zoom(null,e)}})}function b(e,t,n){return!n&&e.__zooming||new w(e,t)}function w(e,t){this.that=e,this.args=t,this.active=0,this.sourceEvent=null,this.extent=i.apply(e,t),this.taps=0}function S(e,...t){if(o.apply(this,arguments)){var n=b(this,t).event(e),i=this.__zoom,a=Math.max(l[0],Math.min(l[1],i.k*Math.pow(2,s.apply(this,arguments)))),d=ro(e);if(n.wheel)n.mouse[0][0]===d[0]&&n.mouse[0][1]===d[1]||(n.mouse[1]=i.invert(n.mouse[0]=d)),clearTimeout(n.wheel);else{if(i.k===a)return;n.mouse=[d,i.invert(d)],Zi(this),n.start()}Cr(e),n.wheel=setTimeout(function(){n.wheel=null,n.end()},150),n.zoom("mouse",r(y(m(i,a),n.mouse[0],n.mouse[1]),n.extent,c))}}function C(e,...t){if(!n&&o.apply(this,arguments)){var i=e.currentTarget,s=b(this,t,!0).event(e),a=io(e.view).on("mousemove.zoom",function(e){if(Cr(e),!s.moved){var t=e.clientX-d,n=e.clientY-u;s.moved=t*t+n*n>f}s.event(e).zoom("mouse",r(y(s.that.__zoom,s.mouse[0]=ro(e,i),s.mouse[1]),s.extent,c))},!0).on("mouseup.zoom",function(e){a.on("mousemove.zoom mouseup.zoom",null),ho(e.view,s.moved),Cr(e),s.event(e).end()},!0),l=ro(e,i),d=e.clientX,u=e.clientY;uo(e.view),Sr(e),s.mouse=[l,this.__zoom.invert(l)],Zi(this),s.start()}}function N(e,...t){if(o.apply(this,arguments)){var n=this.__zoom,s=ro(e.changedTouches?e.changedTouches[0]:e,this),a=n.invert(s),l=n.k*(e.shiftKey?.5:2),u=r(y(m(n,l),s,a),i.apply(this,t),c);Cr(e),d>0?io(this).transition().duration(d).call(v,u,s,e):io(this).call(g.transform,u,s,e)}}function k(n,...i){if(o.apply(this,arguments)){var r,s,a,l,c=n.touches,d=c.length,u=b(this,i,n.changedTouches.length===d).event(n);for(Sr(n),s=0;s<d;++s)l=[l=ro(a=c[s],this),this.__zoom.invert(l),a.identifier],u.touch0?u.touch1||u.touch0[2]===l[2]||(u.touch1=l,u.taps=0):(u.touch0=l,r=!0,u.taps=1+!!e);e&&(e=clearTimeout(e)),r&&(u.taps<2&&(t=l[0],e=setTimeout(function(){e=null},500)),Zi(this),u.start())}}function E(e,...t){if(this.__zooming){var n,o,i,s,a=b(this,t).event(e),l=e.changedTouches,d=l.length;for(Cr(e),n=0;n<d;++n)i=ro(o=l[n],this),a.touch0&&a.touch0[2]===o.identifier?a.touch0[0]=i:a.touch1&&a.touch1[2]===o.identifier&&(a.touch1[0]=i);if(o=a.that.__zoom,a.touch1){var u=a.touch0[0],h=a.touch0[1],f=a.touch1[0],p=a.touch1[1],g=(g=f[0]-u[0])*g+(g=f[1]-u[1])*g,x=(x=p[0]-h[0])*x+(x=p[1]-h[1])*x;o=m(o,Math.sqrt(g/x)),i=[(u[0]+f[0])/2,(u[1]+f[1])/2],s=[(h[0]+p[0])/2,(h[1]+p[1])/2]}else{if(!a.touch0)return;i=a.touch0[0],s=a.touch0[1]}a.zoom("touch",r(y(o,i,s),a.extent,c))}}function M(e,...o){if(this.__zooming){var i,r,s=b(this,o).event(e),a=e.changedTouches,l=a.length;for(Sr(e),n&&clearTimeout(n),n=setTimeout(function(){n=null},500),i=0;i<l;++i)r=a[i],s.touch0&&s.touch0[2]===r.identifier?delete s.touch0:s.touch1&&s.touch1[2]===r.identifier&&delete s.touch1;if(s.touch1&&!s.touch0&&(s.touch0=s.touch1,delete s.touch1),s.touch0)s.touch0[1]=this.__zoom.invert(s.touch0[0]);else if(s.end(),2===s.taps&&(r=ro(r,this),Math.hypot(t[0]-r[0],t[1]-r[1])<p)){var c=io(this).on("dblclick.zoom");c&&c.apply(this,arguments)}}}return g.transform=function(e,t,n,o){var i=e.selection?e.selection():e;i.property("__zoom",Er),e!==i?v(e,t,n,o):i.interrupt().each(function(){b(this,arguments).event(o).start().zoom(null,"function"==typeof t?t.apply(this,arguments):t).end()})},g.scaleBy=function(e,t,n,o){g.scaleTo(e,function(){return this.__zoom.k*("function"==typeof t?t.apply(this,arguments):t)},n,o)},g.scaleTo=function(e,t,n,o){g.transform(e,function(){var e=i.apply(this,arguments),o=this.__zoom,s=null==n?x(e):"function"==typeof n?n.apply(this,arguments):n,a=o.invert(s),l="function"==typeof t?t.apply(this,arguments):t;return r(y(m(o,l),s,a),e,c)},n,o)},g.translateBy=function(e,t,n,o){g.transform(e,function(){return r(this.__zoom.translate("function"==typeof t?t.apply(this,arguments):t,"function"==typeof n?n.apply(this,arguments):n),i.apply(this,arguments),c)},null,o)},g.translateTo=function(e,t,n,o,s){g.transform(e,function(){var e=i.apply(this,arguments),s=this.__zoom,a=null==o?x(e):"function"==typeof o?o.apply(this,arguments):o;return r(br.translate(a[0],a[1]).scale(s.k).translate("function"==typeof t?-t.apply(this,arguments):-t,"function"==typeof n?-n.apply(this,arguments):-n),e,c)},o,s)},w.prototype={event:function(e){return e&&(this.sourceEvent=e),this},start:function(){return 1===++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(e,t){return this.mouse&&"mouse"!==e&&(this.mouse[1]=t.invert(this.mouse[0])),this.touch0&&"touch"!==e&&(this.touch0[1]=t.invert(this.touch0[0])),this.touch1&&"touch"!==e&&(this.touch1[1]=t.invert(this.touch1[0])),this.that.__zoom=t,this.emit("zoom"),this},end:function(){return 0===--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(e){var t=io(this.that).datum();h.call(e,this.that,new xr(e,{sourceEvent:this.sourceEvent,target:g,transform:this.that.__zoom,dispatch:h}),t)}},g.wheelDelta=function(e){return arguments.length?(s="function"==typeof e?e:yr(+e),g):s},g.filter=function(e){return arguments.length?(o="function"==typeof e?e:yr(!!e),g):o},g.touchable=function(e){return arguments.length?(a="function"==typeof e?e:yr(!!e),g):a},g.extent=function(e){return arguments.length?(i="function"==typeof e?e:yr([[+e[0][0],+e[0][1]],[+e[1][0],+e[1][1]]]),g):i},g.scaleExtent=function(e){return arguments.length?(l[0]=+e[0],l[1]=+e[1],g):[l[0],l[1]]},g.translateExtent=function(e){return arguments.length?(c[0][0]=+e[0][0],c[1][0]=+e[1][0],c[0][1]=+e[0][1],c[1][1]=+e[1][1],g):[[c[0][0],c[0][1]],[c[1][0],c[1][1]]]},g.constrain=function(e){return arguments.length?(r=e,g):r},g.duration=function(e){return arguments.length?(d=+e,g):d},g.interpolate=function(e){return arguments.length?(u=e,g):u},g.on=function(){var e=h.on.apply(h,arguments);return e===h?g:e},g.clickDistance=function(e){return arguments.length?(f=(e=+e)*e,g):Math.sqrt(f)},g.tapDistance=function(e){return arguments.length?(p=+e,g):p},g}wr.prototype=vr.prototype;const Ir=()=>"[React Flow]: Seems like you have not used zustand provider as an ancestor. Help: https://reactflow.dev/error#001",Ar=e=>`Node type "${e}" not found. Using fallback type "default".`,Dr=()=>"The React Flow parent container needs a width and a height to render the graph.",zr=()=>"Only child nodes can use a parent extent.",Rr=e=>`Marker type "${e}" doesn't exist.`,Or=(e,{id:t,sourceHandle:n,targetHandle:o})=>`Couldn't create edge for ${e} handle id: "${"source"===e?n:o}", edge id: ${t}.`,Br=()=>"Handle: No node id found. Make sure to only use a Handle inside a custom Node.",Lr=e=>`Edge type "${e}" not found. Using fallback type "default".`,Tr=e=>`Node with id "${e}" does not exist, it may have been removed. This can happen when a node is deleted before the "onNodeClick" handler is called.`,$r=()=>"It seems that you are trying to drag a node that is not initialized. Please use onNodesChange as explained in the docs.",Vr=[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],Hr=["Enter"," ","Escape"],Fr={"node.a11yDescription.default":"Press enter or space to select a node. Press delete to remove it and escape to cancel.","node.a11yDescription.keyboardDisabled":"Press enter or space to select a node. You can then use the arrow keys to move the node around. Press delete to remove it and escape to cancel.","node.a11yDescription.ariaLiveMessage":({direction:e,x:t,y:n})=>`Moved selected node ${e}. New position, x: ${t}, y: ${n}`,"edge.a11yDescription.default":"Press enter or space to select an edge. You can then press delete to remove it or escape to cancel.","controls.ariaLabel":"Control Panel","controls.zoomIn.ariaLabel":"Zoom In","controls.zoomOut.ariaLabel":"Zoom Out","controls.fitView.ariaLabel":"Fit View","controls.interactive.ariaLabel":"Toggle Interactivity","minimap.ariaLabel":"Mini Map","handle.ariaLabel":"Handle"};var Xr,Yr,Zr,Kr,Wr,qr;(Yr=Xr||(Xr={})).Strict="strict",Yr.Loose="loose",(Kr=Zr||(Zr={})).Free="free",Kr.Vertical="vertical",Kr.Horizontal="horizontal",(qr=Wr||(Wr={})).Partial="partial",qr.Full="full";const Gr={inProgress:!1,isValid:null,from:null,fromHandle:null,fromPosition:null,fromNode:null,to:null,toHandle:null,toPosition:null,toNode:null};var Ur,Qr,Jr,es,ts,ns;(Qr=Ur||(Ur={})).Bezier="default",Qr.Straight="straight",Qr.Step="step",Qr.SmoothStep="smoothstep",Qr.SimpleBezier="simplebezier",(es=Jr||(Jr={})).Arrow="arrow",es.ArrowClosed="arrowclosed",(ns=ts||(ts={})).Left="left",ns.Top="top",ns.Right="right",ns.Bottom="bottom";const os={[ts.Left]:ts.Right,[ts.Right]:ts.Left,[ts.Top]:ts.Bottom,[ts.Bottom]:ts.Top};function is(e){return null===e?null:e?"valid":"invalid"}const rs=e=>"id"in e&&"source"in e&&"target"in e,ss=e=>"id"in e&&"internals"in e&&!("source"in e)&&!("target"in e),as=(e,t=[0,0])=>{const{width:n,height:o}=Rs(e),i=e.origin??t,r=n*i[0],s=o*i[1];return{x:e.position.x-r,y:e.position.y-s}},ls=(e,t={})=>{let n={x:1/0,y:1/0,x2:-1/0,y2:-1/0},o=!1;return e.forEach(e=>{(void 0===t.filter||t.filter(e))&&(n=xs(n,Ss(e)),o=!0)}),o?bs(n):{x:0,y:0,width:0,height:0}},cs=(e,t,[n,o,i]=[0,0,1],r=!1,s=!1)=>{const a={...js(t,[n,o,i]),width:t.width/i,height:t.height/i},l=[];for(const c of e.values()){const{measured:e,selectable:t=!0,hidden:n=!1}=c;if(s&&!t||n)continue;const o=e.width??c.width??c.initialWidth??null,i=e.height??c.height??c.initialHeight??null,d=Ns(a,ws(c)),u=(o??0)*(i??0),h=r&&d>0;(!c.internals.handleBounds||h||d>=u||c.dragging)&&l.push(c)}return l};async function ds({nodes:e,width:t,height:n,panZoom:o,minZoom:i,maxZoom:r},s){if(0===e.size)return Promise.resolve(!0);const a=function(e,t){const n=/* @__PURE__ */new Map,o=(null==t?void 0:t.nodes)?new Set(t.nodes.map(e=>e.id)):null;return e.forEach(e=>{!e.measured.width||!e.measured.height||!(null==t?void 0:t.includeHiddenNodes)&&e.hidden||o&&!o.has(e.id)||n.set(e.id,e)}),n}(e,s),l=ls(a),c=As(l,t,n,(null==s?void 0:s.minZoom)??i,(null==s?void 0:s.maxZoom)??r,(null==s?void 0:s.padding)??.1);return await o.setViewport(c,{duration:null==s?void 0:s.duration,ease:null==s?void 0:s.ease,interpolate:null==s?void 0:s.interpolate}),Promise.resolve(!0)}function us({nodeId:e,nextPosition:t,nodeLookup:n,nodeOrigin:o=[0,0],nodeExtent:i,onError:r}){const s=n.get(e),a=s.parentId?n.get(s.parentId):void 0,{x:l,y:c}=a?a.internals.positionAbsolute:{x:0,y:0},d=s.origin??o;let u=s.extent||i;if("parent"!==s.extent||s.expandParent)a&&zs(s.extent)&&(u=[[s.extent[0][0]+l,s.extent[0][1]+c],[s.extent[1][0]+l,s.extent[1][1]+c]]);else if(a){const e=a.measured.width,t=a.measured.height;e&&t&&(u=[[l,c],[l+e,c+t]])}else null==r||r("005",zr());const h=zs(u)?ps(t,u,s.measured):t;return void 0!==s.measured.width&&void 0!==s.measured.height||null==r||r("015",$r()),{position:{x:h.x-l+(s.measured.width??0)*d[0],y:h.y-c+(s.measured.height??0)*d[1]},positionAbsolute:h}}async function hs({nodesToRemove:e=[],edgesToRemove:t=[],nodes:n,edges:o,onBeforeDelete:i}){const r=new Set(e.map(e=>e.id)),s=[];for(const h of n){if(!1===h.deletable)continue;const e=r.has(h.id),t=!e&&h.parentId&&s.find(e=>e.id===h.parentId);(e||t)&&s.push(h)}const a=new Set(t.map(e=>e.id)),l=o.filter(e=>!1!==e.deletable),c=((e,t)=>{const n=/* @__PURE__ */new Set;return e.forEach(e=>{n.add(e.id)}),t.filter(e=>n.has(e.source)||n.has(e.target))})(s,l),d=c;for(const h of l){a.has(h.id)&&!d.find(e=>e.id===h.id)&&d.push(h)}if(!i)return{edges:d,nodes:s};const u=await i({nodes:s,edges:d});return"boolean"==typeof u?u?{edges:d,nodes:s}:{edges:[],nodes:[]}:u}const fs=(e,t=0,n=1)=>Math.min(Math.max(e,t),n),ps=(e={x:0,y:0},t,n)=>({x:fs(e.x,t[0][0],t[1][0]-((null==n?void 0:n.width)??0)),y:fs(e.y,t[0][1],t[1][1]-((null==n?void 0:n.height)??0))});function gs(e,t,n){const{width:o,height:i}=Rs(n),{x:r,y:s}=n.internals.positionAbsolute;return ps(e,[[r,s],[r+o,s+i]],t)}const ms=(e,t,n)=>e<t?fs(Math.abs(e-t),1,t)/t:e>n?-fs(Math.abs(e-n),1,t)/t:0,ys=(e,t,n=15,o=40)=>[ms(e.x,o,t.width-o)*n,ms(e.y,o,t.height-o)*n],xs=(e,t)=>({x:Math.min(e.x,t.x),y:Math.min(e.y,t.y),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}),vs=({x:e,y:t,width:n,height:o})=>({x:e,y:t,x2:e+n,y2:t+o}),bs=({x:e,y:t,x2:n,y2:o})=>({x:e,y:t,width:n-e,height:o-t}),ws=(e,t=[0,0])=>{var n,o;const{x:i,y:r}=ss(e)?e.internals.positionAbsolute:as(e,t);return{x:i,y:r,width:(null==(n=e.measured)?void 0:n.width)??e.width??e.initialWidth??0,height:(null==(o=e.measured)?void 0:o.height)??e.height??e.initialHeight??0}},Ss=(e,t=[0,0])=>{var n,o;const{x:i,y:r}=ss(e)?e.internals.positionAbsolute:as(e,t);return{x:i,y:r,x2:i+((null==(n=e.measured)?void 0:n.width)??e.width??e.initialWidth??0),y2:r+((null==(o=e.measured)?void 0:o.height)??e.height??e.initialHeight??0)}},Cs=(e,t)=>bs(xs(vs(e),vs(t))),Ns=(e,t)=>{const n=Math.max(0,Math.min(e.x+e.width,t.x+t.width)-Math.max(e.x,t.x)),o=Math.max(0,Math.min(e.y+e.height,t.y+t.height)-Math.max(e.y,t.y));return Math.ceil(n*o)},ks=e=>Es(e.width)&&Es(e.height)&&Es(e.x)&&Es(e.y),Es=e=>!isNaN(e)&&isFinite(e),Ms=(e,t)=>{},_s=(e,t=[1,1])=>({x:t[0]*Math.round(e.x/t[0]),y:t[1]*Math.round(e.y/t[1])}),js=({x:e,y:t},[n,o,i],r=!1,s=[1,1])=>{const a={x:(e-n)/i,y:(t-o)/i};return r?_s(a,s):a},Ps=({x:e,y:t},[n,o,i])=>({x:e*i+n,y:t*i+o});function Is(e,t){if("number"==typeof e)return Math.floor(.5*(t-t/(1+e)));if("string"==typeof e&&e.endsWith("px")){const t=parseFloat(e);if(!Number.isNaN(t))return Math.floor(t)}if("string"==typeof e&&e.endsWith("%")){const n=parseFloat(e);if(!Number.isNaN(n))return Math.floor(t*n*.01)}return 0}const As=(e,t,n,o,i,r)=>{const s=function(e,t,n){if("string"==typeof e||"number"==typeof e){const o=Is(e,n),i=Is(e,t);return{top:o,right:i,bottom:o,left:i,x:2*i,y:2*o}}if("object"==typeof e){const o=Is(e.top??e.y??0,n),i=Is(e.bottom??e.y??0,n),r=Is(e.left??e.x??0,t),s=Is(e.right??e.x??0,t);return{top:o,right:s,bottom:i,left:r,x:r+s,y:o+i}}return{top:0,right:0,bottom:0,left:0,x:0,y:0}}(r,t,n),a=(t-s.x)/e.width,l=(n-s.y)/e.height,c=Math.min(a,l),d=fs(c,o,i),u=t/2-(e.x+e.width/2)*d,h=n/2-(e.y+e.height/2)*d,f=function(e,t,n,o,i,r){const{x:s,y:a}=Ps(e,[t,n,o]),{x:l,y:c}=Ps({x:e.x+e.width,y:e.y+e.height},[t,n,o]),d=i-l,u=r-c;return{left:Math.floor(s),top:Math.floor(a),right:Math.floor(d),bottom:Math.floor(u)}}(e,u,h,d,t,n),p=Math.min(f.left-s.left,0),g=Math.min(f.top-s.top,0);return{x:u-p+Math.min(f.right-s.right,0),y:h-g+Math.min(f.bottom-s.bottom,0),zoom:d}},Ds=()=>{var e;return"undefined"!=typeof navigator&&(null==(e=null==navigator?void 0:navigator.userAgent)?void 0:e.indexOf("Mac"))>=0};function zs(e){return null!=e&&"parent"!==e}function Rs(e){var t,n;return{width:(null==(t=e.measured)?void 0:t.width)??e.width??e.initialWidth??0,height:(null==(n=e.measured)?void 0:n.height)??e.height??e.initialHeight??0}}function Os(e){var t,n;return void 0!==((null==(t=e.measured)?void 0:t.width)??e.width??e.initialWidth)&&void 0!==((null==(n=e.measured)?void 0:n.height)??e.height??e.initialHeight)}function Bs(e,t={width:0,height:0},n,o,i){const r={...e},s=o.get(n);if(s){const e=s.origin||i;r.x+=s.internals.positionAbsolute.x-(t.width??0)*e[0],r.y+=s.internals.positionAbsolute.y-(t.height??0)*e[1]}return r}function Ls(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function Ts(e){return{...Fr,...e||{}}}function $s(e,{snapGrid:t=[0,0],snapToGrid:n=!1,transform:o,containerBounds:i}){const{x:r,y:s}=Zs(e),a=js({x:r-((null==i?void 0:i.left)??0),y:s-((null==i?void 0:i.top)??0)},o),{x:l,y:c}=n?_s(a,t):a;return{xSnapped:l,ySnapped:c,...a}}const Vs=e=>({width:e.offsetWidth,height:e.offsetHeight}),Hs=e=>{var t;return(null==(t=null==e?void 0:e.getRootNode)?void 0:t.call(e))||(null==window?void 0:window.document)},Fs=["INPUT","SELECT","TEXTAREA"];function Xs(e){var t,n;const o=(null==(n=null==(t=e.composedPath)?void 0:t.call(e))?void 0:n[0])||e.target;if(1!==(null==o?void 0:o.nodeType))return!1;return Fs.includes(o.nodeName)||o.hasAttribute("contenteditable")||!!o.closest(".nokey")}const Ys=e=>"clientX"in e,Zs=(e,t)=>{var n,o;const i=Ys(e),r=i?e.clientX:null==(n=e.touches)?void 0:n[0].clientX,s=i?e.clientY:null==(o=e.touches)?void 0:o[0].clientY;return{x:r-((null==t?void 0:t.left)??0),y:s-((null==t?void 0:t.top)??0)}},Ks=(e,t,n,o,i)=>{const r=t.querySelectorAll(`.${e}`);return r&&r.length?Array.from(r).map(t=>{const r=t.getBoundingClientRect();return{id:t.getAttribute("data-handleid"),type:e,nodeId:i,position:t.getAttribute("data-handlepos"),x:(r.left-n.left)/o,y:(r.top-n.top)/o,...Vs(t)}}):null};function Ws({sourceX:e,sourceY:t,targetX:n,targetY:o,sourceControlX:i,sourceControlY:r,targetControlX:s,targetControlY:a}){const l=.125*e+.375*i+.375*s+.125*n,c=.125*t+.375*r+.375*a+.125*o;return[l,c,Math.abs(l-e),Math.abs(c-t)]}function qs(e,t){return e>=0?.5*e:25*t*Math.sqrt(-e)}function Gs({pos:e,x1:t,y1:n,x2:o,y2:i,c:r}){switch(e){case ts.Left:return[t-qs(t-o,r),n];case ts.Right:return[t+qs(o-t,r),n];case ts.Top:return[t,n-qs(n-i,r)];case ts.Bottom:return[t,n+qs(i-n,r)]}}function Us({sourceX:e,sourceY:t,sourcePosition:n=ts.Bottom,targetX:o,targetY:i,targetPosition:r=ts.Top,curvature:s=.25}){const[a,l]=Gs({pos:n,x1:e,y1:t,x2:o,y2:i,c:s}),[c,d]=Gs({pos:r,x1:o,y1:i,x2:e,y2:t,c:s}),[u,h,f,p]=Ws({sourceX:e,sourceY:t,targetX:o,targetY:i,sourceControlX:a,sourceControlY:l,targetControlX:c,targetControlY:d});return[`M${e},${t} C${a},${l} ${c},${d} ${o},${i}`,u,h,f,p]}function Qs({sourceX:e,sourceY:t,targetX:n,targetY:o}){const i=Math.abs(n-e)/2,r=n<e?n+i:n-i,s=Math.abs(o-t)/2;return[r,o<t?o+s:o-s,i,s]}function Js({sourceNode:e,targetNode:t,width:n,height:o,transform:i}){const r=xs(Ss(e),Ss(t));r.x===r.x2&&(r.x2+=1),r.y===r.y2&&(r.y2+=1);const s={x:-i[0]/i[2],y:-i[1]/i[2],width:n/i[2],height:o/i[2]};return Ns(s,bs(r))>0}const ea=({source:e,sourceHandle:t,target:n,targetHandle:o})=>`xy-edge__${e}${t||""}-${n}${o||""}`,ta=(e,t)=>{if(!e.source||!e.target)return t;let n;return n=rs(e)?{...e}:{...e,id:ea(e)},((e,t)=>t.some(t=>!(t.source!==e.source||t.target!==e.target||t.sourceHandle!==e.sourceHandle&&(t.sourceHandle||e.sourceHandle)||t.targetHandle!==e.targetHandle&&(t.targetHandle||e.targetHandle))))(n,t)?t:(null===n.sourceHandle&&delete n.sourceHandle,null===n.targetHandle&&delete n.targetHandle,t.concat(n))};function na({sourceX:e,sourceY:t,targetX:n,targetY:o}){const[i,r,s,a]=Qs({sourceX:e,sourceY:t,targetX:n,targetY:o});return[`M ${e},${t}L ${n},${o}`,i,r,s,a]}const oa={[ts.Left]:{x:-1,y:0},[ts.Right]:{x:1,y:0},[ts.Top]:{x:0,y:-1},[ts.Bottom]:{x:0,y:1}},ia=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));function ra({source:e,sourcePosition:t=ts.Bottom,target:n,targetPosition:o=ts.Top,center:i,offset:r,stepPosition:s}){const a=oa[t],l=oa[o],c={x:e.x+a.x*r,y:e.y+a.y*r},d={x:n.x+l.x*r,y:n.y+l.y*r},u=(({source:e,sourcePosition:t=ts.Bottom,target:n})=>t===ts.Left||t===ts.Right?e.x<n.x?{x:1,y:0}:{x:-1,y:0}:e.y<n.y?{x:0,y:1}:{x:0,y:-1})({source:c,sourcePosition:t,target:d}),h=0!==u.x?"x":"y",f=u[h];let p,g,m=[];const y={x:0,y:0},x={x:0,y:0},[,,v,b]=Qs({sourceX:e.x,sourceY:e.y,targetX:n.x,targetY:n.y});if(a[h]*l[h]===-1){"x"===h?(p=i.x??c.x+(d.x-c.x)*s,g=i.y??(c.y+d.y)/2):(p=i.x??(c.x+d.x)/2,g=i.y??c.y+(d.y-c.y)*s);const e=[{x:p,y:c.y},{x:p,y:d.y}],t=[{x:c.x,y:g},{x:d.x,y:g}];m=a[h]===f?"x"===h?e:t:"x"===h?t:e}else{const i=[{x:c.x,y:d.y}],s=[{x:d.x,y:c.y}];if(m="x"===h?a.x===f?s:i:a.y===f?i:s,t===o){const t=Math.abs(e[h]-n[h]);if(t<=r){const o=Math.min(r-1,r-t);a[h]===f?y[h]=(c[h]>e[h]?-1:1)*o:x[h]=(d[h]>n[h]?-1:1)*o}}if(t!==o){const e="x"===h?"y":"x",t=a[h]===l[e],n=c[e]>d[e],o=c[e]<d[e];(1===a[h]&&(!t&&n||t&&o)||1!==a[h]&&(!t&&o||t&&n))&&(m="x"===h?i:s)}const u={x:c.x+y.x,y:c.y+y.y},v={x:d.x+x.x,y:d.y+x.y};Math.max(Math.abs(u.x-m[0].x),Math.abs(v.x-m[0].x))>=Math.max(Math.abs(u.y-m[0].y),Math.abs(v.y-m[0].y))?(p=(u.x+v.x)/2,g=m[0].y):(p=m[0].x,g=(u.y+v.y)/2)}return[[e,{x:c.x+y.x,y:c.y+y.y},...m,{x:d.x+x.x,y:d.y+x.y},n],p,g,v,b]}function sa({sourceX:e,sourceY:t,sourcePosition:n=ts.Bottom,targetX:o,targetY:i,targetPosition:r=ts.Top,borderRadius:s=5,centerX:a,centerY:l,offset:c=20,stepPosition:d=.5}){const[u,h,f,p,g]=ra({source:{x:e,y:t},sourcePosition:n,target:{x:o,y:i},targetPosition:r,center:{x:a,y:l},offset:c,stepPosition:d});return[u.reduce((e,t,n)=>{let o="";return o=n>0&&n<u.length-1?function(e,t,n,o){const i=Math.min(ia(e,t)/2,ia(t,n)/2,o),{x:r,y:s}=t;if(e.x===r&&r===n.x||e.y===s&&s===n.y)return`L${r} ${s}`;if(e.y===s)return`L ${r+i*(e.x<n.x?-1:1)},${s}Q ${r},${s} ${r},${s+i*(e.y<n.y?1:-1)}`;const a=e.x<n.x?1:-1;return`L ${r},${s+i*(e.y<n.y?-1:1)}Q ${r},${s} ${r+i*a},${s}`}(u[n-1],t,u[n+1],s):`${0===n?"M":"L"}${t.x} ${t.y}`,e+=o},""),h,f,p,g]}function aa(e){var t;return e&&!(!e.internals.handleBounds&&!(null==(t=e.handles)?void 0:t.length))&&!!(e.measured.width||e.width||e.initialWidth)}function la(e){if(!e)return null;const t=[],n=[];for(const o of e)o.width=o.width??1,o.height=o.height??1,"source"===o.type?t.push(o):"target"===o.type&&n.push(o);return{source:t,target:n}}function ca(e,t,n=ts.Left,o=!1){const i=((null==t?void 0:t.x)??0)+e.internals.positionAbsolute.x,r=((null==t?void 0:t.y)??0)+e.internals.positionAbsolute.y,{width:s,height:a}=t??Rs(e);if(o)return{x:i+s/2,y:r+a/2};switch((null==t?void 0:t.position)??n){case ts.Top:return{x:i+s/2,y:r};case ts.Right:return{x:i+s,y:r+a/2};case ts.Bottom:return{x:i+s/2,y:r+a};case ts.Left:return{x:i,y:r+a/2}}}function da(e,t){return e&&(t?e.find(e=>e.id===t):e[0])||null}function ua(e,t){if(!e)return"";if("string"==typeof e)return e;return`${t?`${t}__`:""}${Object.keys(e).sort().map(t=>`${t}=${e[t]}`).join("&")}`}const ha={nodeOrigin:[0,0],nodeExtent:Vr,elevateNodesOnSelect:!0,defaults:{}},fa={...ha,checkEquality:!0};function pa(e,t){const n={...e};for(const o in t)void 0!==t[o]&&(n[o]=t[o]);return n}function ga(e,t){if(!e.handles)return e.measured?null==t?void 0:t.internals.handleBounds:void 0;const n=[],o=[];for(const i of e.handles){const t={id:i.id,width:i.width??1,height:i.height??1,nodeId:e.id,x:i.x,y:i.y,position:i.position,type:i.type};"source"===i.type?n.push(t):"target"===i.type&&o.push(t)}return{source:n,target:o}}function ma(e,t,n,o){var i,r;const s=pa(fa,o);let a={i:-1},l=e.length>0;const c=new Map(t),d=(null==s?void 0:s.elevateNodesOnSelect)?1e3:0;t.clear(),n.clear();for(const u of e){let e=c.get(u.id);if(s.checkEquality&&u===(null==e?void 0:e.internals.userNode))t.set(u.id,e);else{const n=as(u,s.nodeOrigin),o=zs(u.extent)?u.extent:s.nodeExtent,a=ps(n,o,Rs(u));e={...s.defaults,...u,measured:{width:null==(i=u.measured)?void 0:i.width,height:null==(r=u.measured)?void 0:r.height},internals:{positionAbsolute:a,handleBounds:ga(u,e),z:xa(u,d),userNode:u}},t.set(u.id,e)}void 0!==e.measured&&void 0!==e.measured.width&&void 0!==e.measured.height||e.hidden||(l=!1),u.parentId&&ya(e,t,n,o,a)}return l}function ya(e,t,n,o,i){const{elevateNodesOnSelect:r,nodeOrigin:s,nodeExtent:a}=pa(ha,o),l=e.parentId,c=t.get(l);if(!c)return;!function(e,t){if(!e.parentId)return;const n=t.get(e.parentId);n?n.set(e.id,e):t.set(e.parentId,/* @__PURE__ */new Map([[e.id,e]]))}(e,n),i&&!c.parentId&&void 0===c.internals.rootParentIndex&&(c.internals.rootParentIndex=++i.i,c.internals.z=c.internals.z+10*i.i),i&&void 0!==c.internals.rootParentIndex&&(i.i=c.internals.rootParentIndex);const d=r?1e3:0,{x:u,y:h,z:f}=function(e,t,n,o,i){const{x:r,y:s}=t.internals.positionAbsolute,a=Rs(e),l=as(e,n),c=zs(e.extent)?ps(l,e.extent,a):l;let d=ps({x:r+c.x,y:s+c.y},o,a);"parent"===e.extent&&(d=gs(d,a,t));const u=xa(e,i),h=t.internals.z??0;return{x:d.x,y:d.y,z:h>=u?h+1:u}}(e,c,s,a,d),{positionAbsolute:p}=e.internals,g=u!==p.x||h!==p.y;(g||f!==e.internals.z)&&t.set(e.id,{...e,internals:{...e.internals,positionAbsolute:g?{x:u,y:h}:p,z:f}})}function xa(e,t){return(Es(e.zIndex)?e.zIndex:0)+(e.selected?t:0)}function va(e,t,n,o=[0,0]){var i;const r=[],s=/* @__PURE__ */new Map;for(const a of e){const e=t.get(a.parentId);if(!e)continue;const n=(null==(i=s.get(a.parentId))?void 0:i.expandedRect)??ws(e),o=Cs(n,a.rect);s.set(a.parentId,{expandedRect:o,parent:e})}return s.size>0&&s.forEach(({expandedRect:t,parent:i},s)=>{var a;const l=i.internals.positionAbsolute,c=Rs(i),d=i.origin??o,u=t.x<l.x?Math.round(Math.abs(l.x-t.x)):0,h=t.y<l.y?Math.round(Math.abs(l.y-t.y)):0,f=Math.max(c.width,Math.round(t.width)),p=Math.max(c.height,Math.round(t.height)),g=(f-c.width)*d[0],m=(p-c.height)*d[1];(u>0||h>0||g||m)&&(r.push({id:s,type:"position",position:{x:i.position.x-u+g,y:i.position.y-h+m}}),null==(a=n.get(s))||a.forEach(t=>{e.some(e=>e.id===t.id)||r.push({id:t.id,type:"position",position:{x:t.position.x+u,y:t.position.y+h}})})),(c.width<t.width||c.height<t.height||u||h)&&r.push({id:s,type:"dimensions",setAttributes:!0,dimensions:{width:f+(u?d[0]*u-g:0),height:p+(h?d[1]*h-m:0)}})}),r}function ba(e,t,n,o,i,r){let s=i;const a=o.get(s)||/* @__PURE__ */new Map;o.set(s,a.set(n,t)),s=`${i}-${e}`;const l=o.get(s)||/* @__PURE__ */new Map;if(o.set(s,l.set(n,t)),r){s=`${i}-${e}-${r}`;const a=o.get(s)||/* @__PURE__ */new Map;o.set(s,a.set(n,t))}}function wa(e,t,n){e.clear(),t.clear();for(const o of n){const{source:n,target:i,sourceHandle:r=null,targetHandle:s=null}=o,a={edgeId:o.id,source:n,target:i,sourceHandle:r,targetHandle:s},l=`${n}-${r}--${i}-${s}`;ba("source",a,`${i}-${s}--${n}-${r}`,e,n,r),ba("target",a,l,e,i,s),t.set(o.id,o)}}function Sa(e,t){if(!e.parentId)return!1;const n=t.get(e.parentId);return!!n&&(!!n.selected||Sa(n,t))}function Ca(e,t,n){var o;let i=e;do{if(null==(o=null==i?void 0:i.matches)?void 0:o.call(i,t))return!0;if(i===n)return!1;i=null==i?void 0:i.parentElement}while(i);return!1}function Na({nodeId:e,dragItems:t,nodeLookup:n,dragging:o=!0}){var i,r,s;const a=[];for(const[c,d]of t){const e=null==(i=n.get(c))?void 0:i.internals.userNode;e&&a.push({...e,position:d.position,dragging:o})}if(!e)return[a[0],a];const l=null==(r=n.get(e))?void 0:r.internals.userNode;return[l?{...l,position:(null==(s=t.get(e))?void 0:s.position)||l.position,dragging:o}:a[0],a]}function ka({onNodeMouseDown:e,getStoreItems:t,onDragStart:n,onDrag:o,onDragStop:i}){let r={x:null,y:null},s=0,a=/* @__PURE__ */new Map,l=!1,c={x:0,y:0},d=null,u=!1,h=null,f=!1,p=!1,g=null;return{update:function({noDragClassName:m,handleSelector:y,domNode:x,isSelectable:v,nodeId:b,nodeClickDistance:w=0}){function S({x:e,y:n}){const{nodeLookup:i,nodeExtent:s,snapGrid:l,snapToGrid:c,nodeOrigin:d,onNodeDrag:u,onSelectionDrag:h,onError:f,updateNodePositions:m}=t();r={x:e,y:n};let y=!1;const x=a.size>1,v=x&&s?vs(ls(a)):null,w=x&&c?function({dragItems:e,snapGrid:t,x:n,y:o}){const i=e.values().next().value;if(!i)return null;const r={x:n-i.distance.x,y:o-i.distance.y},s=_s(r,t);return{x:s.x-r.x,y:s.y-r.y}}({dragItems:a,snapGrid:l,x:e,y:n}):null;for(const[t,o]of a){if(!i.has(t))continue;let r={x:e-o.distance.x,y:n-o.distance.y};c&&(r=w?{x:Math.round(r.x+w.x),y:Math.round(r.y+w.y)}:_s(r,l));let a=null;if(x&&s&&!o.extent&&v){const{positionAbsolute:e}=o.internals,t=e.x-v.x+s[0][0],n=e.x+o.measured.width-v.x2+s[1][0];a=[[t,e.y-v.y+s[0][1]],[n,e.y+o.measured.height-v.y2+s[1][1]]]}const{position:u,positionAbsolute:h}=us({nodeId:t,nextPosition:r,nodeLookup:i,nodeExtent:a||s,nodeOrigin:d,onError:f});y=y||o.position.x!==u.x||o.position.y!==u.y,o.position=u,o.internals.positionAbsolute=h}if(p=p||y,y&&(m(a,!0),g&&(o||u||!b&&h))){const[e,t]=Na({nodeId:b,dragItems:a,nodeLookup:i});null==o||o(g,a,e,t),null==u||u(g,e,t),b||null==h||h(g,t)}}async function C(){if(!d)return;const{transform:e,panBy:n,autoPanSpeed:o,autoPanOnNodeDrag:i}=t();if(!i)return l=!1,void cancelAnimationFrame(s);const[a,u]=ys(c,d,o);0===a&&0===u||(r.x=(r.x??0)-a/e[2],r.y=(r.y??0)-u/e[2],await n({x:a,y:u})&&S(r)),s=requestAnimationFrame(C)}function N(o){var i;const{nodeLookup:s,multiSelectionActive:l,nodesDraggable:c,transform:h,snapGrid:f,snapToGrid:p,selectNodesOnDrag:g,onNodeDragStart:m,onSelectionDragStart:y,unselectNodesAndEdges:x}=t();u=!0,g&&v||l||!b||(null==(i=s.get(b))?void 0:i.selected)||x(),v&&g&&b&&(null==e||e(b));const w=$s(o.sourceEvent,{transform:h,snapGrid:f,snapToGrid:p,containerBounds:d});if(r=w,a=function(e,t,n,o){const i=/* @__PURE__ */new Map;for(const[r,s]of e)if((s.selected||s.id===o)&&(!s.parentId||!Sa(s,e))&&(s.draggable||t&&void 0===s.draggable)){const t=e.get(r);t&&i.set(r,{id:r,position:t.position||{x:0,y:0},distance:{x:n.x-t.internals.positionAbsolute.x,y:n.y-t.internals.positionAbsolute.y},extent:t.extent,parentId:t.parentId,origin:t.origin,expandParent:t.expandParent,internals:{positionAbsolute:t.internals.positionAbsolute||{x:0,y:0}},measured:{width:t.measured.width??0,height:t.measured.height??0}})}return i}(s,c,w,b),a.size>0&&(n||m||!b&&y)){const[e,t]=Na({nodeId:b,dragItems:a,nodeLookup:s});null==n||n(o.sourceEvent,a,e,t),null==m||m(o.sourceEvent,e,t),b||null==y||y(o.sourceEvent,t)}}h=io(x);const k=vo().clickDistance(w).on("start",e=>{const{domNode:n,nodeDragThreshold:o,transform:i,snapGrid:s,snapToGrid:a}=t();d=(null==n?void 0:n.getBoundingClientRect())||null,f=!1,p=!1,g=e.sourceEvent,0===o&&N(e);const l=$s(e.sourceEvent,{transform:i,snapGrid:s,snapToGrid:a,containerBounds:d});r=l,c=Zs(e.sourceEvent,d)}).on("drag",e=>{const{autoPanOnNodeDrag:n,transform:o,snapGrid:i,snapToGrid:s,nodeDragThreshold:h,nodeLookup:p}=t(),m=$s(e.sourceEvent,{transform:o,snapGrid:i,snapToGrid:s,containerBounds:d});if(g=e.sourceEvent,("touchmove"===e.sourceEvent.type&&e.sourceEvent.touches.length>1||b&&!p.has(b))&&(f=!0),!f){if(!l&&n&&u&&(l=!0,C()),!u){const t=Zs(e.sourceEvent,d),n=t.x-c.x,o=t.y-c.y;Math.sqrt(n*n+o*o)>h&&N(e)}(r.x!==m.xSnapped||r.y!==m.ySnapped)&&a&&u&&(c=Zs(e.sourceEvent,d),S(m))}}).on("end",e=>{if(u&&!f&&(l=!1,u=!1,cancelAnimationFrame(s),a.size>0)){const{nodeLookup:n,updateNodePositions:o,onNodeDragStop:r,onSelectionDragStop:s}=t();if(p&&(o(a,!1),p=!1),i||r||!b&&s){const[t,o]=Na({nodeId:b,dragItems:a,nodeLookup:n,dragging:!1});null==i||i(e.sourceEvent,a,t,o),null==r||r(e.sourceEvent,t,o),b||null==s||s(e.sourceEvent,o)}}}).filter(e=>{const t=e.target;return!e.button&&(!m||!Ca(t,`.${m}`,x))&&(!y||Ca(t,y,x))});h.call(k)},destroy:function(){null==h||h.on(".drag",null)}}}function Ea(e,t,n,o){var i,r;let s=[],a=1/0;const l=function(e,t,n){const o=[],i={x:e.x-n,y:e.y-n,width:2*n,height:2*n};for(const r of t.values())Ns(i,ws(r))>0&&o.push(r);return o}(e,n,t+250);for(const c of l){const n=[...(null==(i=c.internals.handleBounds)?void 0:i.source)??[],...(null==(r=c.internals.handleBounds)?void 0:r.target)??[]];for(const i of n){if(o.nodeId===i.nodeId&&o.type===i.type&&o.id===i.id)continue;const{x:n,y:r}=ca(c,i,i.position,!0),l=Math.sqrt(Math.pow(n-e.x,2)+Math.pow(r-e.y,2));l>t||(l<a?(s=[{...i,x:n,y:r}],a=l):l===a&&s.push({...i,x:n,y:r}))}}if(!s.length)return null;if(s.length>1){const e="source"===o.type?"target":"source";return s.find(t=>t.type===e)??s[0]}return s[0]}function Ma(e,t,n,o,i,r=!1){var s,a,l;const c=o.get(e);if(!c)return null;const d="strict"===i?null==(s=c.internals.handleBounds)?void 0:s[t]:[...(null==(a=c.internals.handleBounds)?void 0:a.source)??[],...(null==(l=c.internals.handleBounds)?void 0:l.target)??[]],u=(n?null==d?void 0:d.find(e=>e.id===n):null==d?void 0:d[0])??null;return u&&r?{...u,...ca(c,u,u.position,!0)}:u}function _a(e,t){return e||((null==t?void 0:t.classList.contains("target"))?"target":(null==t?void 0:t.classList.contains("source"))?"source":null)}const ja=()=>!0;function Pa(e,{handle:t,connectionMode:n,fromNodeId:o,fromHandleId:i,fromType:r,doc:s,lib:a,flowId:l,isValidConnection:c=ja,nodeLookup:d}){const u="target"===r,h=t?s.querySelector(`.${a}-flow__handle[data-id="${l}-${null==t?void 0:t.nodeId}-${null==t?void 0:t.id}-${null==t?void 0:t.type}"]`):null,{x:f,y:p}=Zs(e),g=s.elementFromPoint(f,p),m=(null==g?void 0:g.classList.contains(`${a}-flow__handle`))?g:h,y={handleDomNode:m,isValid:!1,connection:null,toHandle:null};if(m){const e=_a(void 0,m),t=m.getAttribute("data-nodeid"),r=m.getAttribute("data-handleid"),s=m.classList.contains("connectable"),a=m.classList.contains("connectableend");if(!t||!e)return y;const l={source:u?t:o,sourceHandle:u?r:i,target:u?o:t,targetHandle:u?i:r};y.connection=l;const h=s&&a&&(n===Xr.Strict?u&&"source"===e||!u&&"target"===e:t!==o||r!==i);y.isValid=h&&c(l),y.toHandle=Ma(t,e,r,d,n,!0)}return y}const Ia={onPointerDown:function(e,{connectionMode:t,connectionRadius:n,handleId:o,nodeId:i,edgeUpdaterType:r,isTarget:s,domNode:a,nodeLookup:l,lib:c,autoPanOnConnect:d,flowId:u,panBy:h,cancelConnection:f,onConnectStart:p,onConnect:g,onConnectEnd:m,isValidConnection:y=ja,onReconnectEnd:x,updateConnection:v,getTransform:b,getFromHandle:w,autoPanSpeed:S,dragThreshold:C=1,handleDomNode:N}){const k=Hs(e.target);let E,M=0;const{x:_,y:j}=Zs(e),P=_a(r,N),I=null==a?void 0:a.getBoundingClientRect();let A=!1;if(!I||!P)return;const D=Ma(i,P,o,l,t);if(!D)return;let z=Zs(e,I),R=!1,O=null,B=!1,L=null;function T(){if(!d||!I)return;const[e,t]=ys(z,I,S);h({x:e,y:t}),M=requestAnimationFrame(T)}const $={...D,nodeId:i,type:P,position:D.position},V=l.get(i);let H={inProgress:!0,isValid:null,from:ca(V,$,ts.Left,!0),fromHandle:$,fromPosition:$.position,fromNode:V,to:z,toHandle:null,toPosition:os[$.position],toNode:null};function F(){A=!0,v(H),null==p||p(e,{nodeId:i,handleId:o,handleType:P})}function X(e){if(!A){const{x:t,y:n}=Zs(e),o=t-_,i=n-j;if(!(o*o+i*i>C*C))return;F()}if(!w()||!$)return void Y(e);const r=b();z=Zs(e,I),E=Ea(js(z,r,!1,[1,1]),n,l,$),R||(T(),R=!0);const a=Pa(e,{handle:E,connectionMode:t,fromNodeId:i,fromHandleId:o,fromType:s?"target":"source",isValidConnection:y,doc:k,lib:c,flowId:u,nodeLookup:l});L=a.handleDomNode,O=a.connection,B=function(e,t){let n=null;return t?n=!0:e&&!t&&(n=!1),n}(!!E,a.isValid);const d={...H,isValid:B,to:a.toHandle&&B?Ps({x:a.toHandle.x,y:a.toHandle.y},r):z,toHandle:a.toHandle,toPosition:B&&a.toHandle?a.toHandle.position:os[$.position],toNode:a.toHandle?l.get(a.toHandle.nodeId):null};B&&E&&H.toHandle&&d.toHandle&&H.toHandle.type===d.toHandle.type&&H.toHandle.nodeId===d.toHandle.nodeId&&H.toHandle.id===d.toHandle.id&&H.to.x===d.to.x&&H.to.y===d.to.y||(v(d),H=d)}function Y(e){if(!("touches"in e&&e.touches.length>0)){if(A){(E||L)&&O&&B&&(null==g||g(O));const{inProgress:t,...n}=H,o={...n,toPosition:H.toHandle?H.toPosition:null};null==m||m(e,o),r&&(null==x||x(e,o))}f(),cancelAnimationFrame(M),R=!1,B=!1,O=null,L=null,k.removeEventListener("mousemove",X),k.removeEventListener("mouseup",Y),k.removeEventListener("touchmove",X),k.removeEventListener("touchend",Y)}}0===C&&F(),k.addEventListener("mousemove",X),k.addEventListener("mouseup",Y),k.addEventListener("touchmove",X),k.addEventListener("touchend",Y)},isValid:Pa};const Aa=e=>({x:e.x,y:e.y,zoom:e.k}),Da=({x:e,y:t,zoom:n})=>br.translate(e,t).scale(n),za=(e,t)=>e.target.closest(`.${t}`),Ra=(e,t)=>2===t&&Array.isArray(e)&&e.includes(2),Oa=e=>((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2,Ba=(e,t=0,n=Oa,o=()=>{})=>{const i="number"==typeof t&&t>0;return i||o(),i?e.transition().duration(t).ease(n).on("end",o):e},La=e=>{const t=e.ctrlKey&&Ds()?10:1;return-e.deltaY*(1===e.deltaMode?.05:e.deltaMode?1:.002)*t};function Ta({domNode:e,minZoom:t,maxZoom:n,translateExtent:o,viewport:i,onPanZoom:r,onPanZoomStart:s,onPanZoomEnd:a,onDraggingChange:l}){const c={isZoomingOrPanning:!1,usedRightMouseButton:!1,prevViewport:{},mouseButton:0,timerId:void 0,panScrollTimeout:void 0,isPanScrolling:!1},d=e.getBoundingClientRect(),u=Pr().scaleExtent([t,n]).translateExtent(o),h=io(e).call(u);y({x:i.x,y:i.y,zoom:fs(i.zoom,t,n)},[[0,0],[d.width,d.height]],o);const f=h.on("wheel.zoom"),p=h.on("dblclick.zoom");function g(e,t){return h?new Promise(n=>{null==u||u.interpolate("linear"===(null==t?void 0:t.interpolate)?hi:wi).transform(Ba(h,null==t?void 0:t.duration,null==t?void 0:t.ease,()=>n(!0)),e)}):Promise.resolve(!1)}function m(){u.on("zoom",null)}async function y(e,t,n){const o=Da(e),i=null==u?void 0:u.constrain()(o,t,n);return i&&await g(i),new Promise(e=>e(i))}return u.wheelDelta(La),{update:function({noWheelClassName:e,noPanClassName:t,onPaneContextMenu:n,userSelectionActive:o,panOnScroll:i,panOnDrag:d,panOnScrollMode:g,panOnScrollSpeed:y,preventScrolling:x,zoomOnPinch:v,zoomOnScroll:b,zoomOnDoubleClick:w,zoomActivationKeyPressed:S,lib:C,onTransformChange:N,connectionInProgress:k,paneClickDistance:E,selectionOnDrag:M}){o&&!c.isZoomingOrPanning&&m();const _=i&&!S&&!o;u.clickDistance(M?1/0:!Es(E)||E<0?0:E);const j=_?function({zoomPanValues:e,noWheelClassName:t,d3Selection:n,d3Zoom:o,panOnScrollMode:i,panOnScrollSpeed:r,zoomOnPinch:s,onPanZoomStart:a,onPanZoom:l,onPanZoomEnd:c}){return d=>{if(za(d,t))return d.ctrlKey&&d.preventDefault(),!1;d.preventDefault(),d.stopImmediatePropagation();const u=n.property("__zoom").k||1;if(d.ctrlKey&&s){const e=ro(d),t=La(d),i=u*Math.pow(2,t);return void o.scaleTo(n,i,e,d)}const h=1===d.deltaMode?20:1;let f=i===Zr.Vertical?0:d.deltaX*h,p=i===Zr.Horizontal?0:d.deltaY*h;!Ds()&&d.shiftKey&&i!==Zr.Vertical&&(f=d.deltaY*h,p=0),o.translateBy(n,-f/u*r,-p/u*r,{internal:!0});const g=Aa(n.property("__zoom"));clearTimeout(e.panScrollTimeout),e.isPanScrolling?(null==l||l(d,g),e.panScrollTimeout=setTimeout(()=>{null==c||c(d,g),e.isPanScrolling=!1},150)):(e.isPanScrolling=!0,null==a||a(d,g))}}({zoomPanValues:c,noWheelClassName:e,d3Selection:h,d3Zoom:u,panOnScrollMode:g,panOnScrollSpeed:y,zoomOnPinch:v,onPanZoomStart:s,onPanZoom:r,onPanZoomEnd:a}):function({noWheelClassName:e,preventScrolling:t,d3ZoomHandler:n}){return function(o,i){const r="wheel"===o.type,s=!t&&r&&!o.ctrlKey,a=za(o,e);if(o.ctrlKey&&r&&a&&o.preventDefault(),s||a)return null;o.preventDefault(),n.call(this,o,i)}}({noWheelClassName:e,preventScrolling:x,d3ZoomHandler:f});if(h.on("wheel.zoom",j,{passive:!1}),!o){const e=function({zoomPanValues:e,onDraggingChange:t,onPanZoomStart:n}){return o=>{var i,r,s;if(null==(i=o.sourceEvent)?void 0:i.internal)return;const a=Aa(o.transform);e.mouseButton=(null==(r=o.sourceEvent)?void 0:r.button)||0,e.isZoomingOrPanning=!0,e.prevViewport=a,"mousedown"===(null==(s=o.sourceEvent)?void 0:s.type)&&t(!0),n&&(null==n||n(o.sourceEvent,a))}}({zoomPanValues:c,onDraggingChange:l,onPanZoomStart:s});u.on("start",e);const t=function({zoomPanValues:e,panOnDrag:t,onPaneContextMenu:n,onTransformChange:o,onPanZoom:i}){return r=>{var s,a;e.usedRightMouseButton=!(!n||!Ra(t,e.mouseButton??0)),(null==(s=r.sourceEvent)?void 0:s.sync)||o([r.transform.x,r.transform.y,r.transform.k]),i&&!(null==(a=r.sourceEvent)?void 0:a.internal)&&(null==i||i(r.sourceEvent,Aa(r.transform)))}}({zoomPanValues:c,panOnDrag:d,onPaneContextMenu:!!n,onPanZoom:r,onTransformChange:N});u.on("zoom",t);const o=function({zoomPanValues:e,panOnDrag:t,panOnScroll:n,onDraggingChange:o,onPanZoomEnd:i,onPaneContextMenu:r}){return s=>{var a;if(!(null==(a=s.sourceEvent)?void 0:a.internal)&&(e.isZoomingOrPanning=!1,r&&Ra(t,e.mouseButton??0)&&!e.usedRightMouseButton&&s.sourceEvent&&r(s.sourceEvent),e.usedRightMouseButton=!1,o(!1),i)){const t=Aa(s.transform);e.prevViewport=t,clearTimeout(e.timerId),e.timerId=setTimeout(()=>{null==i||i(s.sourceEvent,t)},n?150:0)}}}({zoomPanValues:c,panOnDrag:d,panOnScroll:i,onPaneContextMenu:n,onPanZoomEnd:a,onDraggingChange:l});u.on("end",o)}const P=function({zoomActivationKeyPressed:e,zoomOnScroll:t,zoomOnPinch:n,panOnDrag:o,panOnScroll:i,zoomOnDoubleClick:r,userSelectionActive:s,noWheelClassName:a,noPanClassName:l,lib:c,connectionInProgress:d}){return u=>{var h;const f=e||t,p=n&&u.ctrlKey,g="wheel"===u.type;if(1===u.button&&"mousedown"===u.type&&(za(u,`${c}-flow__node`)||za(u,`${c}-flow__edge`)))return!0;if(!(o||f||i||r||n))return!1;if(s)return!1;if(d&&!g)return!1;if(za(u,a)&&g)return!1;if(za(u,l)&&(!g||i&&g&&!e))return!1;if(!n&&u.ctrlKey&&g)return!1;if(!n&&"touchstart"===u.type&&(null==(h=u.touches)?void 0:h.length)>1)return u.preventDefault(),!1;if(!f&&!i&&!p&&g)return!1;if(!o&&("mousedown"===u.type||"touchstart"===u.type))return!1;if(Array.isArray(o)&&!o.includes(u.button)&&"mousedown"===u.type)return!1;const m=Array.isArray(o)&&o.includes(u.button)||!u.button||u.button<=1;return(!u.ctrlKey||g)&&m}}({zoomActivationKeyPressed:S,panOnDrag:d,zoomOnScroll:b,panOnScroll:i,zoomOnDoubleClick:w,zoomOnPinch:v,userSelectionActive:o,noPanClassName:t,noWheelClassName:e,lib:C,connectionInProgress:k});u.filter(P),w?h.on("dblclick.zoom",p):h.on("dblclick.zoom",null)},destroy:m,setViewport:async function(e,t){const n=Da(e);return await g(n,t),new Promise(e=>e(n))},setViewportConstrained:y,getViewport:function(){const e=h?wr(h.node()):{x:0,y:0,k:1};return{x:e.x,y:e.y,zoom:e.k}},scaleTo:function(e,t){return h?new Promise(n=>{null==u||u.interpolate("linear"===(null==t?void 0:t.interpolate)?hi:wi).scaleTo(Ba(h,null==t?void 0:t.duration,null==t?void 0:t.ease,()=>n(!0)),e)}):Promise.resolve(!1)},scaleBy:function(e,t){return h?new Promise(n=>{null==u||u.interpolate("linear"===(null==t?void 0:t.interpolate)?hi:wi).scaleBy(Ba(h,null==t?void 0:t.duration,null==t?void 0:t.ease,()=>n(!0)),e)}):Promise.resolve(!1)},setScaleExtent:function(e){null==u||u.scaleExtent(e)},setTranslateExtent:function(e){null==u||u.translateExtent(e)},syncViewport:function(e){if(h){const t=Da(e),n=h.property("__zoom");n.k===e.zoom&&n.x===e.x&&n.y===e.y||null==u||u.transform(h,t,null,{sync:!0})}},setClickDistance:function(e){const t=!Es(e)||e<0?0:e;null==u||u.clickDistance(t)}}}var $a,Va;function Ha(e){return{isHorizontal:e.includes("right")||e.includes("left"),isVertical:e.includes("bottom")||e.includes("top"),affectsX:e.includes("left"),affectsY:e.includes("top")}}function Fa(e,t){return Math.max(0,t-e)}function Xa(e,t){return Math.max(0,e-t)}function Ya(e,t,n){return Math.max(0,t-e,e-n)}function Za(e,t){return e?!t:t}(Va=$a||($a={})).Line="line",Va.Handle="handle";const Ka={width:0,height:0,x:0,y:0},Wa={...Ka,pointerX:0,pointerY:0,aspectRatio:1};function qa(e,t,n){const o=t.position.x+e.position.x,i=t.position.y+e.position.y,r=e.measured.width??0,s=e.measured.height??0,a=n[0]*r,l=n[1]*s;return[[o-a,i-l],[o+r-a,i+s-l]]}function Ga({domNode:e,nodeId:t,getStoreItems:n,onChange:o,onEnd:i}){const r=io(e);let s={controlDirection:Ha("bottom-right"),boundaries:{minWidth:0,minHeight:0,maxWidth:Number.MAX_VALUE,maxHeight:Number.MAX_VALUE},resizeDirection:void 0,keepAspectRatio:!1};return{update:function({controlPosition:e,boundaries:a,keepAspectRatio:l,resizeDirection:c,onResizeStart:d,onResize:u,onResizeEnd:h,shouldResize:f}){let p,g={...Ka},m={...Wa};s={boundaries:a,resizeDirection:c,keepAspectRatio:l,controlDirection:Ha(e)};let y,x,v,b=null,w=[],S=!1;const C=vo().on("start",e=>{const{nodeLookup:o,transform:i,snapGrid:r,snapToGrid:s,nodeOrigin:a,paneDomNode:l}=n();if(p=o.get(t),!p)return;b=(null==l?void 0:l.getBoundingClientRect())??null;const{xSnapped:c,ySnapped:u}=$s(e.sourceEvent,{transform:i,snapGrid:r,snapToGrid:s,containerBounds:b});g={width:p.measured.width??0,height:p.measured.height??0,x:p.position.x??0,y:p.position.y??0},m={...g,pointerX:c,pointerY:u,aspectRatio:g.width/g.height},y=void 0,p.parentId&&("parent"===p.extent||p.expandParent)&&(y=o.get(p.parentId),x=y&&"parent"===p.extent?function(e){return[[0,0],[e.measured.width,e.measured.height]]}(y):void 0),w=[],v=void 0;for(const[n,d]of o)if(d.parentId===t&&(w.push({id:n,position:{...d.position},extent:d.extent}),"parent"===d.extent||d.expandParent)){const e=qa(d,p,d.origin??a);v=v?[[Math.min(e[0][0],v[0][0]),Math.min(e[0][1],v[0][1])],[Math.max(e[1][0],v[1][0]),Math.max(e[1][1],v[1][1])]]:e}null==d||d(e,{...g})}).on("drag",e=>{const{transform:t,snapGrid:i,snapToGrid:r,nodeOrigin:a}=n(),l=$s(e.sourceEvent,{transform:t,snapGrid:i,snapToGrid:r,containerBounds:b}),c=[];if(!p)return;const{x:d,y:h,width:C,height:N}=g,k={},E=p.origin??a,{width:M,height:_,x:j,y:P}=function(e,t,n,o,i,r,s,a){let{affectsX:l,affectsY:c}=t;const{isHorizontal:d,isVertical:u}=t,h=d&&u,{xSnapped:f,ySnapped:p}=n,{minWidth:g,maxWidth:m,minHeight:y,maxHeight:x}=o,{x:v,y:b,width:w,height:S,aspectRatio:C}=e;let N=Math.floor(d?f-e.pointerX:0),k=Math.floor(u?p-e.pointerY:0);const E=w+(l?-N:N),M=S+(c?-k:k),_=-r[0]*w,j=-r[1]*S;let P=Ya(E,g,m),I=Ya(M,y,x);if(s){let e=0,t=0;l&&N<0?e=Fa(v+N+_,s[0][0]):!l&&N>0&&(e=Xa(v+E+_,s[1][0])),c&&k<0?t=Fa(b+k+j,s[0][1]):!c&&k>0&&(t=Xa(b+M+j,s[1][1])),P=Math.max(P,e),I=Math.max(I,t)}if(a){let e=0,t=0;l&&N>0?e=Xa(v+N,a[0][0]):!l&&N<0&&(e=Fa(v+E,a[1][0])),c&&k>0?t=Xa(b+k,a[0][1]):!c&&k<0&&(t=Fa(b+M,a[1][1])),P=Math.max(P,e),I=Math.max(I,t)}if(i){if(d){const e=Ya(E/C,y,x)*C;if(P=Math.max(P,e),s){let e=0;e=!l&&!c||l&&!c&&h?Xa(b+j+E/C,s[1][1])*C:Fa(b+j+(l?N:-N)/C,s[0][1])*C,P=Math.max(P,e)}if(a){let e=0;e=!l&&!c||l&&!c&&h?Fa(b+E/C,a[1][1])*C:Xa(b+(l?N:-N)/C,a[0][1])*C,P=Math.max(P,e)}}if(u){const e=Ya(M*C,g,m)/C;if(I=Math.max(I,e),s){let e=0;e=!l&&!c||c&&!l&&h?Xa(v+M*C+_,s[1][0])/C:Fa(v+(c?k:-k)*C+_,s[0][0])/C,I=Math.max(I,e)}if(a){let e=0;e=!l&&!c||c&&!l&&h?Fa(v+M*C,a[1][0])/C:Xa(v+(c?k:-k)*C,a[0][0])/C,I=Math.max(I,e)}}}k+=k<0?I:-I,N+=N<0?P:-P,i&&(h?E>M*C?k=(Za(l,c)?-N:N)/C:N=(Za(l,c)?-k:k)*C:d?(k=N/C,c=l):(N=k*C,l=c));const A=l?v+N:v,D=c?b+k:b;return{width:w+(l?-N:N),height:S+(c?-k:k),x:r[0]*N*(l?-1:1)+A,y:r[1]*k*(c?-1:1)+D}}(m,s.controlDirection,l,s.boundaries,s.keepAspectRatio,E,x,v),I=M!==C,A=_!==N,D=j!==d&&I,z=P!==h&&A;if(!(D||z||I||A))return;if((D||z||1===E[0]||1===E[1])&&(k.x=D?j:g.x,k.y=z?P:g.y,g.x=k.x,g.y=k.y,w.length>0)){const e=j-d,t=P-h;for(const n of w)n.position={x:n.position.x-e+E[0]*(M-C),y:n.position.y-t+E[1]*(_-N)},c.push(n)}if((I||A)&&(k.width=!I||s.resizeDirection&&"horizontal"!==s.resizeDirection?g.width:M,k.height=!A||s.resizeDirection&&"vertical"!==s.resizeDirection?g.height:_,g.width=k.width,g.height=k.height),y&&p.expandParent){const e=E[0]*(k.width??0);k.x&&k.x<e&&(g.x=e,m.x=m.x-(k.x-e));const t=E[1]*(k.height??0);k.y&&k.y<t&&(g.y=t,m.y=m.y-(k.y-t))}const R=function({width:e,prevWidth:t,height:n,prevHeight:o,affectsX:i,affectsY:r}){const s=e-t,a=n-o,l=[s>0?1:s<0?-1:0,a>0?1:a<0?-1:0];return s&&i&&(l[0]=-1*l[0]),a&&r&&(l[1]=-1*l[1]),l}({width:g.width,prevWidth:C,height:g.height,prevHeight:N,affectsX:s.controlDirection.affectsX,affectsY:s.controlDirection.affectsY}),O={...g,direction:R};!1!==(null==f?void 0:f(e,O))&&(S=!0,null==u||u(e,O),o(k,c))}).on("end",e=>{S&&(null==h||h(e,{...g}),null==i||i({...g}),S=!1)});r.call(C)},destroy:function(){r.on(".drag",null)}}}var Ua,Qa,Ja,el,tl={exports:{}},nl={},ol={exports:{}},il={};function rl(){return Qa||(Qa=1,ol.exports=function(){if(Ua)return il;Ua=1;var e=O(),t="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},n=e.useState,o=e.useEffect,i=e.useLayoutEffect,r=e.useDebugValue;function s(e){var n=e.getSnapshot;e=e.value;try{var o=n();return!t(e,o)}catch(i){return!0}}var a="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var a=t(),l=n({inst:{value:a,getSnapshot:t}}),c=l[0].inst,d=l[1];return i(function(){c.value=a,c.getSnapshot=t,s(c)&&d({inst:c})},[e,a,t]),o(function(){return s(c)&&d({inst:c}),e(function(){s(c)&&d({inst:c})})},[e]),r(a),a};return il.useSyncExternalStore=void 0!==e.useSyncExternalStore?e.useSyncExternalStore:a,il}()),ol.exports}const sl=/* @__PURE__ */B((el||(el=1,tl.exports=function(){if(Ja)return nl;Ja=1;var e=O(),t=rl(),n="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},o=t.useSyncExternalStore,i=e.useRef,r=e.useEffect,s=e.useMemo,a=e.useDebugValue;return nl.useSyncExternalStoreWithSelector=function(e,t,l,c,d){var u=i(null);if(null===u.current){var h={hasValue:!1,value:null};u.current=h}else h=u.current;u=s(function(){function e(e){if(!r){if(r=!0,o=e,e=c(e),void 0!==d&&h.hasValue){var t=h.value;if(d(t,e))return i=t}return i=e}if(t=i,n(o,e))return t;var s=c(e);return void 0!==d&&d(t,s)?(o=e,t):(o=e,i=s)}var o,i,r=!1,s=void 0===l?null:l;return[function(){return e(t())},null===s?void 0:function(){return e(s())}]},[t,l,c,d]);var f=o(e,u[0],u[1]);return r(function(){h.hasValue=!0,h.value=f},[f]),a(f),f},nl}()),tl.exports)),al=e=>{let t;const n=/* @__PURE__ */new Set,o=(e,o)=>{const i="function"==typeof e?e(t):e;if(!Object.is(i,t)){const e=t;t=(null!=o?o:"object"!=typeof i||null===i)?i:Object.assign({},t,i),n.forEach(n=>n(t,e))}},i=()=>t,r={setState:o,getState:i,getInitialState:()=>s,subscribe:e=>(n.add(e),()=>n.delete(e)),destroy:()=>{n.clear()}},s=t=e(o,i,r);return r},{useDebugValue:ll}=N,{useSyncExternalStoreWithSelector:cl}=sl,dl=e=>e;function ul(e,t=dl,n){const o=cl(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return ll(o),o}const hl=(e,t)=>{const n=(e=>e?al(e):al)(e),o=(e,o=t)=>ul(n,e,o);return Object.assign(o,n),o};function fl(e,t){if(Object.is(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(const[n,o]of e)if(!Object.is(o,t.get(n)))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!1;for(const o of n)if(!Object.prototype.hasOwnProperty.call(t,o)||!Object.is(e[o],t[o]))return!1;return!0}const pl=s.createContext(null),gl=pl.Provider,ml=Ir();function yl(e,t){const n=s.useContext(pl);if(null===n)throw new Error(ml);return ul(n,e,t)}function xl(){const e=s.useContext(pl);if(null===e)throw new Error(ml);return s.useMemo(()=>({getState:e.getState,setState:e.setState,subscribe:e.subscribe}),[e])}const vl={display:"none"},bl={position:"absolute",width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},wl="react-flow__node-desc",Sl="react-flow__edge-desc",Cl=e=>e.ariaLiveMessage,Nl=e=>e.ariaLabelConfig;function kl({rfId:e}){const t=yl(Cl);return b.jsx("div",{id:`react-flow__aria-live-${e}`,"aria-live":"assertive","aria-atomic":"true",style:bl,children:t})}function El({rfId:e,disableKeyboardA11y:t}){const n=yl(Nl);return b.jsxs(b.Fragment,{children:[b.jsx("div",{id:`${wl}-${e}`,style:vl,children:t?n["node.a11yDescription.default"]:n["node.a11yDescription.keyboardDisabled"]}),b.jsx("div",{id:`${Sl}-${e}`,style:vl,children:n["edge.a11yDescription.default"]}),!t&&b.jsx(kl,{rfId:e})]})}const Ml=s.forwardRef(({position:e="top-left",children:t,className:n,style:o,...i},r)=>{const s=`${e}`.split("-");return b.jsx("div",{className:Tt(["react-flow__panel",n,...s]),style:o,ref:r,...i,children:t})});function _l({proOptions:e,position:t="bottom-right"}){return(null==e?void 0:e.hideAttribution)?null:b.jsx(Ml,{position:t,className:"react-flow__attribution","data-message":"Please only hide this attribution when you are subscribed to React Flow Pro: https://pro.reactflow.dev",children:b.jsx("a",{href:"https://reactflow.dev",target:"_blank",rel:"noopener noreferrer","aria-label":"React Flow attribution",children:"React Flow"})})}Ml.displayName="Panel";const jl=e=>{const t=[],n=[];for(const[,o]of e.nodeLookup)o.selected&&t.push(o.internals.userNode);for(const[,o]of e.edgeLookup)o.selected&&n.push(o);return{selectedNodes:t,selectedEdges:n}},Pl=e=>e.id;function Il(e,t){return fl(e.selectedNodes.map(Pl),t.selectedNodes.map(Pl))&&fl(e.selectedEdges.map(Pl),t.selectedEdges.map(Pl))}function Al({onSelectionChange:e}){const t=xl(),{selectedNodes:n,selectedEdges:o}=yl(jl,Il);return s.useEffect(()=>{const i={nodes:n,edges:o};null==e||e(i),t.getState().onSelectionChangeHandlers.forEach(e=>e(i))},[n,o,e]),null}const Dl=e=>!!e.onSelectionChangeHandlers;function zl({onSelectionChange:e}){const t=yl(Dl);return e||t?b.jsx(Al,{onSelectionChange:e}):null}const Rl=[0,0],Ol={x:0,y:0,zoom:1},Bl=["nodes","edges","defaultNodes","defaultEdges","onConnect","onConnectStart","onConnectEnd","onClickConnectStart","onClickConnectEnd","nodesDraggable","autoPanOnNodeFocus","nodesConnectable","nodesFocusable","edgesFocusable","edgesReconnectable","elevateNodesOnSelect","elevateEdgesOnSelect","minZoom","maxZoom","nodeExtent","onNodesChange","onEdgesChange","elementsSelectable","connectionMode","snapGrid","snapToGrid","translateExtent","connectOnClick","defaultEdgeOptions","fitView","fitViewOptions","onNodesDelete","onEdgesDelete","onDelete","onNodeDrag","onNodeDragStart","onNodeDragStop","onSelectionDrag","onSelectionDragStart","onSelectionDragStop","onMoveStart","onMove","onMoveEnd","noPanClassName","nodeOrigin","autoPanOnConnect","autoPanOnNodeDrag","onError","connectionRadius","isValidConnection","selectNodesOnDrag","nodeDragThreshold","connectionDragThreshold","onBeforeDelete","debug","autoPanSpeed","ariaLabelConfig","rfId"],Ll=e=>({setNodes:e.setNodes,setEdges:e.setEdges,setMinZoom:e.setMinZoom,setMaxZoom:e.setMaxZoom,setTranslateExtent:e.setTranslateExtent,setNodeExtent:e.setNodeExtent,reset:e.reset,setDefaultNodesAndEdges:e.setDefaultNodesAndEdges}),Tl={translateExtent:Vr,nodeOrigin:Rl,minZoom:.5,maxZoom:2,elementsSelectable:!0,noPanClassName:"nopan",rfId:"1"};function $l(e){const{setNodes:t,setEdges:n,setMinZoom:o,setMaxZoom:i,setTranslateExtent:r,setNodeExtent:a,reset:l,setDefaultNodesAndEdges:c}=yl(Ll,fl),d=xl();s.useEffect(()=>(c(e.defaultNodes,e.defaultEdges),()=>{u.current=Tl,l()}),[]);const u=s.useRef(Tl);return s.useEffect(()=>{for(const s of Bl){const l=e[s];l!==u.current[s]&&(void 0!==e[s]&&("nodes"===s?t(l):"edges"===s?n(l):"minZoom"===s?o(l):"maxZoom"===s?i(l):"translateExtent"===s?r(l):"nodeExtent"===s?a(l):"ariaLabelConfig"===s?d.setState({ariaLabelConfig:Ts(l)}):"fitView"===s?d.setState({fitViewQueued:l}):"fitViewOptions"===s?d.setState({fitViewOptions:l}):d.setState({[s]:l})))}u.current=e},Bl.map(t=>e[t])),null}function Vl(){return"undefined"!=typeof window&&window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)"):null}const Hl="undefined"!=typeof document?document:null;function Fl(e=null,t={target:Hl,actInsideInputWithModifier:!0}){const[n,o]=s.useState(!1),i=s.useRef(!1),r=s.useRef(/* @__PURE__ */new Set([])),[a,l]=s.useMemo(()=>{if(null!==e){const t=(Array.isArray(e)?e:[e]).filter(e=>"string"==typeof e).map(e=>e.replace("+","\n").replace("\n\n","\n+").split("\n")),n=t.reduce((e,t)=>e.concat(...t),[]);return[t,n]}return[[],[]]},[e]);return s.useEffect(()=>{const n=(null==t?void 0:t.target)??Hl,s=(null==t?void 0:t.actInsideInputWithModifier)??!0;if(null!==e){const e=e=>{var n,c;i.current=e.ctrlKey||e.metaKey||e.shiftKey||e.altKey;if((!i.current||i.current&&!s)&&Xs(e))return!1;const d=Yl(e.code,l);if(r.current.add(e[d]),Xl(a,r.current,!1)){const r=(null==(c=null==(n=e.composedPath)?void 0:n.call(e))?void 0:c[0])||e.target,s="BUTTON"===(null==r?void 0:r.nodeName)||"A"===(null==r?void 0:r.nodeName);!1===t.preventDefault||!i.current&&s||e.preventDefault(),o(!0)}},c=e=>{const t=Yl(e.code,l);Xl(a,r.current,!0)?(o(!1),r.current.clear()):r.current.delete(e[t]),"Meta"===e.key&&r.current.clear(),i.current=!1},d=()=>{r.current.clear(),o(!1)};return null==n||n.addEventListener("keydown",e),null==n||n.addEventListener("keyup",c),window.addEventListener("blur",d),window.addEventListener("contextmenu",d),()=>{null==n||n.removeEventListener("keydown",e),null==n||n.removeEventListener("keyup",c),window.removeEventListener("blur",d),window.removeEventListener("contextmenu",d)}}},[e,o]),n}function Xl(e,t,n){return e.filter(e=>n||e.length===t.size).some(e=>e.every(e=>t.has(e)))}function Yl(e,t){return t.includes(e)?"code":"key"}function Zl(e,t){const n=[],o=/* @__PURE__ */new Map,i=[];for(const r of e)if("add"!==r.type)if("remove"===r.type||"replace"===r.type)o.set(r.id,[r]);else{const e=o.get(r.id);e?e.push(r):o.set(r.id,[r])}else i.push(r);for(const r of t){const e=o.get(r.id);if(!e){n.push(r);continue}if("remove"===e[0].type)continue;if("replace"===e[0].type){n.push({...e[0].item});continue}const t={...r};for(const n of e)Kl(n,t);n.push(t)}return i.length&&i.forEach(e=>{void 0!==e.index?n.splice(e.index,0,{...e.item}):n.push({...e.item})}),n}function Kl(e,t){switch(e.type){case"select":t.selected=e.selected;break;case"position":void 0!==e.position&&(t.position=e.position),void 0!==e.dragging&&(t.dragging=e.dragging);break;case"dimensions":void 0!==e.dimensions&&(t.measured??(t.measured={}),t.measured.width=e.dimensions.width,t.measured.height=e.dimensions.height,e.setAttributes&&(!0!==e.setAttributes&&"width"!==e.setAttributes||(t.width=e.dimensions.width),!0!==e.setAttributes&&"height"!==e.setAttributes||(t.height=e.dimensions.height))),"boolean"==typeof e.resizing&&(t.resizing=e.resizing)}}function Wl(e,t){return Zl(e,t)}function ql(e,t){return Zl(e,t)}function Gl(e,t){return{id:e,type:"select",selected:t}}function Ul(e,t=/* @__PURE__ */new Set,n=!1){const o=[];for(const[i,r]of e){const e=t.has(i);void 0===r.selected&&!e||r.selected===e||(n&&(r.selected=e),o.push(Gl(r.id,e)))}return o}function Ql({items:e=[],lookup:t}){var n;const o=[],i=new Map(e.map(e=>[e.id,e]));for(const[r,s]of e.entries()){const e=t.get(s.id),i=(null==(n=null==e?void 0:e.internals)?void 0:n.userNode)??e;void 0!==i&&i!==s&&o.push({id:s.id,item:s,type:"replace"}),void 0===i&&o.push({item:s,type:"add",index:r})}for(const[r]of t){void 0===i.get(r)&&o.push({id:r,type:"remove"})}return o}function Jl(e){return{id:e.id,type:"remove"}}const ec=e=>(e=>"id"in e&&"position"in e&&!("source"in e)&&!("target"in e))(e);function tc(e){return s.forwardRef(e)}const nc="undefined"!=typeof window?s.useLayoutEffect:s.useEffect;function oc(e){const[t,n]=s.useState(BigInt(0)),[o]=s.useState(()=>function(e){let t=[];return{get:()=>t,reset:()=>{t=[]},push:n=>{t.push(n),e()}}}(()=>n(e=>e+BigInt(1))));return nc(()=>{const t=o.get();t.length&&(e(t),o.reset())},[t]),o}const ic=s.createContext(null);function rc({children:e}){const t=xl(),n=oc(s.useCallback(e=>{const{nodes:n=[],setNodes:o,hasDefaultNodes:i,onNodesChange:r,nodeLookup:s,fitViewQueued:a}=t.getState();let l=n;for(const t of e)l="function"==typeof t?t(l):t;const c=Ql({items:l,lookup:s});i&&o(l),c.length>0?null==r||r(c):a&&window.requestAnimationFrame(()=>{const{fitViewQueued:e,nodes:n,setNodes:o}=t.getState();e&&o(n)})},[])),o=oc(s.useCallback(e=>{const{edges:n=[],setEdges:o,hasDefaultEdges:i,onEdgesChange:r,edgeLookup:s}=t.getState();let a=n;for(const t of e)a="function"==typeof t?t(a):t;i?o(a):r&&r(Ql({items:a,lookup:s}))},[])),i=s.useMemo(()=>({nodeQueue:n,edgeQueue:o}),[]);return b.jsx(ic.Provider,{value:i,children:e})}const sc=e=>!!e.panZoom;function ac(){const e=(()=>{const e=xl();return s.useMemo(()=>({zoomIn:t=>{const{panZoom:n}=e.getState();return n?n.scaleBy(1.2,{duration:null==t?void 0:t.duration}):Promise.resolve(!1)},zoomOut:t=>{const{panZoom:n}=e.getState();return n?n.scaleBy(1/1.2,{duration:null==t?void 0:t.duration}):Promise.resolve(!1)},zoomTo:(t,n)=>{const{panZoom:o}=e.getState();return o?o.scaleTo(t,{duration:null==n?void 0:n.duration}):Promise.resolve(!1)},getZoom:()=>e.getState().transform[2],setViewport:async(t,n)=>{const{transform:[o,i,r],panZoom:s}=e.getState();return s?(await s.setViewport({x:t.x??o,y:t.y??i,zoom:t.zoom??r},n),Promise.resolve(!0)):Promise.resolve(!1)},getViewport:()=>{const[t,n,o]=e.getState().transform;return{x:t,y:n,zoom:o}},setCenter:async(t,n,o)=>e.getState().setCenter(t,n,o),fitBounds:async(t,n)=>{const{width:o,height:i,minZoom:r,maxZoom:s,panZoom:a}=e.getState(),l=As(t,o,i,r,s,(null==n?void 0:n.padding)??.1);return a?(await a.setViewport(l,{duration:null==n?void 0:n.duration,ease:null==n?void 0:n.ease,interpolate:null==n?void 0:n.interpolate}),Promise.resolve(!0)):Promise.resolve(!1)},screenToFlowPosition:(t,n={})=>{const{transform:o,snapGrid:i,snapToGrid:r,domNode:s}=e.getState();if(!s)return t;const{x:a,y:l}=s.getBoundingClientRect(),c={x:t.x-a,y:t.y-l},d=n.snapGrid??i,u=n.snapToGrid??r;return js(c,o,u,d)},flowToScreenPosition:t=>{const{transform:n,domNode:o}=e.getState();if(!o)return t;const{x:i,y:r}=o.getBoundingClientRect(),s=Ps(t,n);return{x:s.x+i,y:s.y+r}}}),[])})(),t=xl(),n=function(){const e=s.useContext(ic);if(!e)throw new Error("useBatchContext must be used within a BatchProvider");return e}(),o=yl(sc),i=s.useMemo(()=>{const e=e=>t.getState().nodeLookup.get(e),o=e=>{n.nodeQueue.push(e)},i=e=>{n.edgeQueue.push(e)},r=e=>{var n,o;const{nodeLookup:i,nodeOrigin:r}=t.getState(),s=ec(e)?e:i.get(e.id),a=s.parentId?Bs(s.position,s.measured,s.parentId,i,r):s.position,l={...s,position:a,width:(null==(n=s.measured)?void 0:n.width)??s.width,height:(null==(o=s.measured)?void 0:o.height)??s.height};return ws(l)},s=(e,t,n={replace:!1})=>{o(o=>o.map(o=>{if(o.id===e){const e="function"==typeof t?t(o):t;return n.replace&&ec(e)?e:{...o,...e}}return o}))},a=(e,t,n={replace:!1})=>{i(o=>o.map(o=>{if(o.id===e){const e="function"==typeof t?t(o):t;return n.replace&&rs(e)?e:{...o,...e}}return o}))};return{getNodes:()=>t.getState().nodes.map(e=>({...e})),getNode:t=>{var n;return null==(n=e(t))?void 0:n.internals.userNode},getInternalNode:e,getEdges:()=>{const{edges:e=[]}=t.getState();return e.map(e=>({...e}))},getEdge:e=>t.getState().edgeLookup.get(e),setNodes:o,setEdges:i,addNodes:e=>{const t=Array.isArray(e)?e:[e];n.nodeQueue.push(e=>[...e,...t])},addEdges:e=>{const t=Array.isArray(e)?e:[e];n.edgeQueue.push(e=>[...e,...t])},toObject:()=>{const{nodes:e=[],edges:n=[],transform:o}=t.getState(),[i,r,s]=o;return{nodes:e.map(e=>({...e})),edges:n.map(e=>({...e})),viewport:{x:i,y:r,zoom:s}}},deleteElements:async({nodes:e=[],edges:n=[]})=>{const{nodes:o,edges:i,onNodesDelete:r,onEdgesDelete:s,triggerNodeChanges:a,triggerEdgeChanges:l,onDelete:c,onBeforeDelete:d}=t.getState(),{nodes:u,edges:h}=await hs({nodesToRemove:e,edgesToRemove:n,nodes:o,edges:i,onBeforeDelete:d}),f=h.length>0,p=u.length>0;if(f){const e=h.map(Jl);null==s||s(h),l(e)}if(p){const e=u.map(Jl);null==r||r(u),a(e)}return(p||f)&&(null==c||c({nodes:u,edges:h})),{deletedNodes:u,deletedEdges:h}},getIntersectingNodes:(e,n=!0,o)=>{const i=ks(e),s=i?e:r(e),a=void 0!==o;return s?(o||t.getState().nodes).filter(o=>{const r=t.getState().nodeLookup.get(o.id);if(r&&!i&&(o.id===e.id||!r.internals.positionAbsolute))return!1;const l=ws(a?o:r),c=Ns(l,s);return n&&c>0||c>=l.width*l.height||c>=s.width*s.height}):[]},isNodeIntersecting:(e,t,n=!0)=>{const o=ks(e)?e:r(e);if(!o)return!1;const i=Ns(o,t);return n&&i>0||i>=t.width*t.height||i>=o.width*o.height},updateNode:s,updateNodeData:(e,t,n={replace:!1})=>{s(e,e=>{const o="function"==typeof t?t(e):t;return n.replace?{...e,data:o}:{...e,data:{...e.data,...o}}},n)},updateEdge:a,updateEdgeData:(e,t,n={replace:!1})=>{a(e,e=>{const o="function"==typeof t?t(e):t;return n.replace?{...e,data:o}:{...e,data:{...e.data,...o}}},n)},getNodesBounds:e=>{const{nodeLookup:n,nodeOrigin:o}=t.getState();return((e,t={nodeOrigin:[0,0]})=>{if(0===e.length)return{x:0,y:0,width:0,height:0};const n=e.reduce((e,n)=>{const o="string"==typeof n;let i=t.nodeLookup||o?void 0:n;t.nodeLookup&&(i=o?t.nodeLookup.get(n):ss(n)?n:t.nodeLookup.get(n.id));const r=i?Ss(i,t.nodeOrigin):{x:0,y:0,x2:0,y2:0};return xs(e,r)},{x:1/0,y:1/0,x2:-1/0,y2:-1/0});return bs(n)})(e,{nodeLookup:n,nodeOrigin:o})},getHandleConnections:({type:e,id:n,nodeId:o})=>{var i;return Array.from((null==(i=t.getState().connectionLookup.get(`${o}-${e}${n?`-${n}`:""}`))?void 0:i.values())??[])},getNodeConnections:({type:e,handleId:n,nodeId:o})=>{var i;return Array.from((null==(i=t.getState().connectionLookup.get(`${o}${e?n?`-${e}-${n}`:`-${e}`:""}`))?void 0:i.values())??[])},fitView:async e=>{const o=t.getState().fitViewResolver??function(){let e,t;return{promise:new Promise((n,o)=>{e=n,t=o}),resolve:e,reject:t}}();return t.setState({fitViewQueued:!0,fitViewOptions:e,fitViewResolver:o}),n.nodeQueue.push(e=>[...e]),o.promise}}},[]);return s.useMemo(()=>({...i,...e,viewportInitialized:o}),[o])}const lc=e=>e.selected,cc="undefined"!=typeof window?window:void 0;const dc={position:"absolute",width:"100%",height:"100%",top:0,left:0},uc=e=>({userSelectionActive:e.userSelectionActive,lib:e.lib,connectionInProgress:e.connection.inProgress});function hc({onPaneContextMenu:e,zoomOnScroll:t=!0,zoomOnPinch:n=!0,panOnScroll:o=!1,panOnScrollSpeed:i=.5,panOnScrollMode:r=Zr.Free,zoomOnDoubleClick:a=!0,panOnDrag:l=!0,defaultViewport:c,translateExtent:d,minZoom:u,maxZoom:h,zoomActivationKeyCode:f,preventScrolling:p=!0,children:g,noWheelClassName:m,noPanClassName:y,onViewportChange:x,isControlledViewport:v,paneClickDistance:w,selectionOnDrag:S}){const C=xl(),N=s.useRef(null),{userSelectionActive:k,lib:E,connectionInProgress:M}=yl(uc,fl),_=Fl(f),j=s.useRef();!function(e){const t=xl();s.useEffect(()=>{const n=()=>{var n,o,i,r;if(!e.current||!((null==(o=(n=e.current).checkVisibility)?void 0:o.call(n))??1))return!1;const s=Vs(e.current);0!==s.height&&0!==s.width||null==(r=(i=t.getState()).onError)||r.call(i,"004",Dr()),t.setState({width:s.width||500,height:s.height||500})};if(e.current){n(),window.addEventListener("resize",n);const t=new ResizeObserver(()=>n());return t.observe(e.current),()=>{window.removeEventListener("resize",n),t&&e.current&&t.unobserve(e.current)}}},[])}(N);const P=s.useCallback(e=>{null==x||x({x:e[0],y:e[1],zoom:e[2]}),v||C.setState({transform:e})},[x,v]);return s.useEffect(()=>{if(N.current){j.current=Ta({domNode:N.current,minZoom:u,maxZoom:h,translateExtent:d,viewport:c,onDraggingChange:e=>C.setState({paneDragging:e}),onPanZoomStart:(e,t)=>{const{onViewportChangeStart:n,onMoveStart:o}=C.getState();null==o||o(e,t),null==n||n(t)},onPanZoom:(e,t)=>{const{onViewportChange:n,onMove:o}=C.getState();null==o||o(e,t),null==n||n(t)},onPanZoomEnd:(e,t)=>{const{onViewportChangeEnd:n,onMoveEnd:o}=C.getState();null==o||o(e,t),null==n||n(t)}});const{x:e,y:t,zoom:n}=j.current.getViewport();return C.setState({panZoom:j.current,transform:[e,t,n],domNode:N.current.closest(".react-flow")}),()=>{var e;null==(e=j.current)||e.destroy()}}},[]),s.useEffect(()=>{var s;null==(s=j.current)||s.update({onPaneContextMenu:e,zoomOnScroll:t,zoomOnPinch:n,panOnScroll:o,panOnScrollSpeed:i,panOnScrollMode:r,zoomOnDoubleClick:a,panOnDrag:l,zoomActivationKeyPressed:_,preventScrolling:p,noPanClassName:y,userSelectionActive:k,noWheelClassName:m,lib:E,onTransformChange:P,connectionInProgress:M,selectionOnDrag:S,paneClickDistance:w})},[e,t,n,o,i,r,a,l,_,p,y,k,m,E,P,M,S,w]),b.jsx("div",{className:"react-flow__renderer",ref:N,style:dc,children:g})}const fc=e=>({userSelectionActive:e.userSelectionActive,userSelectionRect:e.userSelectionRect});function pc(){const{userSelectionActive:e,userSelectionRect:t}=yl(fc,fl);return e&&t?b.jsx("div",{className:"react-flow__selection react-flow__container",style:{width:t.width,height:t.height,transform:`translate(${t.x}px, ${t.y}px)`}}):null}const gc=(e,t)=>n=>{n.target===t.current&&(null==e||e(n))},mc=e=>({userSelectionActive:e.userSelectionActive,elementsSelectable:e.elementsSelectable,connectionInProgress:e.connection.inProgress,dragging:e.paneDragging});function yc({isSelecting:e,selectionKeyPressed:t,selectionMode:n=Wr.Full,panOnDrag:o,paneClickDistance:i,selectionOnDrag:r,onSelectionStart:a,onSelectionEnd:l,onPaneClick:c,onPaneContextMenu:d,onPaneScroll:u,onPaneMouseEnter:h,onPaneMouseMove:f,onPaneMouseLeave:p,children:g}){const m=xl(),{userSelectionActive:y,elementsSelectable:x,dragging:v,connectionInProgress:w}=yl(mc,fl),S=x&&(e||y),C=s.useRef(null),N=s.useRef(),k=s.useRef(/* @__PURE__ */new Set),E=s.useRef(/* @__PURE__ */new Set),M=s.useRef(!1),_=e=>{M.current||w?M.current=!1:(null==c||c(e),m.getState().resetSelectedElements(),m.setState({nodesSelectionActive:!1}))},j=u?e=>u(e):void 0,P=!0===o||Array.isArray(o)&&o.includes(0);return b.jsxs("div",{className:Tt(["react-flow__pane",{draggable:P,dragging:v,selection:e}]),onClick:S?void 0:gc(_,C),onContextMenu:gc(e=>{Array.isArray(o)&&(null==o?void 0:o.includes(2))?e.preventDefault():null==d||d(e)},C),onWheel:gc(j,C),onPointerEnter:S?void 0:h,onPointerMove:S?e=>{const{userSelectionRect:o,transform:r,nodeLookup:s,edgeLookup:l,connectionLookup:c,triggerNodeChanges:d,triggerEdgeChanges:u,defaultEdgeOptions:h,resetSelectedElements:f}=m.getState();if(!N.current||!o)return;const{x:p,y:g}=Zs(e.nativeEvent,N.current),{startX:y,startY:x}=o;if(!M.current){const n=t?0:i;if(Math.hypot(p-y,g-x)<=n)return;f(),null==a||a(e)}M.current=!0;const v={startX:y,startY:x,x:p<y?p:y,y:g<x?g:x,width:Math.abs(p-y),height:Math.abs(g-x)},b=k.current,w=E.current;k.current=new Set(cs(s,v,r,n===Wr.Partial,!0).map(e=>e.id)),E.current=/* @__PURE__ */new Set;const S=(null==h?void 0:h.selectable)??!0;for(const t of k.current){const e=c.get(t);if(e)for(const{edgeId:t}of e.values()){const e=l.get(t);e&&(e.selectable??S)&&E.current.add(t)}}if(!Ls(b,k.current)){d(Ul(s,k.current,!0))}if(!Ls(w,E.current)){u(Ul(l,E.current))}m.setState({userSelectionRect:v,userSelectionActive:!0,nodesSelectionActive:!1})}:f,onPointerUp:S?e=>{var t,n;0===e.button&&(null==(n=null==(t=e.target)?void 0:t.releasePointerCapture)||n.call(t,e.pointerId),!y&&e.target===C.current&&m.getState().userSelectionRect&&(null==_||_(e)),m.setState({userSelectionActive:!1,userSelectionRect:null}),M.current&&(null==l||l(e),m.setState({nodesSelectionActive:k.current.size>0})))}:void 0,onPointerDownCapture:S?n=>{var o,i;const{domNode:s}=m.getState();if(N.current=null==s?void 0:s.getBoundingClientRect(),!N.current)return;const a=n.target===C.current;if(!a&&!!n.target.closest(".nokey")||!e||!(r&&a||t)||0!==n.button||!n.isPrimary)return;null==(i=null==(o=n.target)?void 0:o.setPointerCapture)||i.call(o,n.pointerId),M.current=!1;const{x:l,y:c}=Zs(n.nativeEvent,N.current);m.setState({userSelectionRect:{width:0,height:0,startX:l,startY:c,x:l,y:c}}),a||(n.stopPropagation(),n.preventDefault())}:void 0,onClickCapture:S?e=>{M.current&&(e.stopPropagation(),M.current=!1)}:void 0,onPointerLeave:p,ref:C,style:dc,children:[g,b.jsx(pc,{})]})}function xc({id:e,store:t,unselect:n=!1,nodeRef:o}){const{addSelectedNodes:i,unselectNodesAndEdges:r,multiSelectionActive:s,nodeLookup:a,onError:l}=t.getState(),c=a.get(e);c?(t.setState({nodesSelectionActive:!1}),c.selected?(n||c.selected&&s)&&(r({nodes:[c],edges:[]}),requestAnimationFrame(()=>{var e;return null==(e=null==o?void 0:o.current)?void 0:e.blur()})):i([e])):null==l||l("012",Tr(e))}function vc({nodeRef:e,disabled:t=!1,noDragClassName:n,handleSelector:o,nodeId:i,isSelectable:r,nodeClickDistance:a}){const l=xl(),[c,d]=s.useState(!1),u=s.useRef();return s.useEffect(()=>{u.current=ka({getStoreItems:()=>l.getState(),onNodeMouseDown:t=>{xc({id:t,store:l,nodeRef:e})},onDragStart:()=>{d(!0)},onDragStop:()=>{d(!1)}})},[]),s.useEffect(()=>{var s,l;if(t)null==(s=u.current)||s.destroy();else if(e.current)return null==(l=u.current)||l.update({noDragClassName:n,handleSelector:o,domNode:e.current,isSelectable:r,nodeId:i,nodeClickDistance:a}),()=>{var e;null==(e=u.current)||e.destroy()}},[n,o,t,r,e,i]),c}function bc(){const e=xl();return s.useCallback(t=>{const{nodeExtent:n,snapToGrid:o,snapGrid:i,nodesDraggable:r,onError:s,updateNodePositions:a,nodeLookup:l,nodeOrigin:c}=e.getState(),d=/* @__PURE__ */new Map,u=(e=>t=>t.selected&&(t.draggable||e&&void 0===t.draggable))(r),h=o?i[0]:5,f=o?i[1]:5,p=t.direction.x*h*t.factor,g=t.direction.y*f*t.factor;for(const[,e]of l){if(!u(e))continue;let t={x:e.internals.positionAbsolute.x+p,y:e.internals.positionAbsolute.y+g};o&&(t=_s(t,i));const{position:r,positionAbsolute:a}=us({nodeId:e.id,nextPosition:t,nodeLookup:l,nodeExtent:n,nodeOrigin:c,onError:s});e.position=r,e.internals.positionAbsolute=a,d.set(e.id,e)}a(d)},[])}const wc=s.createContext(null),Sc=wc.Provider;wc.Consumer;const Cc=()=>s.useContext(wc),Nc=e=>({connectOnClick:e.connectOnClick,noPanClassName:e.noPanClassName,rfId:e.rfId});const kc=s.memo(tc(function({type:e="source",position:t=ts.Top,isValidConnection:n,isConnectable:o=!0,isConnectableStart:i=!0,isConnectableEnd:r=!0,id:s,onConnect:a,children:l,className:c,onMouseDown:d,onTouchStart:u,...h},f){var p,g;const m=s||null,y="target"===e,x=xl(),v=Cc(),{connectOnClick:w,noPanClassName:S,rfId:C}=yl(Nc,fl),{connectingFrom:N,connectingTo:k,clickConnecting:E,isPossibleEndHandle:M,connectionInProcess:_,clickConnectionInProcess:j,valid:P}=yl(((e,t,n)=>o=>{const{connectionClickStartHandle:i,connectionMode:r,connection:s}=o,{fromHandle:a,toHandle:l,isValid:c}=s,d=(null==l?void 0:l.nodeId)===e&&(null==l?void 0:l.id)===t&&(null==l?void 0:l.type)===n;return{connectingFrom:(null==a?void 0:a.nodeId)===e&&(null==a?void 0:a.id)===t&&(null==a?void 0:a.type)===n,connectingTo:d,clickConnecting:(null==i?void 0:i.nodeId)===e&&(null==i?void 0:i.id)===t&&(null==i?void 0:i.type)===n,isPossibleEndHandle:r===Xr.Strict?(null==a?void 0:a.type)!==n:e!==(null==a?void 0:a.nodeId)||t!==(null==a?void 0:a.id),connectionInProcess:!!a,clickConnectionInProcess:!!i,valid:d&&c}})(v,m,e),fl);v||null==(g=(p=x.getState()).onError)||g.call(p,"010",Br());const I=e=>{const{defaultEdgeOptions:t,onConnect:n,hasDefaultEdges:o}=x.getState(),i={...t,...e};if(o){const{edges:e,setEdges:t}=x.getState();t(ta(i,e))}null==n||n(i),null==a||a(i)},A=e=>{if(!v)return;const t=Ys(e.nativeEvent);if(i&&(t&&0===e.button||!t)){const t=x.getState();Ia.onPointerDown(e.nativeEvent,{handleDomNode:e.currentTarget,autoPanOnConnect:t.autoPanOnConnect,connectionMode:t.connectionMode,connectionRadius:t.connectionRadius,domNode:t.domNode,nodeLookup:t.nodeLookup,lib:t.lib,isTarget:y,handleId:m,nodeId:v,flowId:t.rfId,panBy:t.panBy,cancelConnection:t.cancelConnection,onConnectStart:t.onConnectStart,onConnectEnd:t.onConnectEnd,updateConnection:t.updateConnection,onConnect:I,isValidConnection:n||t.isValidConnection,getTransform:()=>x.getState().transform,getFromHandle:()=>x.getState().connection.fromHandle,autoPanSpeed:t.autoPanSpeed,dragThreshold:t.connectionDragThreshold})}t?null==d||d(e):null==u||u(e)};return b.jsx("div",{"data-handleid":m,"data-nodeid":v,"data-handlepos":t,"data-id":`${C}-${v}-${m}-${e}`,className:Tt(["react-flow__handle",`react-flow__handle-${t}`,"nodrag",S,c,{source:!y,target:y,connectable:o,connectablestart:i,connectableend:r,clickconnecting:E,connectingfrom:N,connectingto:k,valid:P,connectionindicator:o&&(!_||M)&&(_||j?r:i)}]),onMouseDown:A,onTouchStart:A,onClick:w?t=>{const{onClickConnectStart:o,onClickConnectEnd:r,connectionClickStartHandle:s,connectionMode:a,isValidConnection:l,lib:c,rfId:d,nodeLookup:u,connection:h}=x.getState();if(!v||!s&&!i)return;if(!s)return null==o||o(t.nativeEvent,{nodeId:v,handleId:m,handleType:e}),void x.setState({connectionClickStartHandle:{nodeId:v,type:e,id:m}});const f=Hs(t.target),p=n||l,{connection:g,isValid:y}=Ia.isValid(t.nativeEvent,{handle:{nodeId:v,id:m,type:e},connectionMode:a,fromNodeId:s.nodeId,fromHandleId:s.id||null,fromType:s.type,isValidConnection:p,flowId:d,doc:f,lib:c,nodeLookup:u});y&&g&&I(g);const b=structuredClone(h);delete b.inProgress,b.toPosition=b.toHandle?b.toHandle.position:null,null==r||r(t,b),x.setState({connectionClickStartHandle:null})}:void 0,ref:f,...h,children:l})}));const Ec={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}},Mc={input:function({data:e,isConnectable:t,sourcePosition:n=ts.Bottom}){return b.jsxs(b.Fragment,{children:[null==e?void 0:e.label,b.jsx(kc,{type:"source",position:n,isConnectable:t})]})},default:function({data:e,isConnectable:t,targetPosition:n=ts.Top,sourcePosition:o=ts.Bottom}){return b.jsxs(b.Fragment,{children:[b.jsx(kc,{type:"target",position:n,isConnectable:t}),null==e?void 0:e.label,b.jsx(kc,{type:"source",position:o,isConnectable:t})]})},output:function({data:e,isConnectable:t,targetPosition:n=ts.Top}){return b.jsxs(b.Fragment,{children:[b.jsx(kc,{type:"target",position:n,isConnectable:t}),null==e?void 0:e.label]})},group:function(){return null}};const _c=e=>{const{width:t,height:n,x:o,y:i}=ls(e.nodeLookup,{filter:e=>!!e.selected});return{width:Es(t)?t:null,height:Es(n)?n:null,userSelectionActive:e.userSelectionActive,transformString:`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]}) translate(${o}px,${i}px)`}};function jc({onSelectionContextMenu:e,noPanClassName:t,disableKeyboardA11y:n}){const o=xl(),{width:i,height:r,transformString:a,userSelectionActive:l}=yl(_c,fl),c=bc(),d=s.useRef(null);if(s.useEffect(()=>{var e;n||null==(e=d.current)||e.focus({preventScroll:!0})},[n]),vc({nodeRef:d}),l||!i||!r)return null;const u=e?t=>{const n=o.getState().nodes.filter(e=>e.selected);e(t,n)}:void 0;return b.jsx("div",{className:Tt(["react-flow__nodesselection","react-flow__container",t]),style:{transform:a},children:b.jsx("div",{ref:d,className:"react-flow__nodesselection-rect",onContextMenu:u,tabIndex:n?void 0:-1,onKeyDown:n?void 0:e=>{Object.prototype.hasOwnProperty.call(Ec,e.key)&&(e.preventDefault(),c({direction:Ec[e.key],factor:e.shiftKey?4:1}))},style:{width:i,height:r}})})}const Pc="undefined"!=typeof window?window:void 0,Ic=e=>({nodesSelectionActive:e.nodesSelectionActive,userSelectionActive:e.userSelectionActive});function Ac({children:e,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:o,onPaneMouseLeave:i,onPaneContextMenu:r,onPaneScroll:a,paneClickDistance:l,deleteKeyCode:c,selectionKeyCode:d,selectionOnDrag:u,selectionMode:h,onSelectionStart:f,onSelectionEnd:p,multiSelectionKeyCode:g,panActivationKeyCode:m,zoomActivationKeyCode:y,elementsSelectable:x,zoomOnScroll:v,zoomOnPinch:w,panOnScroll:S,panOnScrollSpeed:C,panOnScrollMode:N,zoomOnDoubleClick:k,panOnDrag:E,defaultViewport:M,translateExtent:_,minZoom:j,maxZoom:P,preventScrolling:I,onSelectionContextMenu:A,noWheelClassName:D,noPanClassName:z,disableKeyboardA11y:R,onViewportChange:O,isControlledViewport:B}){const{nodesSelectionActive:L,userSelectionActive:T}=yl(Ic),$=Fl(d,{target:Pc}),V=Fl(m,{target:Pc}),H=V||E,F=V||S,X=u&&!0!==H,Y=$||T||X;return function({deleteKeyCode:e,multiSelectionKeyCode:t}){const n=xl(),{deleteElements:o}=ac(),i=Fl(e,{actInsideInputWithModifier:!1}),r=Fl(t,{target:cc});s.useEffect(()=>{if(i){const{edges:e,nodes:t}=n.getState();o({nodes:t.filter(lc),edges:e.filter(lc)}),n.setState({nodesSelectionActive:!1})}},[i]),s.useEffect(()=>{n.setState({multiSelectionActive:r})},[r])}({deleteKeyCode:c,multiSelectionKeyCode:g}),b.jsx(hc,{onPaneContextMenu:r,elementsSelectable:x,zoomOnScroll:v,zoomOnPinch:w,panOnScroll:F,panOnScrollSpeed:C,panOnScrollMode:N,zoomOnDoubleClick:k,panOnDrag:!$&&H,defaultViewport:M,translateExtent:_,minZoom:j,maxZoom:P,zoomActivationKeyCode:y,preventScrolling:I,noWheelClassName:D,noPanClassName:z,onViewportChange:O,isControlledViewport:B,paneClickDistance:l,selectionOnDrag:X,children:b.jsxs(yc,{onSelectionStart:f,onSelectionEnd:p,onPaneClick:t,onPaneMouseEnter:n,onPaneMouseMove:o,onPaneMouseLeave:i,onPaneContextMenu:r,onPaneScroll:a,panOnDrag:H,isSelecting:!!Y,selectionMode:h,selectionKeyPressed:$,paneClickDistance:l,selectionOnDrag:X,children:[e,L&&b.jsx(jc,{onSelectionContextMenu:A,noPanClassName:z,disableKeyboardA11y:R})]})})}Ac.displayName="FlowRenderer";const Dc=s.memo(Ac);function zc(e){return yl(s.useCallback((e=>t=>e?cs(t.nodeLookup,{x:0,y:0,width:t.width,height:t.height},t.transform,!0).map(e=>e.id):Array.from(t.nodeLookup.keys()))(e),[e]),fl)}const Rc=e=>e.updateNodeInternals;var Oc=s.memo(function({id:e,onClick:t,onMouseEnter:n,onMouseMove:o,onMouseLeave:i,onContextMenu:r,onDoubleClick:a,nodesDraggable:l,elementsSelectable:c,nodesConnectable:d,nodesFocusable:u,resizeObserver:h,noDragClassName:f,noPanClassName:p,disableKeyboardA11y:g,rfId:m,nodeTypes:y,nodeClickDistance:x,onError:v}){const{node:w,internals:S,isParent:C}=yl(t=>{const n=t.nodeLookup.get(e),o=t.parentLookup.has(e);return{node:n,internals:n.internals,isParent:o}},fl);let N=w.type||"default",k=(null==y?void 0:y[N])||Mc[N];void 0===k&&(null==v||v("003",Ar(N)),N="default",k=(null==y?void 0:y.default)||Mc.default);const E=!!(w.draggable||l&&void 0===w.draggable),M=!!(w.selectable||c&&void 0===w.selectable),_=!!(w.connectable||d&&void 0===w.connectable),j=!!(w.focusable||u&&void 0===w.focusable),P=xl(),I=Os(w),A=function({node:e,nodeType:t,hasDimensions:n,resizeObserver:o}){const i=xl(),r=s.useRef(null),a=s.useRef(null),l=s.useRef(e.sourcePosition),c=s.useRef(e.targetPosition),d=s.useRef(t),u=n&&!!e.internals.handleBounds;return s.useEffect(()=>{!r.current||e.hidden||u&&a.current===r.current||(a.current&&(null==o||o.unobserve(a.current)),null==o||o.observe(r.current),a.current=r.current)},[u,e.hidden]),s.useEffect(()=>()=>{a.current&&(null==o||o.unobserve(a.current),a.current=null)},[]),s.useEffect(()=>{if(r.current){const n=d.current!==t,o=l.current!==e.sourcePosition,s=c.current!==e.targetPosition;(n||o||s)&&(d.current=t,l.current=e.sourcePosition,c.current=e.targetPosition,i.getState().updateNodeInternals(/* @__PURE__ */new Map([[e.id,{id:e.id,nodeElement:r.current,force:!0}]])))}},[e.id,t,e.sourcePosition,e.targetPosition]),r}({node:w,nodeType:N,hasDimensions:I,resizeObserver:h}),D=vc({nodeRef:A,disabled:w.hidden||!E,noDragClassName:f,handleSelector:w.dragHandle,nodeId:e,isSelectable:M,nodeClickDistance:x}),z=bc();if(w.hidden)return null;const R=Rs(w),O=function(e){var t,n,o,i;return void 0===e.internals.handleBounds?{width:e.width??e.initialWidth??(null==(t=e.style)?void 0:t.width),height:e.height??e.initialHeight??(null==(n=e.style)?void 0:n.height)}:{width:e.width??(null==(o=e.style)?void 0:o.width),height:e.height??(null==(i=e.style)?void 0:i.height)}}(w),B=M||E||t||n||o||i,L=n?e=>n(e,{...S.userNode}):void 0,T=o?e=>o(e,{...S.userNode}):void 0,$=i?e=>i(e,{...S.userNode}):void 0,V=r?e=>r(e,{...S.userNode}):void 0,H=a?e=>a(e,{...S.userNode}):void 0;return b.jsx("div",{className:Tt(["react-flow__node",`react-flow__node-${N}`,{[p]:E},w.className,{selected:w.selected,selectable:M,parent:C,draggable:E,dragging:D}]),ref:A,style:{zIndex:S.z,transform:`translate(${S.positionAbsolute.x}px,${S.positionAbsolute.y}px)`,pointerEvents:B?"all":"none",visibility:I?"visible":"hidden",...w.style,...O},"data-id":e,"data-testid":`rf__node-${e}`,onMouseEnter:L,onMouseMove:T,onMouseLeave:$,onContextMenu:V,onClick:n=>{const{selectNodesOnDrag:o,nodeDragThreshold:i}=P.getState();M&&(!o||!E||i>0)&&xc({id:e,store:P,nodeRef:A}),t&&t(n,{...S.userNode})},onDoubleClick:H,onKeyDown:j?t=>{if(!Xs(t.nativeEvent)&&!g)if(Hr.includes(t.key)&&M){const n="Escape"===t.key;xc({id:e,store:P,unselect:n,nodeRef:A})}else if(E&&w.selected&&Object.prototype.hasOwnProperty.call(Ec,t.key)){t.preventDefault();const{ariaLabelConfig:e}=P.getState();P.setState({ariaLiveMessage:e["node.a11yDescription.ariaLiveMessage"]({direction:t.key.replace("Arrow","").toLowerCase(),x:~~S.positionAbsolute.x,y:~~S.positionAbsolute.y})}),z({direction:Ec[t.key],factor:t.shiftKey?4:1})}}:void 0,tabIndex:j?0:void 0,onFocus:j?()=>{var t;if(g||!(null==(t=A.current)?void 0:t.matches(":focus-visible")))return;const{transform:n,width:o,height:i,autoPanOnNodeFocus:r,setCenter:s}=P.getState();if(!r)return;cs(/* @__PURE__ */new Map([[e,w]]),{x:0,y:0,width:o,height:i},n,!0).length>0||s(w.position.x+R.width/2,w.position.y+R.height/2,{zoom:n[2]})}:void 0,role:w.ariaRole??(j?"group":void 0),"aria-roledescription":"node","aria-describedby":g?void 0:`${wl}-${m}`,"aria-label":w.ariaLabel,...w.domAttributes,children:b.jsx(Sc,{value:e,children:b.jsx(k,{id:e,data:w.data,type:N,positionAbsoluteX:S.positionAbsolute.x,positionAbsoluteY:S.positionAbsolute.y,selected:w.selected??!1,selectable:M,draggable:E,deletable:w.deletable??!0,isConnectable:_,sourcePosition:w.sourcePosition,targetPosition:w.targetPosition,dragging:D,dragHandle:w.dragHandle,zIndex:S.z,parentId:w.parentId,...R})})})});const Bc=e=>({nodesDraggable:e.nodesDraggable,nodesConnectable:e.nodesConnectable,nodesFocusable:e.nodesFocusable,elementsSelectable:e.elementsSelectable,onError:e.onError});function Lc(e){const{nodesDraggable:t,nodesConnectable:n,nodesFocusable:o,elementsSelectable:i,onError:r}=yl(Bc,fl),a=zc(e.onlyRenderVisibleElements),l=function(){const e=yl(Rc),[t]=s.useState(()=>"undefined"==typeof ResizeObserver?null:new ResizeObserver(t=>{const n=/* @__PURE__ */new Map;t.forEach(e=>{const t=e.target.getAttribute("data-id");n.set(t,{id:t,nodeElement:e.target,force:!0})}),e(n)}));return s.useEffect(()=>()=>{null==t||t.disconnect()},[t]),t}();return b.jsx("div",{className:"react-flow__nodes",style:dc,children:a.map(s=>b.jsx(Oc,{id:s,nodeTypes:e.nodeTypes,nodeExtent:e.nodeExtent,onClick:e.onNodeClick,onMouseEnter:e.onNodeMouseEnter,onMouseMove:e.onNodeMouseMove,onMouseLeave:e.onNodeMouseLeave,onContextMenu:e.onNodeContextMenu,onDoubleClick:e.onNodeDoubleClick,noDragClassName:e.noDragClassName,noPanClassName:e.noPanClassName,rfId:e.rfId,disableKeyboardA11y:e.disableKeyboardA11y,resizeObserver:l,nodesDraggable:t,nodesConnectable:n,nodesFocusable:o,elementsSelectable:i,nodeClickDistance:e.nodeClickDistance,onError:r},s))})}Lc.displayName="NodeRenderer";const Tc=s.memo(Lc);const $c={[Jr.Arrow]:({color:e="none",strokeWidth:t=1})=>{const n={strokeWidth:t,...e&&{stroke:e}};return b.jsx("polyline",{className:"arrow",style:n,strokeLinecap:"round",fill:"none",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4"})},[Jr.ArrowClosed]:({color:e="none",strokeWidth:t=1})=>{const n={strokeWidth:t,...e&&{stroke:e,fill:e}};return b.jsx("polyline",{className:"arrowclosed",style:n,strokeLinecap:"round",strokeLinejoin:"round",points:"-5,-4 0,0 -5,4 -5,-4"})}};const Vc=({id:e,type:t,color:n,width:o=12.5,height:i=12.5,markerUnits:r="strokeWidth",strokeWidth:a,orient:l="auto-start-reverse"})=>{const c=function(e){const t=xl();return s.useMemo(()=>{var n,o;return Object.prototype.hasOwnProperty.call($c,e)?$c[e]:(null==(o=(n=t.getState()).onError)||o.call(n,"009",Rr(e)),null)},[e])}(t);return c?b.jsx("marker",{className:"react-flow__arrowhead",id:e,markerWidth:`${o}`,markerHeight:`${i}`,viewBox:"-10 -10 20 20",markerUnits:r,orient:l,refX:"0",refY:"0",children:b.jsx(c,{color:n,strokeWidth:a})}):null},Hc=({defaultColor:e,rfId:t})=>{const n=yl(e=>e.edges),o=yl(e=>e.defaultEdgeOptions),i=s.useMemo(()=>{const i=function(e,{id:t,defaultColor:n,defaultMarkerStart:o,defaultMarkerEnd:i}){const r=/* @__PURE__ */new Set;return e.reduce((e,s)=>([s.markerStart||o,s.markerEnd||i].forEach(o=>{if(o&&"object"==typeof o){const i=ua(o,t);r.has(i)||(e.push({id:i,color:o.color||n,...o}),r.add(i))}}),e),[]).sort((e,t)=>e.id.localeCompare(t.id))}(n,{id:t,defaultColor:e,defaultMarkerStart:null==o?void 0:o.markerStart,defaultMarkerEnd:null==o?void 0:o.markerEnd});return i},[n,o,t,e]);return i.length?b.jsx("svg",{className:"react-flow__marker","aria-hidden":"true",children:b.jsx("defs",{children:i.map(e=>b.jsx(Vc,{id:e.id,type:e.type,color:e.color,width:e.width,height:e.height,markerUnits:e.markerUnits,strokeWidth:e.strokeWidth,orient:e.orient},e.id))})}):null};Hc.displayName="MarkerDefinitions";var Fc=s.memo(Hc);function Xc({x:e,y:t,label:n,labelStyle:o,labelShowBg:i=!0,labelBgStyle:r,labelBgPadding:a=[2,4],labelBgBorderRadius:l=2,children:c,className:d,...u}){const[h,f]=s.useState({x:1,y:0,width:0,height:0}),p=Tt(["react-flow__edge-textwrapper",d]),g=s.useRef(null);return s.useEffect(()=>{if(g.current){const e=g.current.getBBox();f({x:e.x,y:e.y,width:e.width,height:e.height})}},[n]),n?b.jsxs("g",{transform:`translate(${e-h.width/2} ${t-h.height/2})`,className:p,visibility:h.width?"visible":"hidden",...u,children:[i&&b.jsx("rect",{width:h.width+2*a[0],x:-a[0],y:-a[1],height:h.height+2*a[1],className:"react-flow__edge-textbg",style:r,rx:l,ry:l}),b.jsx("text",{className:"react-flow__edge-text",y:h.height/2,dy:"0.3em",ref:g,style:o,children:n}),c]}):null}Xc.displayName="EdgeText";const Yc=s.memo(Xc);function Zc({path:e,labelX:t,labelY:n,label:o,labelStyle:i,labelShowBg:r,labelBgStyle:s,labelBgPadding:a,labelBgBorderRadius:l,interactionWidth:c=20,...d}){return b.jsxs(b.Fragment,{children:[b.jsx("path",{...d,d:e,fill:"none",className:Tt(["react-flow__edge-path",d.className])}),c?b.jsx("path",{d:e,fill:"none",strokeOpacity:0,strokeWidth:c,className:"react-flow__edge-interaction"}):null,o&&Es(t)&&Es(n)?b.jsx(Yc,{x:t,y:n,label:o,labelStyle:i,labelShowBg:r,labelBgStyle:s,labelBgPadding:a,labelBgBorderRadius:l}):null]})}function Kc({pos:e,x1:t,y1:n,x2:o,y2:i}){return e===ts.Left||e===ts.Right?[.5*(t+o),n]:[t,.5*(n+i)]}function Wc({sourceX:e,sourceY:t,sourcePosition:n=ts.Bottom,targetX:o,targetY:i,targetPosition:r=ts.Top}){const[s,a]=Kc({pos:n,x1:e,y1:t,x2:o,y2:i}),[l,c]=Kc({pos:r,x1:o,y1:i,x2:e,y2:t}),[d,u,h,f]=Ws({sourceX:e,sourceY:t,targetX:o,targetY:i,sourceControlX:s,sourceControlY:a,targetControlX:l,targetControlY:c});return[`M${e},${t} C${s},${a} ${l},${c} ${o},${i}`,d,u,h,f]}function qc(e){return s.memo(({id:t,sourceX:n,sourceY:o,targetX:i,targetY:r,sourcePosition:s,targetPosition:a,label:l,labelStyle:c,labelShowBg:d,labelBgStyle:u,labelBgPadding:h,labelBgBorderRadius:f,style:p,markerEnd:g,markerStart:m,interactionWidth:y})=>{const[x,v,w]=Wc({sourceX:n,sourceY:o,sourcePosition:s,targetX:i,targetY:r,targetPosition:a}),S=e.isInternal?void 0:t;return b.jsx(Zc,{id:S,path:x,labelX:v,labelY:w,label:l,labelStyle:c,labelShowBg:d,labelBgStyle:u,labelBgPadding:h,labelBgBorderRadius:f,style:p,markerEnd:g,markerStart:m,interactionWidth:y})})}const Gc=qc({isInternal:!1}),Uc=qc({isInternal:!0});function Qc(e){return s.memo(({id:t,sourceX:n,sourceY:o,targetX:i,targetY:r,label:s,labelStyle:a,labelShowBg:l,labelBgStyle:c,labelBgPadding:d,labelBgBorderRadius:u,style:h,sourcePosition:f=ts.Bottom,targetPosition:p=ts.Top,markerEnd:g,markerStart:m,pathOptions:y,interactionWidth:x})=>{const[v,w,S]=sa({sourceX:n,sourceY:o,sourcePosition:f,targetX:i,targetY:r,targetPosition:p,borderRadius:null==y?void 0:y.borderRadius,offset:null==y?void 0:y.offset,stepPosition:null==y?void 0:y.stepPosition}),C=e.isInternal?void 0:t;return b.jsx(Zc,{id:C,path:v,labelX:w,labelY:S,label:s,labelStyle:a,labelShowBg:l,labelBgStyle:c,labelBgPadding:d,labelBgBorderRadius:u,style:h,markerEnd:g,markerStart:m,interactionWidth:x})})}Gc.displayName="SimpleBezierEdge",Uc.displayName="SimpleBezierEdgeInternal";const Jc=Qc({isInternal:!1}),ed=Qc({isInternal:!0});function td(e){return s.memo(({id:t,...n})=>{var o;const i=e.isInternal?void 0:t;return b.jsx(Jc,{...n,id:i,pathOptions:s.useMemo(()=>{var e;return{borderRadius:0,offset:null==(e=n.pathOptions)?void 0:e.offset}},[null==(o=n.pathOptions)?void 0:o.offset])})})}Jc.displayName="SmoothStepEdge",ed.displayName="SmoothStepEdgeInternal";const nd=td({isInternal:!1}),od=td({isInternal:!0});function id(e){return s.memo(({id:t,sourceX:n,sourceY:o,targetX:i,targetY:r,label:s,labelStyle:a,labelShowBg:l,labelBgStyle:c,labelBgPadding:d,labelBgBorderRadius:u,style:h,markerEnd:f,markerStart:p,interactionWidth:g})=>{const[m,y,x]=na({sourceX:n,sourceY:o,targetX:i,targetY:r}),v=e.isInternal?void 0:t;return b.jsx(Zc,{id:v,path:m,labelX:y,labelY:x,label:s,labelStyle:a,labelShowBg:l,labelBgStyle:c,labelBgPadding:d,labelBgBorderRadius:u,style:h,markerEnd:f,markerStart:p,interactionWidth:g})})}nd.displayName="StepEdge",od.displayName="StepEdgeInternal";const rd=id({isInternal:!1}),sd=id({isInternal:!0});function ad(e){return s.memo(({id:t,sourceX:n,sourceY:o,targetX:i,targetY:r,sourcePosition:s=ts.Bottom,targetPosition:a=ts.Top,label:l,labelStyle:c,labelShowBg:d,labelBgStyle:u,labelBgPadding:h,labelBgBorderRadius:f,style:p,markerEnd:g,markerStart:m,pathOptions:y,interactionWidth:x})=>{const[v,w,S]=Us({sourceX:n,sourceY:o,sourcePosition:s,targetX:i,targetY:r,targetPosition:a,curvature:null==y?void 0:y.curvature}),C=e.isInternal?void 0:t;return b.jsx(Zc,{id:C,path:v,labelX:w,labelY:S,label:l,labelStyle:c,labelShowBg:d,labelBgStyle:u,labelBgPadding:h,labelBgBorderRadius:f,style:p,markerEnd:g,markerStart:m,interactionWidth:x})})}rd.displayName="StraightEdge",sd.displayName="StraightEdgeInternal";const ld=ad({isInternal:!1}),cd=ad({isInternal:!0});ld.displayName="BezierEdge",cd.displayName="BezierEdgeInternal";const dd={default:cd,straight:sd,step:od,smoothstep:ed,simplebezier:Uc},ud={sourceX:null,sourceY:null,targetX:null,targetY:null,sourcePosition:null,targetPosition:null},hd=(e,t,n)=>n===ts.Left?e-t:n===ts.Right?e+t:e,fd=(e,t,n)=>n===ts.Top?e-t:n===ts.Bottom?e+t:e,pd="react-flow__edgeupdater";function gd({position:e,centerX:t,centerY:n,radius:o=10,onMouseDown:i,onMouseEnter:r,onMouseOut:s,type:a}){return b.jsx("circle",{onMouseDown:i,onMouseEnter:r,onMouseOut:s,className:Tt([pd,`${pd}-${a}`]),cx:hd(t,o,e),cy:fd(n,o,e),r:o,stroke:"transparent",fill:"transparent"})}function md({isReconnectable:e,reconnectRadius:t,edge:n,sourceX:o,sourceY:i,targetX:r,targetY:s,sourcePosition:a,targetPosition:l,onReconnect:c,onReconnectStart:d,onReconnectEnd:u,setReconnecting:h,setUpdateHover:f}){const p=xl(),g=(e,t)=>{if(0!==e.button)return;const{autoPanOnConnect:o,domNode:i,isValidConnection:r,connectionMode:s,connectionRadius:a,lib:l,onConnectStart:f,onConnectEnd:g,cancelConnection:m,nodeLookup:y,rfId:x,panBy:v,updateConnection:b}=p.getState(),w="target"===t.type;Ia.onPointerDown(e.nativeEvent,{autoPanOnConnect:o,connectionMode:s,connectionRadius:a,domNode:i,handleId:t.id,nodeId:t.nodeId,nodeLookup:y,isTarget:w,edgeUpdaterType:t.type,lib:l,flowId:x,cancelConnection:m,panBy:v,isValidConnection:r,onConnect:e=>null==c?void 0:c(n,e),onConnectStart:(o,i)=>{h(!0),null==d||d(e,n,t.type),null==f||f(o,i)},onConnectEnd:g,onReconnectEnd:(e,o)=>{h(!1),null==u||u(e,n,t.type,o)},updateConnection:b,getTransform:()=>p.getState().transform,getFromHandle:()=>p.getState().connection.fromHandle,dragThreshold:p.getState().connectionDragThreshold,handleDomNode:e.currentTarget})},m=()=>f(!0),y=()=>f(!1);return b.jsxs(b.Fragment,{children:[(!0===e||"source"===e)&&b.jsx(gd,{position:a,centerX:o,centerY:i,radius:t,onMouseDown:e=>g(e,{nodeId:n.target,id:n.targetHandle??null,type:"target"}),onMouseEnter:m,onMouseOut:y,type:"source"}),(!0===e||"target"===e)&&b.jsx(gd,{position:l,centerX:r,centerY:s,radius:t,onMouseDown:e=>g(e,{nodeId:n.source,id:n.sourceHandle??null,type:"source"}),onMouseEnter:m,onMouseOut:y,type:"target"})]})}var yd=s.memo(function({id:e,edgesFocusable:t,edgesReconnectable:n,elementsSelectable:o,onClick:i,onDoubleClick:r,onContextMenu:a,onMouseEnter:l,onMouseMove:c,onMouseLeave:d,reconnectRadius:u,onReconnect:h,onReconnectStart:f,onReconnectEnd:p,rfId:g,edgeTypes:m,noPanClassName:y,onError:x,disableKeyboardA11y:v}){let w=yl(t=>t.edgeLookup.get(e));const S=yl(e=>e.defaultEdgeOptions);w=S?{...S,...w}:w;let C=w.type||"default",N=(null==m?void 0:m[C])||dd[C];void 0===N&&(null==x||x("011",Lr(C)),C="default",N=(null==m?void 0:m.default)||dd.default);const k=!!(w.focusable||t&&void 0===w.focusable),E=void 0!==h&&(w.reconnectable||n&&void 0===w.reconnectable),M=!!(w.selectable||o&&void 0===w.selectable),_=s.useRef(null),[j,P]=s.useState(!1),[I,A]=s.useState(!1),D=xl(),{zIndex:z,sourceX:R,sourceY:O,targetX:B,targetY:L,sourcePosition:T,targetPosition:$}=yl(s.useCallback(t=>{const n=t.nodeLookup.get(w.source),o=t.nodeLookup.get(w.target);if(!n||!o)return{zIndex:w.zIndex,...ud};const i=function(e){var t;const{sourceNode:n,targetNode:o}=e;if(!aa(n)||!aa(o))return null;const i=n.internals.handleBounds||la(n.handles),r=o.internals.handleBounds||la(o.handles),s=da((null==i?void 0:i.source)??[],e.sourceHandle),a=da(e.connectionMode===Xr.Strict?(null==r?void 0:r.target)??[]:((null==r?void 0:r.target)??[]).concat((null==r?void 0:r.source)??[]),e.targetHandle);if(!s||!a)return null==(t=e.onError)||t.call(e,"008",Or(s?"target":"source",{id:e.id,sourceHandle:e.sourceHandle,targetHandle:e.targetHandle})),null;const l=(null==s?void 0:s.position)||ts.Bottom,c=(null==a?void 0:a.position)||ts.Top,d=ca(n,s,l),u=ca(o,a,c);return{sourceX:d.x,sourceY:d.y,targetX:u.x,targetY:u.y,sourcePosition:l,targetPosition:c}}({id:e,sourceNode:n,targetNode:o,sourceHandle:w.sourceHandle||null,targetHandle:w.targetHandle||null,connectionMode:t.connectionMode,onError:x}),r=function({sourceNode:e,targetNode:t,selected:n=!1,zIndex:o,elevateOnSelect:i=!1}){return void 0!==o?o:(i&&n?1e3:0)+Math.max(e.parentId||i&&e.selected?e.internals.z:0,t.parentId||i&&t.selected?t.internals.z:0)}({selected:w.selected,zIndex:w.zIndex,sourceNode:n,targetNode:o,elevateOnSelect:t.elevateEdgesOnSelect});return{zIndex:r,...i||ud}},[w.source,w.target,w.sourceHandle,w.targetHandle,w.selected,w.zIndex]),fl),V=s.useMemo(()=>w.markerStart?`url('#${ua(w.markerStart,g)}')`:void 0,[w.markerStart,g]),H=s.useMemo(()=>w.markerEnd?`url('#${ua(w.markerEnd,g)}')`:void 0,[w.markerEnd,g]);if(w.hidden||null===R||null===O||null===B||null===L)return null;const F=r?e=>{r(e,{...w})}:void 0,X=a?e=>{a(e,{...w})}:void 0,Y=l?e=>{l(e,{...w})}:void 0,Z=c?e=>{c(e,{...w})}:void 0,K=d?e=>{d(e,{...w})}:void 0;return b.jsx("svg",{style:{zIndex:z},children:b.jsxs("g",{className:Tt(["react-flow__edge",`react-flow__edge-${C}`,w.className,y,{selected:w.selected,animated:w.animated,inactive:!M&&!i,updating:j,selectable:M}]),onClick:t=>{var n;const{addSelectedEdges:o,unselectNodesAndEdges:r,multiSelectionActive:s}=D.getState();M&&(D.setState({nodesSelectionActive:!1}),w.selected&&s?(r({nodes:[],edges:[w]}),null==(n=_.current)||n.blur()):o([e])),i&&i(t,w)},onDoubleClick:F,onContextMenu:X,onMouseEnter:Y,onMouseMove:Z,onMouseLeave:K,onKeyDown:k?t=>{var n;if(!v&&Hr.includes(t.key)&&M){const{unselectNodesAndEdges:o,addSelectedEdges:i}=D.getState();"Escape"===t.key?(null==(n=_.current)||n.blur(),o({edges:[w]})):i([e])}}:void 0,tabIndex:k?0:void 0,role:w.ariaRole??(k?"group":"img"),"aria-roledescription":"edge","data-id":e,"data-testid":`rf__edge-${e}`,"aria-label":null===w.ariaLabel?void 0:w.ariaLabel||`Edge from ${w.source} to ${w.target}`,"aria-describedby":k?`${Sl}-${g}`:void 0,ref:_,...w.domAttributes,children:[!I&&b.jsx(N,{id:e,source:w.source,target:w.target,type:w.type,selected:w.selected,animated:w.animated,selectable:M,deletable:w.deletable??!0,label:w.label,labelStyle:w.labelStyle,labelShowBg:w.labelShowBg,labelBgStyle:w.labelBgStyle,labelBgPadding:w.labelBgPadding,labelBgBorderRadius:w.labelBgBorderRadius,sourceX:R,sourceY:O,targetX:B,targetY:L,sourcePosition:T,targetPosition:$,data:w.data,style:w.style,sourceHandleId:w.sourceHandle,targetHandleId:w.targetHandle,markerStart:V,markerEnd:H,pathOptions:"pathOptions"in w?w.pathOptions:void 0,interactionWidth:w.interactionWidth}),E&&b.jsx(md,{edge:w,isReconnectable:E,reconnectRadius:u,onReconnect:h,onReconnectStart:f,onReconnectEnd:p,sourceX:R,sourceY:O,targetX:B,targetY:L,sourcePosition:T,targetPosition:$,setUpdateHover:P,setReconnecting:A})]})})});const xd=e=>({edgesFocusable:e.edgesFocusable,edgesReconnectable:e.edgesReconnectable,elementsSelectable:e.elementsSelectable,connectionMode:e.connectionMode,onError:e.onError});function vd({defaultMarkerColor:e,onlyRenderVisibleElements:t,rfId:n,edgeTypes:o,noPanClassName:i,onReconnect:r,onEdgeContextMenu:a,onEdgeMouseEnter:l,onEdgeMouseMove:c,onEdgeMouseLeave:d,onEdgeClick:u,reconnectRadius:h,onEdgeDoubleClick:f,onReconnectStart:p,onReconnectEnd:g,disableKeyboardA11y:m}){const{edgesFocusable:y,edgesReconnectable:x,elementsSelectable:v,onError:w}=yl(xd,fl),S=(C=t,yl(s.useCallback(e=>{if(!C)return e.edges.map(e=>e.id);const t=[];if(e.width&&e.height)for(const n of e.edges){const o=e.nodeLookup.get(n.source),i=e.nodeLookup.get(n.target);o&&i&&Js({sourceNode:o,targetNode:i,width:e.width,height:e.height,transform:e.transform})&&t.push(n.id)}return t},[C]),fl));var C;return b.jsxs("div",{className:"react-flow__edges",children:[b.jsx(Fc,{defaultColor:e,rfId:n}),S.map(e=>b.jsx(yd,{id:e,edgesFocusable:y,edgesReconnectable:x,elementsSelectable:v,noPanClassName:i,onReconnect:r,onContextMenu:a,onMouseEnter:l,onMouseMove:c,onMouseLeave:d,onClick:u,reconnectRadius:h,onDoubleClick:f,onReconnectStart:p,onReconnectEnd:g,rfId:n,onError:w,edgeTypes:o,disableKeyboardA11y:m},e))]})}vd.displayName="EdgeRenderer";const bd=s.memo(vd),wd=e=>`translate(${e.transform[0]}px,${e.transform[1]}px) scale(${e.transform[2]})`;function Sd({children:e}){const t=yl(wd);return b.jsx("div",{className:"react-flow__viewport xyflow__viewport react-flow__container",style:{transform:t},children:e})}const Cd=e=>{var t;return null==(t=e.panZoom)?void 0:t.syncViewport};function Nd(e){return e.connection.inProgress?{...e.connection,to:js(e.connection.to,e.transform)}:{...e.connection}}function kd(e){return yl(Nd,fl)}const Ed=e=>({nodesConnectable:e.nodesConnectable,isValid:e.connection.isValid,inProgress:e.connection.inProgress,width:e.width,height:e.height});function Md({containerStyle:e,style:t,type:n,component:o}){const{nodesConnectable:i,width:r,height:s,isValid:a,inProgress:l}=yl(Ed,fl);return!!(r&&i&&l)?b.jsx("svg",{style:e,width:r,height:s,className:"react-flow__connectionline react-flow__container",children:b.jsx("g",{className:Tt(["react-flow__connection",is(a)]),children:b.jsx(_d,{style:t,type:n,CustomComponent:o,isValid:a})})}):null}const _d=({style:e,type:t=Ur.Bezier,CustomComponent:n,isValid:o})=>{const{inProgress:i,from:r,fromNode:s,fromHandle:a,fromPosition:l,to:c,toNode:d,toHandle:u,toPosition:h}=kd();if(!i)return;if(n)return b.jsx(n,{connectionLineType:t,connectionLineStyle:e,fromNode:s,fromHandle:a,fromX:r.x,fromY:r.y,toX:c.x,toY:c.y,fromPosition:l,toPosition:h,connectionStatus:is(o),toNode:d,toHandle:u});let f="";const p={sourceX:r.x,sourceY:r.y,sourcePosition:l,targetX:c.x,targetY:c.y,targetPosition:h};switch(t){case Ur.Bezier:[f]=Us(p);break;case Ur.SimpleBezier:[f]=Wc(p);break;case Ur.Step:[f]=sa({...p,borderRadius:0});break;case Ur.SmoothStep:[f]=sa(p);break;default:[f]=na(p)}return b.jsx("path",{d:f,fill:"none",className:"react-flow__connection-path",style:e})};_d.displayName="ConnectionLine";const jd={};function Pd(e=jd){s.useRef(e),xl(),s.useEffect(()=>{},[e])}function Id({nodeTypes:e,edgeTypes:t,onInit:n,onNodeClick:o,onEdgeClick:i,onNodeDoubleClick:r,onEdgeDoubleClick:a,onNodeMouseEnter:l,onNodeMouseMove:c,onNodeMouseLeave:d,onNodeContextMenu:u,onSelectionContextMenu:h,onSelectionStart:f,onSelectionEnd:p,connectionLineType:g,connectionLineStyle:m,connectionLineComponent:y,connectionLineContainerStyle:x,selectionKeyCode:v,selectionOnDrag:w,selectionMode:S,multiSelectionKeyCode:C,panActivationKeyCode:N,zoomActivationKeyCode:k,deleteKeyCode:E,onlyRenderVisibleElements:M,elementsSelectable:_,defaultViewport:j,translateExtent:P,minZoom:I,maxZoom:A,preventScrolling:D,defaultMarkerColor:z,zoomOnScroll:R,zoomOnPinch:O,panOnScroll:B,panOnScrollSpeed:L,panOnScrollMode:T,zoomOnDoubleClick:$,panOnDrag:V,onPaneClick:H,onPaneMouseEnter:F,onPaneMouseMove:X,onPaneMouseLeave:Y,onPaneScroll:Z,onPaneContextMenu:K,paneClickDistance:W,nodeClickDistance:q,onEdgeContextMenu:G,onEdgeMouseEnter:U,onEdgeMouseMove:Q,onEdgeMouseLeave:J,reconnectRadius:ee,onReconnect:te,onReconnectStart:ne,onReconnectEnd:oe,noDragClassName:ie,noWheelClassName:re,noPanClassName:se,disableKeyboardA11y:ae,nodeExtent:le,rfId:ce,viewport:de,onViewportChange:ue}){return Pd(e),Pd(t),xl(),s.useRef(!1),s.useEffect(()=>{},[]),function(e){const t=ac(),n=s.useRef(!1);s.useEffect(()=>{!n.current&&t.viewportInitialized&&e&&(setTimeout(()=>e(t),1),n.current=!0)},[e,t.viewportInitialized])}(n),function(e){const t=yl(Cd),n=xl();s.useEffect(()=>{e&&(null==t||t(e),n.setState({transform:[e.x,e.y,e.zoom]}))},[e,t])}(de),b.jsx(Dc,{onPaneClick:H,onPaneMouseEnter:F,onPaneMouseMove:X,onPaneMouseLeave:Y,onPaneContextMenu:K,onPaneScroll:Z,paneClickDistance:W,deleteKeyCode:E,selectionKeyCode:v,selectionOnDrag:w,selectionMode:S,onSelectionStart:f,onSelectionEnd:p,multiSelectionKeyCode:C,panActivationKeyCode:N,zoomActivationKeyCode:k,elementsSelectable:_,zoomOnScroll:R,zoomOnPinch:O,zoomOnDoubleClick:$,panOnScroll:B,panOnScrollSpeed:L,panOnScrollMode:T,panOnDrag:V,defaultViewport:j,translateExtent:P,minZoom:I,maxZoom:A,onSelectionContextMenu:h,preventScrolling:D,noDragClassName:ie,noWheelClassName:re,noPanClassName:se,disableKeyboardA11y:ae,onViewportChange:ue,isControlledViewport:!!de,children:b.jsxs(Sd,{children:[b.jsx(bd,{edgeTypes:t,onEdgeClick:i,onEdgeDoubleClick:a,onReconnect:te,onReconnectStart:ne,onReconnectEnd:oe,onlyRenderVisibleElements:M,onEdgeContextMenu:G,onEdgeMouseEnter:U,onEdgeMouseMove:Q,onEdgeMouseLeave:J,reconnectRadius:ee,defaultMarkerColor:z,noPanClassName:se,disableKeyboardA11y:ae,rfId:ce}),b.jsx(Md,{style:m,type:g,component:y,containerStyle:x}),b.jsx("div",{className:"react-flow__edgelabel-renderer"}),b.jsx(Tc,{nodeTypes:e,onNodeClick:o,onNodeDoubleClick:r,onNodeMouseEnter:l,onNodeMouseMove:c,onNodeMouseLeave:d,onNodeContextMenu:u,nodeClickDistance:q,onlyRenderVisibleElements:M,noPanClassName:se,noDragClassName:ie,disableKeyboardA11y:ae,nodeExtent:le,rfId:ce}),b.jsx("div",{className:"react-flow__viewport-portal"})]})})}Id.displayName="GraphView";const Ad=s.memo(Id),Dd=({nodes:e,edges:t,defaultNodes:n,defaultEdges:o,width:i,height:r,fitView:s,fitViewOptions:a,minZoom:l=.5,maxZoom:c=2,nodeOrigin:d,nodeExtent:u}={})=>{const h=/* @__PURE__ */new Map,f=/* @__PURE__ */new Map,p=/* @__PURE__ */new Map,g=/* @__PURE__ */new Map,m=o??t??[],y=n??e??[],x=d??[0,0],v=u??Vr;wa(p,g,m);const b=ma(y,h,f,{nodeOrigin:x,nodeExtent:v,elevateNodesOnSelect:!1});let w=[0,0,1];if(s&&i&&r){const e=ls(h,{filter:e=>!(!e.width&&!e.initialWidth||!e.height&&!e.initialHeight)}),{x:t,y:n,zoom:o}=As(e,i,r,l,c,(null==a?void 0:a.padding)??.1);w=[t,n,o]}return{rfId:"1",width:i??0,height:r??0,transform:w,nodes:y,nodesInitialized:b,nodeLookup:h,parentLookup:f,edges:m,edgeLookup:g,connectionLookup:p,onNodesChange:null,onEdgesChange:null,hasDefaultNodes:void 0!==n,hasDefaultEdges:void 0!==o,panZoom:null,minZoom:l,maxZoom:c,translateExtent:Vr,nodeExtent:v,nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,connectionMode:Xr.Strict,domNode:null,paneDragging:!1,noPanClassName:"nopan",nodeOrigin:x,nodeDragThreshold:1,connectionDragThreshold:1,snapGrid:[15,15],snapToGrid:!1,nodesDraggable:!0,nodesConnectable:!0,nodesFocusable:!0,edgesFocusable:!0,edgesReconnectable:!0,elementsSelectable:!0,elevateNodesOnSelect:!0,elevateEdgesOnSelect:!1,selectNodesOnDrag:!0,multiSelectionActive:!1,fitViewQueued:s??!1,fitViewOptions:a,fitViewResolver:null,connection:{...Gr},connectionClickStartHandle:null,connectOnClick:!0,ariaLiveMessage:"",autoPanOnConnect:!0,autoPanOnNodeDrag:!0,autoPanOnNodeFocus:!0,autoPanSpeed:15,connectionRadius:20,onError:Ms,isValidConnection:void 0,onSelectionChangeHandlers:[],lib:"react",debug:!1,ariaLabelConfig:Fr}},zd=({nodes:e,edges:t,defaultNodes:n,defaultEdges:o,width:i,height:r,fitView:s,fitViewOptions:a,minZoom:l,maxZoom:c,nodeOrigin:d,nodeExtent:u})=>{return h=(h,f)=>{async function p(){const{nodeLookup:e,panZoom:t,fitViewOptions:n,fitViewResolver:o,width:i,height:r,minZoom:s,maxZoom:a}=f();t&&(await ds({nodes:e,width:i,height:r,panZoom:t,minZoom:s,maxZoom:a},n),null==o||o.resolve(!0),h({fitViewResolver:null}))}return{...Dd({nodes:e,edges:t,width:i,height:r,fitView:s,fitViewOptions:a,minZoom:l,maxZoom:c,nodeOrigin:d,nodeExtent:u,defaultNodes:n,defaultEdges:o}),setNodes:e=>{const{nodeLookup:t,parentLookup:n,nodeOrigin:o,elevateNodesOnSelect:i,fitViewQueued:r}=f(),s=ma(e,t,n,{nodeOrigin:o,nodeExtent:u,elevateNodesOnSelect:i,checkEquality:!0});r&&s?(p(),h({nodes:e,nodesInitialized:s,fitViewQueued:!1,fitViewOptions:void 0})):h({nodes:e,nodesInitialized:s})},setEdges:e=>{const{connectionLookup:t,edgeLookup:n}=f();wa(t,n,e),h({edges:e})},setDefaultNodesAndEdges:(e,t)=>{if(e){const{setNodes:t}=f();t(e),h({hasDefaultNodes:!0})}if(t){const{setEdges:e}=f();e(t),h({hasDefaultEdges:!0})}},updateNodeInternals:e=>{const{triggerNodeChanges:t,nodeLookup:n,parentLookup:o,domNode:i,nodeOrigin:r,nodeExtent:s,debug:a,fitViewQueued:l}=f(),{changes:c,updatedInternals:d}=function(e,t,n,o,i,r){const s=null==o?void 0:o.querySelector(".xyflow__viewport");let a=!1;if(!s)return{changes:[],updatedInternals:a};const l=[],c=window.getComputedStyle(s),{m22:d}=new window.DOMMatrixReadOnly(c.transform),u=[];for(const h of e.values()){const e=t.get(h.id);if(!e)continue;if(e.hidden){t.set(e.id,{...e,internals:{...e.internals,handleBounds:void 0}}),a=!0;continue}const o=Vs(h.nodeElement),s=e.measured.width!==o.width||e.measured.height!==o.height;if(o.width&&o.height&&(s||!e.internals.handleBounds||h.force)){const c=h.nodeElement.getBoundingClientRect(),f=zs(e.extent)?e.extent:r;let{positionAbsolute:p}=e.internals;e.parentId&&"parent"===e.extent?p=gs(p,o,t.get(e.parentId)):f&&(p=ps(p,f,o));const g={...e,measured:o,internals:{...e.internals,positionAbsolute:p,handleBounds:{source:Ks("source",h.nodeElement,c,d,e.id),target:Ks("target",h.nodeElement,c,d,e.id)}}};t.set(e.id,g),e.parentId&&ya(g,t,n,{nodeOrigin:i}),a=!0,s&&(l.push({id:e.id,type:"dimensions",dimensions:o}),e.expandParent&&e.parentId&&u.push({id:e.id,parentId:e.parentId,rect:ws(g,i)}))}}if(u.length>0){const e=va(u,t,n,i);l.push(...e)}return{changes:l,updatedInternals:a}}(e,n,o,i,r,s);d&&(function(e,t,n){const o=pa(ha,n);for(const i of e.values())if(i.parentId)ya(i,e,t,o);else{const e=as(i,o.nodeOrigin),t=zs(i.extent)?i.extent:o.nodeExtent,n=ps(e,t,Rs(i));i.internals.positionAbsolute=n}}(n,o,{nodeOrigin:r,nodeExtent:s}),l?(p(),h({fitViewQueued:!1,fitViewOptions:void 0})):h({}),(null==c?void 0:c.length)>0&&(null==t||t(c)))},updateNodePositions:(e,t=!1)=>{const n=[],o=[],{nodeLookup:i,triggerNodeChanges:r}=f();for(const[s,a]of e){const e=i.get(s),r=!!((null==e?void 0:e.expandParent)&&(null==e?void 0:e.parentId)&&(null==a?void 0:a.position)),l={id:s,type:"position",position:r?{x:Math.max(0,a.position.x),y:Math.max(0,a.position.y)}:a.position,dragging:t};r&&e.parentId&&n.push({id:s,parentId:e.parentId,rect:{...a.internals.positionAbsolute,width:a.measured.width??0,height:a.measured.height??0}}),o.push(l)}if(n.length>0){const{parentLookup:e,nodeOrigin:t}=f(),r=va(n,i,e,t);o.push(...r)}r(o)},triggerNodeChanges:e=>{const{onNodesChange:t,setNodes:n,nodes:o,hasDefaultNodes:i,debug:r}=f();(null==e?void 0:e.length)&&(i&&n(Wl(e,o)),null==t||t(e))},triggerEdgeChanges:e=>{const{onEdgesChange:t,setEdges:n,edges:o,hasDefaultEdges:i,debug:r}=f();(null==e?void 0:e.length)&&(i&&n(ql(e,o)),null==t||t(e))},addSelectedNodes:e=>{const{multiSelectionActive:t,edgeLookup:n,nodeLookup:o,triggerNodeChanges:i,triggerEdgeChanges:r}=f();t?i(e.map(e=>Gl(e,!0))):(i(Ul(o,/* @__PURE__ */new Set([...e]),!0)),r(Ul(n)))},addSelectedEdges:e=>{const{multiSelectionActive:t,edgeLookup:n,nodeLookup:o,triggerNodeChanges:i,triggerEdgeChanges:r}=f();t?r(e.map(e=>Gl(e,!0))):(r(Ul(n,/* @__PURE__ */new Set([...e]))),i(Ul(o,/* @__PURE__ */new Set,!0)))},unselectNodesAndEdges:({nodes:e,edges:t}={})=>{const{edges:n,nodes:o,nodeLookup:i,triggerNodeChanges:r,triggerEdgeChanges:s}=f(),a=t||n,l=(e||o).map(e=>{const t=i.get(e.id);return t&&(t.selected=!1),Gl(e.id,!1)}),c=a.map(e=>Gl(e.id,!1));r(l),s(c)},setMinZoom:e=>{const{panZoom:t,maxZoom:n}=f();null==t||t.setScaleExtent([e,n]),h({minZoom:e})},setMaxZoom:e=>{const{panZoom:t,minZoom:n}=f();null==t||t.setScaleExtent([n,e]),h({maxZoom:e})},setTranslateExtent:e=>{var t;null==(t=f().panZoom)||t.setTranslateExtent(e),h({translateExtent:e})},resetSelectedElements:()=>{const{edges:e,nodes:t,triggerNodeChanges:n,triggerEdgeChanges:o,elementsSelectable:i}=f();if(!i)return;const r=t.reduce((e,t)=>t.selected?[...e,Gl(t.id,!1)]:e,[]),s=e.reduce((e,t)=>t.selected?[...e,Gl(t.id,!1)]:e,[]);n(r),o(s)},setNodeExtent:e=>{const{nodes:t,nodeLookup:n,parentLookup:o,nodeOrigin:i,elevateNodesOnSelect:r,nodeExtent:s}=f();e[0][0]===s[0][0]&&e[0][1]===s[0][1]&&e[1][0]===s[1][0]&&e[1][1]===s[1][1]||(ma(t,n,o,{nodeOrigin:i,nodeExtent:e,elevateNodesOnSelect:r,checkEquality:!1}),h({nodeExtent:e}))},panBy:e=>{const{transform:t,width:n,height:o,panZoom:i,translateExtent:r}=f();return async function({delta:e,panZoom:t,transform:n,translateExtent:o,width:i,height:r}){if(!t||!e.x&&!e.y)return Promise.resolve(!1);const s=await t.setViewportConstrained({x:n[0]+e.x,y:n[1]+e.y,zoom:n[2]},[[0,0],[i,r]],o),a=!!s&&(s.x!==n[0]||s.y!==n[1]||s.k!==n[2]);return Promise.resolve(a)}({delta:e,panZoom:i,transform:t,translateExtent:r,width:n,height:o})},setCenter:async(e,t,n)=>{const{width:o,height:i,maxZoom:r,panZoom:s}=f();if(!s)return Promise.resolve(!1);const a=void 0!==(null==n?void 0:n.zoom)?n.zoom:r;return await s.setViewport({x:o/2-e*a,y:i/2-t*a,zoom:a},{duration:null==n?void 0:n.duration,ease:null==n?void 0:n.ease,interpolate:null==n?void 0:n.interpolate}),Promise.resolve(!0)},cancelConnection:()=>{h({connection:{...Gr}})},updateConnection:e=>{h({connection:e})},reset:()=>h({...Dd()})}},f=Object.is,h?hl(h,f):hl;var h,f};function Rd({initialNodes:e,initialEdges:t,defaultNodes:n,defaultEdges:o,initialWidth:i,initialHeight:r,initialMinZoom:a,initialMaxZoom:l,initialFitViewOptions:c,fitView:d,nodeOrigin:u,nodeExtent:h,children:f}){const[p]=s.useState(()=>zd({nodes:e,edges:t,defaultNodes:n,defaultEdges:o,width:i,height:r,fitView:d,minZoom:a,maxZoom:l,fitViewOptions:c,nodeOrigin:u,nodeExtent:h}));return b.jsx(gl,{value:p,children:b.jsx(rc,{children:f})})}function Od({children:e,nodes:t,edges:n,defaultNodes:o,defaultEdges:i,width:r,height:a,fitView:l,fitViewOptions:c,minZoom:d,maxZoom:u,nodeOrigin:h,nodeExtent:f}){return s.useContext(pl)?b.jsx(b.Fragment,{children:e}):b.jsx(Rd,{initialNodes:t,initialEdges:n,defaultNodes:o,defaultEdges:i,initialWidth:r,initialHeight:a,fitView:l,initialFitViewOptions:c,initialMinZoom:d,initialMaxZoom:u,nodeOrigin:h,nodeExtent:f,children:e})}const Bd={width:"100%",height:"100%",overflow:"hidden",position:"relative",zIndex:0};var Ld,Td,$d=tc(function({nodes:e,edges:t,defaultNodes:n,defaultEdges:o,className:i,nodeTypes:r,edgeTypes:a,onNodeClick:l,onEdgeClick:c,onInit:d,onMove:u,onMoveStart:h,onMoveEnd:f,onConnect:p,onConnectStart:g,onConnectEnd:m,onClickConnectStart:y,onClickConnectEnd:x,onNodeMouseEnter:v,onNodeMouseMove:w,onNodeMouseLeave:S,onNodeContextMenu:C,onNodeDoubleClick:N,onNodeDragStart:k,onNodeDrag:E,onNodeDragStop:M,onNodesDelete:_,onEdgesDelete:j,onDelete:P,onSelectionChange:I,onSelectionDragStart:A,onSelectionDrag:D,onSelectionDragStop:z,onSelectionContextMenu:R,onSelectionStart:O,onSelectionEnd:B,onBeforeDelete:L,connectionMode:T,connectionLineType:$=Ur.Bezier,connectionLineStyle:V,connectionLineComponent:H,connectionLineContainerStyle:F,deleteKeyCode:X="Backspace",selectionKeyCode:Y="Shift",selectionOnDrag:Z=!1,selectionMode:K=Wr.Full,panActivationKeyCode:W="Space",multiSelectionKeyCode:q=(Ds()?"Meta":"Control"),zoomActivationKeyCode:G=(Ds()?"Meta":"Control"),snapToGrid:U,snapGrid:Q,onlyRenderVisibleElements:J=!1,selectNodesOnDrag:ee,nodesDraggable:te,autoPanOnNodeFocus:ne,nodesConnectable:oe,nodesFocusable:ie,nodeOrigin:re=Rl,edgesFocusable:se,edgesReconnectable:ae,elementsSelectable:le=!0,defaultViewport:ce=Ol,minZoom:de=.5,maxZoom:ue=2,translateExtent:he=Vr,preventScrolling:fe=!0,nodeExtent:pe,defaultMarkerColor:ge="#b1b1b7",zoomOnScroll:me=!0,zoomOnPinch:ye=!0,panOnScroll:xe=!1,panOnScrollSpeed:ve=.5,panOnScrollMode:be=Zr.Free,zoomOnDoubleClick:we=!0,panOnDrag:Se=!0,onPaneClick:Ce,onPaneMouseEnter:Ne,onPaneMouseMove:ke,onPaneMouseLeave:Ee,onPaneScroll:Me,onPaneContextMenu:_e,paneClickDistance:je=0,nodeClickDistance:Pe=0,children:Ie,onReconnect:Ae,onReconnectStart:De,onReconnectEnd:ze,onEdgeContextMenu:Re,onEdgeDoubleClick:Oe,onEdgeMouseEnter:Be,onEdgeMouseMove:Le,onEdgeMouseLeave:Te,reconnectRadius:$e=10,onNodesChange:Ve,onEdgesChange:He,noDragClassName:Fe="nodrag",noWheelClassName:Xe="nowheel",noPanClassName:Ye="nopan",fitView:Ze,fitViewOptions:Ke,connectOnClick:We,attributionPosition:qe,proOptions:Ge,defaultEdgeOptions:Ue,elevateNodesOnSelect:Qe,elevateEdgesOnSelect:Je,disableKeyboardA11y:et=!1,autoPanOnConnect:tt,autoPanOnNodeDrag:nt,autoPanSpeed:ot,connectionRadius:it,isValidConnection:rt,onError:st,style:at,id:lt,nodeDragThreshold:ct,connectionDragThreshold:dt,viewport:ut,onViewportChange:ht,width:ft,height:pt,colorMode:gt="light",debug:mt,onScroll:yt,ariaLabelConfig:xt,...vt},bt){const wt=lt||"1",St=function(e){var t;const[n,o]=s.useState("system"===e?null:e);return s.useEffect(()=>{if("system"!==e)return void o(e);const t=Vl(),n=()=>o((null==t?void 0:t.matches)?"dark":"light");return n(),null==t||t.addEventListener("change",n),()=>{null==t||t.removeEventListener("change",n)}},[e]),null!==n?n:(null==(t=Vl())?void 0:t.matches)?"dark":"light"}(gt),Ct=s.useCallback(e=>{e.currentTarget.scrollTo({top:0,left:0,behavior:"instant"}),null==yt||yt(e)},[yt]);return b.jsx("div",{"data-testid":"rf__wrapper",...vt,onScroll:Ct,style:{...at,...Bd},ref:bt,className:Tt(["react-flow",i,St]),id:lt,role:"application",children:b.jsxs(Od,{nodes:e,edges:t,width:ft,height:pt,fitView:Ze,fitViewOptions:Ke,minZoom:de,maxZoom:ue,nodeOrigin:re,nodeExtent:pe,children:[b.jsx(Ad,{onInit:d,onNodeClick:l,onEdgeClick:c,onNodeMouseEnter:v,onNodeMouseMove:w,onNodeMouseLeave:S,onNodeContextMenu:C,onNodeDoubleClick:N,nodeTypes:r,edgeTypes:a,connectionLineType:$,connectionLineStyle:V,connectionLineComponent:H,connectionLineContainerStyle:F,selectionKeyCode:Y,selectionOnDrag:Z,selectionMode:K,deleteKeyCode:X,multiSelectionKeyCode:q,panActivationKeyCode:W,zoomActivationKeyCode:G,onlyRenderVisibleElements:J,defaultViewport:ce,translateExtent:he,minZoom:de,maxZoom:ue,preventScrolling:fe,zoomOnScroll:me,zoomOnPinch:ye,zoomOnDoubleClick:we,panOnScroll:xe,panOnScrollSpeed:ve,panOnScrollMode:be,panOnDrag:Se,onPaneClick:Ce,onPaneMouseEnter:Ne,onPaneMouseMove:ke,onPaneMouseLeave:Ee,onPaneScroll:Me,onPaneContextMenu:_e,paneClickDistance:je,nodeClickDistance:Pe,onSelectionContextMenu:R,onSelectionStart:O,onSelectionEnd:B,onReconnect:Ae,onReconnectStart:De,onReconnectEnd:ze,onEdgeContextMenu:Re,onEdgeDoubleClick:Oe,onEdgeMouseEnter:Be,onEdgeMouseMove:Le,onEdgeMouseLeave:Te,reconnectRadius:$e,defaultMarkerColor:ge,noDragClassName:Fe,noWheelClassName:Xe,noPanClassName:Ye,rfId:wt,disableKeyboardA11y:et,nodeExtent:pe,viewport:ut,onViewportChange:ht}),b.jsx($l,{nodes:e,edges:t,defaultNodes:n,defaultEdges:o,onConnect:p,onConnectStart:g,onConnectEnd:m,onClickConnectStart:y,onClickConnectEnd:x,nodesDraggable:te,autoPanOnNodeFocus:ne,nodesConnectable:oe,nodesFocusable:ie,edgesFocusable:se,edgesReconnectable:ae,elementsSelectable:le,elevateNodesOnSelect:Qe,elevateEdgesOnSelect:Je,minZoom:de,maxZoom:ue,nodeExtent:pe,onNodesChange:Ve,onEdgesChange:He,snapToGrid:U,snapGrid:Q,connectionMode:T,translateExtent:he,connectOnClick:We,defaultEdgeOptions:Ue,fitView:Ze,fitViewOptions:Ke,onNodesDelete:_,onEdgesDelete:j,onDelete:P,onNodeDragStart:k,onNodeDrag:E,onNodeDragStop:M,onSelectionDrag:D,onSelectionDragStart:A,onSelectionDragStop:z,onMove:u,onMoveStart:h,onMoveEnd:f,noPanClassName:Ye,nodeOrigin:re,rfId:wt,autoPanOnConnect:tt,autoPanOnNodeDrag:nt,autoPanSpeed:ot,onError:st,connectionRadius:it,isValidConnection:rt,selectNodesOnDrag:ee,nodeDragThreshold:ct,connectionDragThreshold:dt,onBeforeDelete:L,debug:mt,ariaLabelConfig:xt}),b.jsx(zl,{onSelectionChange:I}),Ie,b.jsx(_l,{proOptions:Ge,position:qe}),b.jsx(El,{rfId:wt,disableKeyboardA11y:et})]})})});function Vd({dimensions:e,lineWidth:t,variant:n,className:o}){return b.jsx("path",{strokeWidth:t,d:`M${e[0]/2} 0 V${e[1]} M0 ${e[1]/2} H${e[0]}`,className:Tt(["react-flow__background-pattern",n,o])})}function Hd({radius:e,className:t}){return b.jsx("circle",{cx:e,cy:e,r:e,className:Tt(["react-flow__background-pattern","dots",t])})}(Td=Ld||(Ld={})).Lines="lines",Td.Dots="dots",Td.Cross="cross";const Fd={[Ld.Dots]:1,[Ld.Lines]:1,[Ld.Cross]:6},Xd=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function Yd({id:e,variant:t=Ld.Dots,gap:n=20,size:o,lineWidth:i=1,offset:r=0,color:a,bgColor:l,style:c,className:d,patternClassName:u}){const h=s.useRef(null),{transform:f,patternId:p}=yl(Xd,fl),g=o||Fd[t],m=t===Ld.Dots,y=t===Ld.Cross,x=Array.isArray(n)?n:[n,n],v=[x[0]*f[2]||1,x[1]*f[2]||1],w=g*f[2],S=Array.isArray(r)?r:[r,r],C=y?[w,w]:v,N=[S[0]*f[2]||1+C[0]/2,S[1]*f[2]||1+C[1]/2],k=`${p}${e||""}`;return b.jsxs("svg",{className:Tt(["react-flow__background",d]),style:{...c,...dc,"--xy-background-color-props":l,"--xy-background-pattern-color-props":a},ref:h,"data-testid":"rf__background",children:[b.jsx("pattern",{id:k,x:f[0]%v[0],y:f[1]%v[1],width:v[0],height:v[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${N[0]},-${N[1]})`,children:m?b.jsx(Hd,{radius:w/2,className:u}):b.jsx(Vd,{dimensions:C,lineWidth:i,variant:t,className:u})}),b.jsx("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${k})`})]})}Yd.displayName="Background";const Zd=s.memo(Yd);function Kd(){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",children:b.jsx("path",{d:"M32 18.133H18.133V32h-4.266V18.133H0v-4.266h13.867V0h4.266v13.867H32z"})})}function Wd(){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 5",children:b.jsx("path",{d:"M0 0h32v4.2H0z"})})}function qd(){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 30",children:b.jsx("path",{d:"M3.692 4.63c0-.53.4-.938.939-.938h5.215V0H4.708C2.13 0 0 2.054 0 4.63v5.216h3.692V4.631zM27.354 0h-5.2v3.692h5.17c.53 0 .984.4.984.939v5.215H32V4.631A4.624 4.624 0 0027.354 0zm.954 24.83c0 .532-.4.94-.939.94h-5.215v3.768h5.215c2.577 0 4.631-2.13 4.631-4.707v-5.139h-3.692v5.139zm-23.677.94c-.531 0-.939-.4-.939-.94v-5.138H0v5.139c0 2.577 2.13 4.707 4.708 4.707h5.138V25.77H4.631z"})})}function Gd(){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:b.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0 8 0 4.571 3.429 4.571 7.619v3.048H3.048A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047zm4.724-13.866H7.467V7.619c0-2.59 2.133-4.724 4.723-4.724 2.591 0 4.724 2.133 4.724 4.724v3.048z"})})}function Ud(){return b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 32",children:b.jsx("path",{d:"M21.333 10.667H19.81V7.619C19.81 3.429 16.38 0 12.19 0c-4.114 1.828-1.37 2.133.305 2.438 1.676.305 4.42 2.59 4.42 5.181v3.048H3.047A3.056 3.056 0 000 13.714v15.238A3.056 3.056 0 003.048 32h18.285a3.056 3.056 0 003.048-3.048V13.714a3.056 3.056 0 00-3.048-3.047zM12.19 24.533a3.056 3.056 0 01-3.047-3.047 3.056 3.056 0 013.047-3.048 3.056 3.056 0 013.048 3.048 3.056 3.056 0 01-3.048 3.047z"})})}function Qd({children:e,className:t,...n}){return b.jsx("button",{type:"button",className:Tt(["react-flow__controls-button",t]),...n,children:e})}const Jd=e=>({isInteractive:e.nodesDraggable||e.nodesConnectable||e.elementsSelectable,minZoomReached:e.transform[2]<=e.minZoom,maxZoomReached:e.transform[2]>=e.maxZoom,ariaLabelConfig:e.ariaLabelConfig});function eu({style:e,showZoom:t=!0,showFitView:n=!0,showInteractive:o=!0,fitViewOptions:i,onZoomIn:r,onZoomOut:s,onFitView:a,onInteractiveChange:l,className:c,children:d,position:u="bottom-left",orientation:h="vertical","aria-label":f}){const p=xl(),{isInteractive:g,minZoomReached:m,maxZoomReached:y,ariaLabelConfig:x}=yl(Jd,fl),{zoomIn:v,zoomOut:w,fitView:S}=ac(),C="horizontal"===h?"horizontal":"vertical";return b.jsxs(Ml,{className:Tt(["react-flow__controls",C,c]),position:u,style:e,"data-testid":"rf__controls","aria-label":f??x["controls.ariaLabel"],children:[t&&b.jsxs(b.Fragment,{children:[b.jsx(Qd,{onClick:()=>{v(),null==r||r()},className:"react-flow__controls-zoomin",title:x["controls.zoomIn.ariaLabel"],"aria-label":x["controls.zoomIn.ariaLabel"],disabled:y,children:b.jsx(Kd,{})}),b.jsx(Qd,{onClick:()=>{w(),null==s||s()},className:"react-flow__controls-zoomout",title:x["controls.zoomOut.ariaLabel"],"aria-label":x["controls.zoomOut.ariaLabel"],disabled:m,children:b.jsx(Wd,{})})]}),n&&b.jsx(Qd,{className:"react-flow__controls-fitview",onClick:()=>{S(i),null==a||a()},title:x["controls.fitView.ariaLabel"],"aria-label":x["controls.fitView.ariaLabel"],children:b.jsx(qd,{})}),o&&b.jsx(Qd,{className:"react-flow__controls-interactive",onClick:()=>{p.setState({nodesDraggable:!g,nodesConnectable:!g,elementsSelectable:!g}),null==l||l(!g)},title:x["controls.interactive.ariaLabel"],"aria-label":x["controls.interactive.ariaLabel"],children:g?b.jsx(Ud,{}):b.jsx(Gd,{})}),d]})}eu.displayName="Controls";const tu=s.memo(eu);const nu=s.memo(function({id:e,x:t,y:n,width:o,height:i,style:r,color:s,strokeColor:a,strokeWidth:l,className:c,borderRadius:d,shapeRendering:u,selected:h,onClick:f}){const{background:p,backgroundColor:g}=r||{},m=s||p||g;return b.jsx("rect",{className:Tt(["react-flow__minimap-node",{selected:h},c]),x:t,y:n,rx:d,ry:d,width:o,height:i,style:{fill:m,stroke:a,strokeWidth:l},shapeRendering:u,onClick:f?t=>f(t,e):void 0})}),ou=e=>e.nodes.map(e=>e.id),iu=e=>e instanceof Function?e:()=>e;const ru=s.memo(function({id:e,nodeColorFunc:t,nodeStrokeColorFunc:n,nodeClassNameFunc:o,nodeBorderRadius:i,nodeStrokeWidth:r,shapeRendering:s,NodeComponent:a,onClick:l}){const{node:c,x:d,y:u,width:h,height:f}=yl(t=>{const{internals:n}=t.nodeLookup.get(e),o=n.userNode,{x:i,y:r}=n.positionAbsolute,{width:s,height:a}=Rs(o);return{node:o,x:i,y:r,width:s,height:a}},fl);return c&&!c.hidden&&Os(c)?b.jsx(a,{x:d,y:u,width:h,height:f,style:c.style,selected:!!c.selected,className:o(c),color:t(c),borderRadius:i,strokeColor:n(c),strokeWidth:r,shapeRendering:s,onClick:l,id:c.id}):null});var su=s.memo(function({nodeStrokeColor:e,nodeColor:t,nodeClassName:n="",nodeBorderRadius:o=5,nodeStrokeWidth:i,nodeComponent:r=nu,onClick:s}){const a=yl(ou,fl),l=iu(t),c=iu(e),d=iu(n),u="undefined"==typeof window||window.chrome?"crispEdges":"geometricPrecision";return b.jsx(b.Fragment,{children:a.map(e=>b.jsx(ru,{id:e,nodeColorFunc:l,nodeStrokeColorFunc:c,nodeClassNameFunc:d,nodeBorderRadius:o,nodeStrokeWidth:i,NodeComponent:r,onClick:s,shapeRendering:u},e))})});const au=e=>!e.hidden,lu=e=>{const t={x:-e.transform[0]/e.transform[2],y:-e.transform[1]/e.transform[2],width:e.width/e.transform[2],height:e.height/e.transform[2]};return{viewBB:t,boundingRect:e.nodeLookup.size>0?Cs(ls(e.nodeLookup,{filter:au}),t):t,rfId:e.rfId,panZoom:e.panZoom,translateExtent:e.translateExtent,flowWidth:e.width,flowHeight:e.height,ariaLabelConfig:e.ariaLabelConfig}};function cu({style:e,className:t,nodeStrokeColor:n,nodeColor:o,nodeClassName:i="",nodeBorderRadius:r=5,nodeStrokeWidth:a,nodeComponent:l,bgColor:c,maskColor:d,maskStrokeColor:u,maskStrokeWidth:h,position:f="bottom-right",onClick:p,onNodeClick:g,pannable:m=!1,zoomable:y=!1,ariaLabel:x,inversePan:v,zoomStep:w=1,offsetScale:S=5}){const C=xl(),N=s.useRef(null),{boundingRect:k,viewBB:E,rfId:M,panZoom:_,translateExtent:j,flowWidth:P,flowHeight:I,ariaLabelConfig:A}=yl(lu,fl),D=(null==e?void 0:e.width)??200,z=(null==e?void 0:e.height)??150,R=k.width/D,O=k.height/z,B=Math.max(R,O),L=B*D,T=B*z,$=S*B,V=k.x-(L-k.width)/2-$,H=k.y-(T-k.height)/2-$,F=L+2*$,X=T+2*$,Y=`react-flow__minimap-desc-${M}`,Z=s.useRef(0),K=s.useRef();Z.current=B,s.useEffect(()=>{if(N.current&&_)return K.current=function({domNode:e,panZoom:t,getTransform:n,getViewScale:o}){const i=io(e);return{update:function({translateExtent:e,width:r,height:s,zoomStep:a=1,pannable:l=!0,zoomable:c=!0,inversePan:d=!1}){let u=[0,0];const h=Pr().on("start",e=>{"mousedown"!==e.sourceEvent.type&&"touchstart"!==e.sourceEvent.type||(u=[e.sourceEvent.clientX??e.sourceEvent.touches[0].clientX,e.sourceEvent.clientY??e.sourceEvent.touches[0].clientY])}).on("zoom",l?i=>{const a=n();if("mousemove"!==i.sourceEvent.type&&"touchmove"!==i.sourceEvent.type||!t)return;const l=[i.sourceEvent.clientX??i.sourceEvent.touches[0].clientX,i.sourceEvent.clientY??i.sourceEvent.touches[0].clientY],c=[l[0]-u[0],l[1]-u[1]];u=l;const h=o()*Math.max(a[2],Math.log(a[2]))*(d?-1:1),f={x:a[0]-c[0]*h,y:a[1]-c[1]*h},p=[[0,0],[r,s]];t.setViewportConstrained({x:f.x,y:f.y,zoom:a[2]},p,e)}:null).on("zoom.wheel",c?e=>{if("wheel"!==e.sourceEvent.type||!t)return;const o=n(),i=e.sourceEvent.ctrlKey&&Ds()?10:1,r=-e.sourceEvent.deltaY*(1===e.sourceEvent.deltaMode?.05:e.sourceEvent.deltaMode?1:.002)*a,s=o[2]*Math.pow(2,r*i);t.scaleTo(s)}:null);i.call(h,{})},destroy:function(){i.on("zoom",null)},pointer:ro}}({domNode:N.current,panZoom:_,getTransform:()=>C.getState().transform,getViewScale:()=>Z.current}),()=>{var e;null==(e=K.current)||e.destroy()}},[_]),s.useEffect(()=>{var e;null==(e=K.current)||e.update({translateExtent:j,width:P,height:I,inversePan:v,pannable:m,zoomStep:w,zoomable:y})},[m,y,v,w,j,P,I]);const W=p?e=>{var t;const[n,o]=(null==(t=K.current)?void 0:t.pointer(e))||[0,0];p(e,{x:n,y:o})}:void 0,q=g?s.useCallback((e,t)=>{const n=C.getState().nodeLookup.get(t).internals.userNode;g(e,n)},[]):void 0,G=x??A["minimap.ariaLabel"];return b.jsx(Ml,{position:f,style:{...e,"--xy-minimap-background-color-props":"string"==typeof c?c:void 0,"--xy-minimap-mask-background-color-props":"string"==typeof d?d:void 0,"--xy-minimap-mask-stroke-color-props":"string"==typeof u?u:void 0,"--xy-minimap-mask-stroke-width-props":"number"==typeof h?h*B:void 0,"--xy-minimap-node-background-color-props":"string"==typeof o?o:void 0,"--xy-minimap-node-stroke-color-props":"string"==typeof n?n:void 0,"--xy-minimap-node-stroke-width-props":"number"==typeof a?a:void 0},className:Tt(["react-flow__minimap",t]),"data-testid":"rf__minimap",children:b.jsxs("svg",{width:D,height:z,viewBox:`${V} ${H} ${F} ${X}`,className:"react-flow__minimap-svg",role:"img","aria-labelledby":Y,ref:N,onClick:W,children:[G&&b.jsx("title",{id:Y,children:G}),b.jsx(su,{onClick:q,nodeColor:o,nodeStrokeColor:n,nodeBorderRadius:r,nodeClassName:i,nodeStrokeWidth:a,nodeComponent:l}),b.jsx("path",{className:"react-flow__minimap-mask",d:`M${V-$},${H-$}h${F+2*$}v${X+2*$}h${-F-2*$}z\n        M${E.x},${E.y}h${E.width}v${E.height}h${-E.width}z`,fillRule:"evenodd",pointerEvents:"none"})]})})}cu.displayName="MiniMap",s.memo(cu);const du={[$a.Line]:"right",[$a.Handle]:"bottom-right"};s.memo(function({nodeId:e,position:t,variant:n=$a.Handle,className:o,style:i,children:r,color:a,minWidth:l=10,minHeight:c=10,maxWidth:d=Number.MAX_VALUE,maxHeight:u=Number.MAX_VALUE,keepAspectRatio:h=!1,resizeDirection:f,autoScale:p=!0,shouldResize:g,onResizeStart:m,onResize:y,onResizeEnd:x}){const v=Cc(),w="string"==typeof e?e:v,S=xl(),C=s.useRef(null),N=n===$a.Handle,k=yl(s.useCallback((E=N&&p,e=>E?`${Math.max(1/e.transform[2],1)}`:void 0),[N,p]),fl);var E;const M=s.useRef(null),_=t??du[n];s.useEffect(()=>{if(C.current&&w)return M.current||(M.current=Ga({domNode:C.current,nodeId:w,getStoreItems:()=>{const{nodeLookup:e,transform:t,snapGrid:n,snapToGrid:o,nodeOrigin:i,domNode:r}=S.getState();return{nodeLookup:e,transform:t,snapGrid:n,snapToGrid:o,nodeOrigin:i,paneDomNode:r}},onChange:(e,t)=>{const{triggerNodeChanges:n,nodeLookup:o,parentLookup:i,nodeOrigin:r}=S.getState(),s=[],a={x:e.x,y:e.y},l=o.get(w);if(l&&l.expandParent&&l.parentId){const t=l.origin??r,n=e.width??l.measured.width??0,c=e.height??l.measured.height??0,d=va([{id:l.id,parentId:l.parentId,rect:{width:n,height:c,...Bs({x:e.x??l.position.x,y:e.y??l.position.y},{width:n,height:c},l.parentId,o,t)}}],o,i,r);s.push(...d),a.x=e.x?Math.max(t[0]*n,e.x):void 0,a.y=e.y?Math.max(t[1]*c,e.y):void 0}if(void 0!==a.x&&void 0!==a.y){const e={id:w,type:"position",position:{...a}};s.push(e)}if(void 0!==e.width&&void 0!==e.height){const t={id:w,type:"dimensions",resizing:!0,setAttributes:!f||("horizontal"===f?"width":"height"),dimensions:{width:e.width,height:e.height}};s.push(t)}for(const c of t){const e={...c,type:"position"};s.push(e)}n(s)},onEnd:({width:e,height:t})=>{const n={id:w,type:"dimensions",resizing:!1,dimensions:{width:e,height:t}};S.getState().triggerNodeChanges([n])}})),M.current.update({controlPosition:_,boundaries:{minWidth:l,minHeight:c,maxWidth:d,maxHeight:u},keepAspectRatio:h,resizeDirection:f,onResizeStart:m,onResize:y,onResizeEnd:x,shouldResize:g}),()=>{var e;null==(e=M.current)||e.destroy()}},[_,l,c,d,u,h,m,y,x,g]);const j=_.split("-");return b.jsx("div",{className:Tt(["react-flow__resize-control","nodrag",...j,n,o]),ref:C,style:{...i,scale:k,...a&&{[N?"backgroundColor":"borderColor"]:a}},children:r})});const uu={statusNode:({data:e})=>/* @__PURE__ */b.jsxs("div",{className:"relative",children:[
/* @__PURE__ */b.jsx(kc,{type:"target",position:ts.Left,style:{background:"#555"}}),
/* @__PURE__ */b.jsx(q,{status:e.status,size:e.size,responsive:e.responsive,disabled:!e.isActive}),
/* @__PURE__ */b.jsx(kc,{type:"source",position:ts.Right,style:{background:"#555"}})]})},hu=({status:e="Storing",listedMode:t="Selling",className:n,size:o="md",responsive:i=!0,showControls:r=!1,showBackground:a=!0,draggable:l=!1,fixedSize:c=!1})=>{const d=s.useCallback(n=>{if(!e)return!1;return({Storing:["Storing"],Selling:["Storing","Selling"],Auctioning:["Storing","Auctioning"],Paid:["Storing",t,"Paid"],Refunding:["Storing",t,"Paid","Refunding"],InSecrecy:["Storing",t,"Paid","InSecrecy"],Published:["Storing",t,"Paid","InSecrecy","Published"],Blacklisted:["Storing","Blacklisted"]}[e]||[]).includes(n)},[e,t]),u=s.useCallback(()=>{const e={sm:{storing:{x:0,y:40},selling:{x:120,y:20},auctioning:{x:120,y:60},paid:{x:240,y:40},inSecrecy:{x:360,y:20},refunding:{x:360,y:60},published:{x:480,y:40}},md:{storing:{x:0,y:60},selling:{x:150,y:30},auctioning:{x:150,y:90},paid:{x:300,y:60},inSecrecy:{x:450,y:30},refunding:{x:450,y:90},published:{x:600,y:60}},lg:{storing:{x:0,y:80},selling:{x:200,y:40},auctioning:{x:200,y:120},paid:{x:400,y:80},inSecrecy:{x:600,y:40},refunding:{x:600,y:120},published:{x:800,y:80}}};return e[o]||e.md},[o]),h=s.useCallback(()=>{const t=u();return[{id:"storing",position:t.storing,data:{status:"Storing",isActive:d("Storing"),isCurrent:"Storing"===e,size:o,responsive:i},type:"statusNode"},{id:"selling",position:t.selling,data:{status:"Selling",isActive:d("Selling"),isCurrent:"Selling"===e,size:o,responsive:i},type:"statusNode"},{id:"auctioning",position:t.auctioning,data:{status:"Auctioning",isActive:d("Auctioning"),isCurrent:"Auctioning"===e,size:o,responsive:i},type:"statusNode"},{id:"paid",position:t.paid,data:{status:"Paid",isActive:d("Paid"),isCurrent:"Paid"===e,size:o,responsive:i},type:"statusNode"},{id:"inSecrecy",position:t.inSecrecy,data:{status:"InSecrecy",isActive:d("InSecrecy"),isCurrent:"InSecrecy"===e,size:o,responsive:i},type:"statusNode"},{id:"refunding",position:t.refunding,data:{status:"Refunding",isActive:d("Refunding"),isCurrent:"Refunding"===e,size:o,responsive:i},type:"statusNode"},{id:"published",position:t.published,data:{status:"Published",isActive:d("Published"),isCurrent:"Published"===e,size:o,responsive:i},type:"statusNode"}]},[u,d,e,o,i]),f=s.useMemo(()=>[{id:"storing-selling",source:"storing",target:"selling"},{id:"storing-auctioning",source:"storing",target:"auctioning"},{id:"selling-paid",source:"selling",target:"paid"},{id:"auctioning-paid",source:"auctioning",target:"paid"},{id:"paid-inSecrecy",source:"paid",target:"inSecrecy"},{id:"paid-refunding",source:"paid",target:"refunding"},{id:"inSecrecy-published",source:"inSecrecy",target:"published"},{id:"refunding-published",source:"refunding",target:"published"}],[]),[p,g,m]=function(e){const[t,n]=s.useState(e),o=s.useCallback(e=>n(t=>Wl(e,t)),[]);return[t,n,o]}(h()),[y,x,v]=function(e){const[t,n]=s.useState(e),o=s.useCallback(e=>n(t=>ql(e,t)),[]);return[t,n,o]}(f);s.useEffect(()=>{g(h())},[h,g]);const w=s.useCallback(e=>x(t=>ta(e,t)),[]),C=s.useCallback(()=>{const e={sm:"80px",md:"120px",lg:"160px"};return e[o]||e.md},[o]),N=s.useCallback(()=>{const e={sm:"720px",md:"920px",lg:"1120px"};return e[o]||e.md},[o]);/* @__PURE__ */
return b.jsx("div",{className:S("bg-background ",n),style:{height:c?C():"100%",width:c?N():"100%",position:"relative",overflow:"hidden"},children:/* @__PURE__ */b.jsxs($d,{nodes:p,edges:y,onNodesChange:m,onEdgesChange:v,onConnect:w,nodeTypes:uu,fitView:!0,fitViewOptions:{padding:.3},nodesDraggable:l,nodesConnectable:!1,elementsSelectable:!1,panOnDrag:!1,zoomOnScroll:!1,zoomOnPinch:!1,zoomOnDoubleClick:!1,preventScrolling:!1,proOptions:{hideAttribution:!0},children:[a&&/* @__PURE__ */b.jsx(Zd,{}),r&&/* @__PURE__ */b.jsx(tu,{})]},`flow-${y.length}-${p.length}`)})},fu=({status:e,listedMode:t,className:n,size:o="md",responsive:i=!0,showBackground:r=!0,showIndicator:a=!0,enableHorizontalScroll:l=!1})=>(s.useEffect(()=>{l&&(e=>{const t=document.querySelector(`#status-step-flow-${e}`);t&&t.scrollIntoView({behavior:"smooth",inline:"center"})})(e)},[l,e]),/* @__PURE__ */b.jsxs("div",{className:S("bg-background relative",n),style:{width:"100%",position:"relative"},children:[l&&a&&/* @__PURE__ */b.jsxs(b.Fragment,{children:[
/* @__PURE__ */b.jsx("div",{className:"absolute left-0 top-0 w-8 h-full bg-gradient-to-r from-background via-background/80 to-transparent z-10 flex items-center justify-start pl-1 pointer-events-none",children:/* @__PURE__ */b.jsx(ke,{className:"w-4 h-4 text-muted-foreground/60 animate-pulse"})}),
/* @__PURE__ */b.jsx("div",{className:"absolute right-0 top-0 w-8 h-full bg-gradient-to-l from-background via-background/80 to-transparent z-10 flex items-center justify-end pr-1 pointer-events-none",children:/* @__PURE__ */b.jsx(Ee,{className:"w-4 h-4 text-muted-foreground/60 animate-pulse"})})]}),
/* @__PURE__ */b.jsx("div",{className:S(l&&"status-step-flow-container"),style:l?{overflowX:"auto",overflowY:"hidden",width:"100%"}:{width:"100%",overflow:"hidden"},children:/* @__PURE__ */b.jsx("div",{style:l?{display:"flex",justifyContent:"center",alignItems:"center",minWidth:"fit-content",width:"max-content"}:{width:"100%",height:"100%"},children:/* @__PURE__ */b.jsx(hu,{status:e,listedMode:"Auctioning"!==t?"Selling":t,size:o,responsive:i,showBackground:r,fixedSize:l})})})]})),pu=({value:e,unit:t,size:n,responsive:o=!0})=>{const i=s.useMemo(()=>{const e={sm:{number:o?"text-xl sm:text-2xl lg:text-3xl":"text-2xl",unit:o?"text-sm sm:text-base":"text-base",padding:o?"px-2 py-1 sm:px-3 sm:py-2":"px-3 py-2",spacing:o?"ml-1 mr-1 sm:ml-1 sm:mr-2":"ml-1 mr-2"},md:{number:o?"text-2xl sm:text-3xl lg:text-4xl":"text-3xl",unit:o?"text-base sm:text-lg":"text-lg",padding:o?"px-3 py-2 sm:px-4 sm:py-3 lg:px-5 lg:py-4":"px-4 py-3",spacing:o?"ml-1 mr-2 sm:ml-2 sm:mr-3 lg:mr-3":"ml-2 mr-3"},lg:{number:o?"text-3xl sm:text-4xl lg:text-5xl":"text-4xl",unit:o?"text-lg sm:text-xl":"text-xl",padding:o?"px-4 py-3 sm:px-5 sm:py-4 lg:px-6 lg:py-5":"px-5 py-4",spacing:o?"ml-2 mr-3 sm:ml-2 sm:mr-4 lg:mr-4":"ml-2 mr-4"}};return e[n]||e.md},[n,o]);/* @__PURE__ */
return b.jsxs("div",{className:"flex items-baseline",children:[
/* @__PURE__ */b.jsx("span",{className:S("font-medium text-foreground bg-secondary rounded-lg transition-all duration-200",i.number,i.padding),children:e.toString().padStart(2,"0")}),
/* @__PURE__ */b.jsx("span",{className:S("text-muted-foreground font-normal",i.unit,i.spacing),children:t})]})},gu=({targetTime:e,size:t="md",className:n,showStatus:o=!0,customStatusText:i,onCountdownEnd:r,direction:a="vertical",responsive:l=!0})=>{const c=s.useCallback(()=>{const t=Math.floor(Date.now()/1e3),n=e-t;let o={days:0,hours:0,minutes:0,seconds:0};return n>0?(o={days:Math.floor(n/86400),hours:Math.floor(n/3600%24),minutes:Math.floor(n/60%60),seconds:Math.floor(n%60)},{timeLeft:o,status:"counting"}):{timeLeft:o,status:"ended"}},[e]),[d,u]=s.useState(()=>{const{timeLeft:e}=c();return e}),[h,f]=s.useState(()=>{const{status:e}=c();return e}),p=s.useMemo(()=>({counting:(null==i?void 0:i.counting)||"Countdown",ended:(null==i?void 0:i.ended)||"Countdown has ended"}),[i]),g=s.useMemo(()=>{const e={sm:{spacing:l?"space-y-2 sm:space-y-3":"space-y-3",statusText:l?"text-lg sm:text-xl":"text-xl",containerPadding:l?"p-3 sm:p-4":"p-4"},md:{spacing:l?"space-y-3 sm:space-y-4 lg:space-y-5":"space-y-4",statusText:l?"text-xl sm:text-2xl lg:text-3xl":"text-2xl",containerPadding:l?"p-4 sm:p-6 lg:p-8":"p-6"},lg:{spacing:l?"space-y-4 sm:space-y-6 lg:space-y-8":"space-y-6",statusText:l?"text-2xl sm:text-3xl lg:text-4xl":"text-3xl",containerPadding:l?"p-6 sm:p-8 lg:p-10":"p-8"}};return e[t]||e.md},[t,l]);s.useEffect(()=>{const e=setInterval(()=>{const{timeLeft:e,status:t}=c();u(e),h!==t&&(f(t),"ended"===t&&r&&r())},1e3);return()=>clearInterval(e)},[e,c,h,r]);const m=s.useMemo(()=>[{value:d.days,unit:"D",label:"Days"},{value:d.hours,unit:"H",label:"Hours"},{value:d.minutes,unit:"M",label:"Minutes"},{value:d.seconds,unit:"S",label:"Seconds"}],[d]),y=s.useMemo(()=>{const e="flex justify-center items-center";return"horizontal"===a?`${e} flex-row space-x-4 sm:space-x-6`:`${e} flex-col ${g.spacing}`},[a,g.spacing]),x=s.useMemo(()=>"flex flex-row justify-center items-center space-x-1 sm:space-x-2",[a]);/* @__PURE__ */
return b.jsxs("div",{className:S("w-full bg-background rounded-lg border border-border/50 md:rounded-2xl",y,g.containerPadding,n),children:[o&&/* @__PURE__ */b.jsx("p",{className:S("text-center font-medium","counting"===h?"text-foreground":"text-muted-foreground",g.statusText),children:p[h]}),
/* @__PURE__ */b.jsx("div",{className:x,children:m.map((e,n)=>/* @__PURE__ */b.jsx(pu,{value:e.value,unit:e.unit,size:t,responsive:l},e.unit))})]})},mu=()=>{const{roles:e}=Ie(e=>e.userState),{login:t,isLoading:n}=_();return(()=>{const{box:e,biddersIds:t}=ze(),{address:n,isConnected:o,chainId:i}=y()||{},{isValidateSession:r}=_(),{updateUserState:a}=Ie(),l=x(e=>{var t,o;const r=i||v;if(!r||!n)return"";const s=e.accounts[r];return s?(null==(t=s[n])?void 0:t.userId)??(null==(o=s[n.toLowerCase()])?void 0:o.userId)??"":""});s.useEffect(()=>{let i=[];if(a({roles:i}),!n||!o||!e)return;if(!r)return;const s=String(l).trim(),c=e.sellerId?String(e.sellerId).trim():"",d=e.buyerId?String(e.buyerId).trim():"",u=e.minterId?String(e.minterId).trim():"",h=e.completerId?String(e.completerId).trim():"";t&&t.length>0&&s&&""!==s&&t.some(e=>e===s)&&d!==s&&i.push("Bidder"),a({roles:((null==n?void 0:n.toLowerCase())===ue.toLowerCase()&&i.push("Admin"),s&&""!==s&&(s===u&&i.push("Minter"),s===c&&i.push("Seller"),s===d&&i.push("Buyer"),s===h&&i.push("Completer")),0===i.length&&i.push("Other"),i)})},[n,o,e,l,r])})(),/* @__PURE__ */b.jsx("div",{className:"flex flex-col items-start justify-center",children:e.length>0?/* @__PURE__ */b.jsx(b.Fragment,{children:/* @__PURE__ */b.jsx(j,{showIcon:!0,message:`You are: ${e.join(", ")}`,description:"You can do the following actions:",type:"info"})}):/* @__PURE__ */b.jsx(b.Fragment,{children:/* @__PURE__ */b.jsx(j,{type:"warning",showIcon:!0,message:"You are: Guest, please login!",description:/* @__PURE__ */b.jsx(w,{direction:"vertical",size:"small",style:{width:"100%"},children:/* @__PURE__ */b.jsx(C,{type:"primary",block:!0,loading:n,onClick:()=>t(),children:"Login"})})})})})},yu={WTRC:4.8,"WROSE.S":.005,"WTRC.S":4.8},xu=({price:e,token:t,status:n})=>{const{getTokenPrice:o}={getTokenPrice:async(e,t)=>{const n=L.find(t=>t.address===e);if(!n)throw new Error(`Token ${e} not found`);const o=Number(z(BigInt(t),n.decimals));return yu[n.symbol]*o}},[i,r]=s.useState(0),a=P(t);s.useEffect(()=>{a&&o(a.address,Number(e)).then(e=>{r(e)})},[a,e]);const l="Published"!==n&&"Blacklisted"!==n;/* @__PURE__ */
return b.jsx(b.Fragment,{children:l&&/* @__PURE__ */b.jsxs("div",{className:"flex items-baseline flex-row gap-2",children:[
/* @__PURE__ */b.jsx(F,{children:"Price:"}),
/* @__PURE__ */b.jsx(H,{size:"xl",price:e,symbol:null==a?void 0:a.symbol,decimals:null==a?void 0:a.decimals}),i>0&&/* @__PURE__ */b.jsxs("span",{className:"flex items-baseline flex-row gap-2",children:[
/* @__PURE__ */b.jsx(F,{children:"≈"}),
/* @__PURE__ */b.jsx(H,{size:"lg",price:i,symbol:"USD"})]})]})})},vu=[{name:"Twitter",icon:/* @__PURE__ */b.jsx(Q,{className:"w-5 h-5 md:w-6 md:h-6"}),getUrl:(e,t)=>`https://twitter.com/intent/tweet?url=${encodeURIComponent(t)}&text=${encodeURIComponent(e)}`,color:"hover:bg-primary/10 text-primary"},{name:"Facebook",icon:/* @__PURE__ */b.jsx(J,{className:"w-5 h-5 md:w-6 md:h-6"}),getUrl:(e,t)=>`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(t)}`,color:"hover:bg-primary/10 text-primary"},{name:"Telegram",icon:/* @__PURE__ */b.jsx(ee,{className:"w-5 h-5 md:w-6 md:h-6"}),getUrl:(e,t)=>`https://t.me/share/url?url=${encodeURIComponent(t)}&text=${encodeURIComponent(e)}`,color:"hover:bg-primary/10 text-primary"}],bu=({title:e="",description:t="",url:n="",className:o=""})=>{const i=e||t||"",r=n||("undefined"!=typeof window?window.location.href:"");/* @__PURE__ */
return b.jsx("div",{className:`flex w-full flex-row gap-3 md:gap-4 justify-center items-center ${o}`,children:vu.map(e=>/* @__PURE__ */b.jsx("a",{href:e.getUrl(i,r),target:"_blank",rel:"noopener noreferrer","aria-label":`Share to ${e.name}`,className:`rounded-full p-1 md:p-2 shadow-sm transition-colors duration-150 ${e.color} hover:text-primary hover:scale-105`,children:/* @__PURE__ */b.jsx("div",{className:"w-4 h-4 md:w-5 md:h-5 flex items-center justify-center text-muted-foreground hover:text-primary ",children:e.icon})},e.name))})},wu=({tokenId:e})=>{const{box:t,metadataBox:n,isLoading:o}=ze(),[i,r]=s.useState(""),[a,l]=s.useState("Storing"),[c,d]=s.useState(""),[u,h]=s.useState(0),[f,p]=s.useState("");s.useEffect(()=>{t&&(l(t.status),r(t.price??""),h(Number(t.deadline)),p(t.acceptedToken??""),d(t.listedMode??"Selling"))},[t]);return o?/* @__PURE__ */b.jsx("div",{className:"w-full flex items-center justify-center py-12",children:/* @__PURE__ */b.jsx("div",{className:"text-muted-foreground text-lg",children:"Loading..."})}):/* @__PURE__ */b.jsxs("div",{className:"w-full space-y-4 md:space-y-6",children:[
/* @__PURE__ */b.jsx(q,{status:a}),
/* @__PURE__ */b.jsx(fu,{status:a,listedMode:c,size:"sm",enableHorizontalScroll:!0}),"Published"!==a&&/* @__PURE__ */b.jsxs(b.Fragment,{children:[
/* @__PURE__ */b.jsx(gu,{targetTime:u,size:"sm"}),
/* @__PURE__ */b.jsx("hr",{className:"border-border/50"})]}),(null==t?void 0:t.isInBlacklist)&&/* @__PURE__ */b.jsx(j,{message:"Warning",description:"The NFT is in blacklist, can't do anything!",type:"warning"}),
/* @__PURE__ */b.jsx(xu,{status:a,price:i,token:f}),
/* @__PURE__ */b.jsx(mu,{}),(()=>{switch(a){case"Storing":/* @__PURE__ */
return b.jsx(At,{});case"Selling":/* @__PURE__ */
return b.jsx(Dt,{});case"Auctioning":/* @__PURE__ */
return b.jsx(zt,{});case"Paid":/* @__PURE__ */
return b.jsx(Rt,{});case"Refunding":/* @__PURE__ */
return b.jsx(Ot,{});case"InSecrecy":/* @__PURE__ */
return b.jsx(Bt,{});case"Published":/* @__PURE__ */
return b.jsx(Lt,{});default:return null}})(),
/* @__PURE__ */b.jsx("hr",{className:"border-border/50"}),!1,
/* @__PURE__ */b.jsx(bu,{title:(null==n?void 0:n.title)??"",description:(null==n?void 0:n.description)??"",image:(null==n?void 0:n.nftImage)??"",url:"undefined"!=typeof window?window.location.href:""})]})},Su=()=>{const{tokenId:e}=T();/* @__PURE__ */
return b.jsx(b.Fragment,{children:/* @__PURE__ */b.jsxs($,{className:"py-8 md:py-12 lg:py-16",children:[
/* @__PURE__ */b.jsx("div",{className:"text-center mb-8 md:mb-12",children:/* @__PURE__ */b.jsx("p",{className:"text-xl text-muted-foreground md:text-2xl lg:text-3xl font-bold",children:"Only criminals fear the truth being revealed!"})}),
/* @__PURE__ */b.jsx("div",{className:"bg-muted/30 backdrop-blur-sm rounded-2xl p-6 md:p-8 lg:p-12",children:/* @__PURE__ */b.jsx(De,{boxId:e||"",children:/* @__PURE__ */b.jsxs("div",{className:"flex w-full flex-col lg:flex-row gap-8 lg:gap-12",children:[
/* @__PURE__ */b.jsx("div",{className:"flex-1 lg:max-w-2xl",children:/* @__PURE__ */b.jsx(Re,{tokenId:e||""})}),
/* @__PURE__ */b.jsx("div",{className:"hidden lg:block w-px bg-border/50 self-stretch"}),
/* @__PURE__ */b.jsx("div",{className:"flex-1 lg:max-w-xl",children:/* @__PURE__ */b.jsx(wu,{tokenId:e||""})})]})})})]})})};export{Su as default};
